<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Swift | Stand-Down Comedian</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="UIKit is the iOS user interface toolkit. IB is Interface Builder. CA is Core Animation. Like CALayer is a Core Animation data type responsible for managing the way your view looks. Core Animation han">
<meta property="og:type" content="article">
<meta property="og:title" content="Swift">
<meta property="og:url" content="http://giantslayer1980.github.io/Swift/index.html">
<meta property="og:site_name" content="Stand-Down Comedian">
<meta property="og:description" content="UIKit is the iOS user interface toolkit. IB is Interface Builder. CA is Core Animation. Like CALayer is a Core Animation data type responsible for managing the way your view looks. Core Animation han">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/withoutUIEdgeInsets.png">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/withUIEdgeInsets.png">
<meta property="og:image" content="http://giantslayer1980.github.io/images/cell-tintColor.gif">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/disclosureIndicator.png">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/accesoryOfCell.png">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/tagOfUIButton.webp">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/popoverPresentationController.gif">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/toolbarItems.png">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/webViewLoadHtmlString.png">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/labelLayout_0.png">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/labelLayout_1.png">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/UIEdgeInsets_0.png">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/UIEdgeInsets_1.png">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/slotGlowGood@2x.png">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/bird-01.png">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/bird-02.png">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/bird-03.png">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/SKLabelNodeScale.gif">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/backgroundcolorFlash.gif">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/gameover.gif">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/WithoutAdvanceSimulationTime.gif">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/WithAdvanceSimulationTime.gif">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/FireParticles.gif">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/anchorPoint.webp">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/AnchorPoint_1.png">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/AnchorPoint_2.png">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/AnchorPoint_3.png">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/annotationButtonTapped.gif">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/editBreakpoint.png">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/exceptionBreakpoint.png">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/conceptionBreakpointDetail.png">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/NSException.png">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/lldb.png">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/viewDebugging.gif">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/viewDebuggingButton.png">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/safariExtension.gif">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/NSDictionary.png">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/NSExtensionOfInfoPlist.png">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/ExtensionFromProjectNavigator.png">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/KeyboardNotificationCenter_0.png">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/KeyboardNotificationCenter_1.gif">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/requestAuthorization.png">
<meta property="og:image" content="http://giantslayer1980.github.io/images/UNNotificationRequest.gif">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/UNNotificationRequest_2.gif">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/NSAttributedString.Key.png">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/NSMutableAttributedString.png">
<meta property="og:image" content="http://giantslayer1980.github.io/Images/NSAttributedString.Key.link.png">
<meta property="article:published_time" content="2023-01-02T16:00:00.000Z">
<meta property="article:modified_time" content="2023-02-27T14:42:14.050Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://giantslayer1980.github.io/Images/withoutUIEdgeInsets.png">
  
    <link rel="alternate" href="/atom.xml" title="Stand-Down Comedian" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Stand-Down Comedian</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://Giantslayer1980.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-Swift" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/Swift/" class="article-date">
  <time class="dt-published" datetime="2023-01-02T16:00:00.000Z" itemprop="datePublished">2023-01-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Swift/">Swift</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      Swift
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <ul>
<li><strong>UIKit</strong> is the iOS user interface toolkit.</li>
<li><strong>IB</strong> is Interface Builder.</li>
<li><strong>CA</strong> is Core Animation. Like CALayer is a Core Animation data type responsible for managing the way your view looks. Core Animation handles animation.</li>
<li><strong>CG</strong> is Apple’s Core Graphics framework. Like CGColor. Core Graphics handles drawing.</li>
<li><strong>KVO</strong> is key-value observing.</li>
<li><strong>NS</strong> is Next Step. Steve Jobs did lots.</li>
<li><strong>VFL</strong> is a technique called Auto Layout Visual Format Language.</li>
<li><strong>GCD</strong> is Grand Central Dispatch.</li>
<li><strong>FIFO</strong> is First In, First Out.</li>
<li><strong>MK</strong> is Mapkit.</li>
<li><strong>NS</strong> came from the NeXTSTEP libraries Foundation and AppKit(those names are still used by Apple’s Cocoa frameworks). </li>
<li><strong>UN</strong> is UserNotification.</li>
</ul>
<h1 id="FileManager"><a href="#FileManager" class="headerlink" title="FileManager"></a>FileManager</h1><h2 id="枚举程序设备目录内的所有文件"><a href="#枚举程序设备目录内的所有文件" class="headerlink" title="枚举程序设备目录内的所有文件"></a>枚举程序设备目录内的所有文件</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fm <span class="operator">=</span> <span class="type">FileManager</span>.default</span><br><span class="line"><span class="keyword">let</span> path <span class="operator">=</span> <span class="type">Bundle</span>.main.resourcePath<span class="operator">!</span></span><br><span class="line"><span class="keyword">let</span> items <span class="operator">=</span> <span class="keyword">try!</span> fm.contentsOfDirectory(atPath: path)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> items &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Bundle"><a href="#Bundle" class="headerlink" title="Bundle"></a>Bundle</h1><h2 id="Bundle-main-url-forResource-–-仅通过文件名而返回该文件的url"><a href="#Bundle-main-url-forResource-–-仅通过文件名而返回该文件的url" class="headerlink" title="Bundle.main.url(forResource:) – 仅通过文件名而返回该文件的url"></a>Bundle.main.url(forResource:) – 仅通过文件名而返回该文件的url</h2><p>Finding a path to a file is something you’ll do a lot, because even though you know the file is called “start.txt” you don’t know where it might be on the filesystem. So, we use a built-in method of Bundle to find it: path(forResource:). This takes as its parameters the name of the file and its path extension, and returns a String? – i.e., you either get the path back or you get nil if it didn’t exist.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 假设要找寻到start.txt这个文件</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> startWordsURL <span class="operator">=</span> <span class="type">Bundle</span>.main.url(forResource: <span class="string">&quot;start&quot;</span>, withExtension: <span class="string">&quot;txt&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// 若找到该start.txt的url后读取里面的文本内容</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> startWords <span class="operator">=</span> <span class="keyword">try?</span> <span class="type">String</span>(contentsOf: startWordsURL) &#123;</span><br><span class="line">        <span class="comment">// 省略后续代码</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="NSObject"><a href="#NSObject" class="headerlink" title="NSObject"></a>NSObject</h1><p>NSObject is what’s called a universal base class for all Cocoa Touch classes. That means all UIKit classes ultimately come from NSObject, including all of UIKit. </p>
<h1 id="Data"><a href="#Data" class="headerlink" title="Data"></a>Data</h1><h2 id="Data-contentsOf-URL"><a href="#Data-contentsOf-URL" class="headerlink" title="Data(contentsOf: URL)"></a>Data(contentsOf: URL)</h2><p>从特定url取得数据</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">viewDidLoad</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// let urlString = &quot;https://api.whitehouse.gov/v1/petitions.json?limit=100&quot;</span></span><br><span class="line">    <span class="keyword">let</span> urlString <span class="operator">=</span> <span class="string">&quot;https://www.hackingwithswift.com/samples/petitions-1.json&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> url <span class="operator">=</span> <span class="type">URL</span>(string: urlString) &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> data <span class="operator">=</span> <span class="keyword">try?</span> <span class="type">Data</span>(contentsOf: url) &#123;</span><br><span class="line">            <span class="comment">// we&#x27;re OK to parse!</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Data-write-to"><a href="#Data-write-to" class="headerlink" title="Data.write(to:)"></a>Data.write(to:)</h2><p>下面是通过UIImagePickerController取得照片后写入本地的一个例子：<br>见 UIImagePickerController –&gt; 一般示例代码 <a href="#%E4%B8%80%E8%88%AC%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81">跳转到</a></p>
<h1 id="UIView"><a href="#UIView" class="headerlink" title="UIView"></a>UIView</h1><p>UIView是UIKit框架里面最基础的视图类，UIView类定义了一个矩形的区域，并管理该区域内的所有屏幕显示。<br>UIView is the parent class of all of UIKit’s view types: labels, buttons, progress views, and more.<br>程序启动后，创建的第一个视图就是UIWindow，接着创建视图控制器的view，并把view放到UIWindow上，于是控制器的view就显示在屏幕上了。</p>
<p>所以我们可以这样使用UIView():</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">loadView</span>() &#123;</span><br><span class="line">    view <span class="operator">=</span> <span class="type">UIView</span>()</span><br><span class="line">    view.backgroundColor <span class="operator">=</span> .white</span><br><span class="line"></span><br><span class="line">    <span class="comment">// more code to come!</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Previously we assigned a WKWebView instance directly as our view, meaning that it automatically took up all the space. Here, though, we’re going to be adding lots of child views and positioning them by hand, so we need a big, empty canvas to work with.</p>
<p>下面是在一个UIView()的基础上再添加一个UIView()</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// buttonsView是为了后续添加大量UIButton进行显示的一个容器view</span></span><br><span class="line"><span class="keyword">let</span> buttonsView <span class="operator">=</span> <span class="type">UIView</span>()</span><br><span class="line">buttonsView.translatesAutoresizingMaskIntoConstraints <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">view.addSubview(buttonsView)</span><br></pre></td></tr></table></figure>

<h2 id="tintColor"><a href="#tintColor" class="headerlink" title="tintColor"></a>tintColor</h2><p>任何UIView子类的tintColor属性,可以改变应用在其上的颜色效果,但具体什么效果,取决于你应用在什么上面。<br>在navigationBar和tab bars上面,意味着改变button上的text和icons的颜色;<br>在text views上面,意味着改变被选择和高亮的text部分的颜色;<br>在progress bars上面,意味着改变它的track color(这是不是progress前半进程的颜色？)的颜色。<br>在tableView的cell上面,改变的就是在editing模式下,选择区域的颜色,具体见tableView的tintColor一块的笔记。</p>
<h3 id="设置单个页面的tintColor"><a href="#设置单个页面的tintColor" class="headerlink" title="设置单个页面的tintColor"></a>设置单个页面的tintColor</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">viewDidLoad</span>() &#123;</span><br><span class="line">    view.tintColor <span class="operator">=</span> <span class="type">UIColor</span>.red</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="设置项目中所有views的tint-–-需要在AppDelegate-swift中设置"><a href="#设置项目中所有views的tint-–-需要在AppDelegate-swift中设置" class="headerlink" title="设置项目中所有views的tint – 需要在AppDelegate.swift中设置"></a>设置项目中所有views的tint – 需要在AppDelegate.swift中设置</h3><p>AppDelegate.swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">application</span>(<span class="keyword">_</span> <span class="params">application</span>: <span class="type">UIApplication</span>, <span class="params">didFinishLaunchingWithOptions</span> <span class="params">launchOptions</span>: [<span class="type">UIApplication</span>.<span class="params">LaunchOptionsKey</span>: <span class="keyword">Any</span>]<span class="operator">?</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="comment">// Override point for customization after application launch.</span></span><br><span class="line">    window<span class="operator">?</span>.tintColor <span class="operator">=</span> <span class="type">UIColor</span>.red</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="UITableViewController"><a href="#UITableViewController" class="headerlink" title="UITableViewController"></a>UITableViewController</h1><h2 id="需要实现的方法"><a href="#需要实现的方法" class="headerlink" title="需要实现的方法"></a>需要实现的方法</h2><h3 id="override-func-tableView-tableView-UITableView-numberOfRowsInSection-section-Int-gt-Int"><a href="#override-func-tableView-tableView-UITableView-numberOfRowsInSection-section-Int-gt-Int" class="headerlink" title="override func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -&gt; Int { }"></a>override func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -&gt; Int { }</h3><h3 id="override-func-tableView-tableView-UITableView-cellForRowAt-indexPath-IndexPath-gt-UITableViewCell"><a href="#override-func-tableView-tableView-UITableView-cellForRowAt-indexPath-IndexPath-gt-UITableViewCell" class="headerlink" title="override func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -&gt; UITableViewCell { }"></a>override func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -&gt; UITableViewCell { }</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">tableView</span>(<span class="keyword">_</span> <span class="params">tableView</span>: <span class="type">UITableView</span>, <span class="params">cellForRowAt</span> <span class="params">indexPath</span>: <span class="type">IndexPath</span>) -&gt; <span class="type">UITableViewCell</span> &#123;</span><br><span class="line">    <span class="comment">// 在IB中的cell设置中必须注明Identifier是&quot;Picture&quot;</span></span><br><span class="line">    <span class="keyword">let</span> cell <span class="operator">=</span> tableView.dequeueReusableCell(withIdentifier: <span class="string">&quot;Picture&quot;</span>, for: indexPath)</span><br><span class="line">    cell.textLabel<span class="operator">?</span>.text <span class="operator">=</span> pictures[indexPath.row]</span><br><span class="line">    <span class="keyword">return</span> cell</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="可以实现的方法"><a href="#可以实现的方法" class="headerlink" title="可以实现的方法"></a>可以实现的方法</h2><h3 id="override-func-tableView-tableView-UITableView-didSelectRowAt-indexPath-IndexPath"><a href="#override-func-tableView-tableView-UITableView-didSelectRowAt-indexPath-IndexPath" class="headerlink" title="override func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) { }"></a>override func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) { }</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">tableView</span>(<span class="keyword">_</span> <span class="params">tableView</span>: <span class="type">UITableView</span>, <span class="params">didSelectRowAt</span> <span class="params">indexPath</span>: <span class="type">IndexPath</span>) &#123;</span><br><span class="line">    <span class="comment">// 1: try loading the &quot;Detail&quot; view controller and typecasting it to be DetailViewController</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> vc <span class="operator">=</span> storyboard<span class="operator">?</span>.instantiateViewController(withIdentifier: <span class="string">&quot;Detail&quot;</span>) <span class="keyword">as?</span> <span class="type">DetailViewController</span> &#123;</span><br><span class="line">        <span class="comment">// 2: success! Set its selectedImage property</span></span><br><span class="line">        vc.selectedImage <span class="operator">=</span> pictures[indexPath.row]</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3: now push it onto the navigation controller</span></span><br><span class="line">        navigationController<span class="operator">?</span>.pushViewController(vc, animated: <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="override-func-tableView-tableView-UITableView-commit-editingStyle-UITableViewCell-EditingStyle-forRowAt-indexPath-IndexPath"><a href="#override-func-tableView-tableView-UITableView-commit-editingStyle-UITableViewCell-EditingStyle-forRowAt-indexPath-IndexPath" class="headerlink" title="override func tableView(_ tableView: UITableView, commit editingStyle: UITableViewCell.EditingStyle, forRowAt indexPath: IndexPath) { }"></a>override func tableView(_ tableView: UITableView, commit editingStyle: UITableViewCell.EditingStyle, forRowAt indexPath: IndexPath) { }</h3><p>可以划动删除&#x2F;添加的操作。（在模拟器上没有成功,但在真机上向左划动会出现”删除”字样。）</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">tableView</span>(<span class="keyword">_</span> <span class="params">tableView</span>: <span class="type">UITableView</span>, <span class="params">commit</span> <span class="params">editingStyle</span>: <span class="type">UITableViewCell</span>.<span class="type">EditingStyle</span>, <span class="params">forRowAt</span> <span class="params">indexPath</span>: <span class="type">IndexPath</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> editingStyle <span class="operator">==</span> .delete &#123;</span><br><span class="line">        objects.remove(at: indexPath.row)</span><br><span class="line">        tableView.deleteRows(at: [indexPath], with: .fade)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> editingStyle <span class="operator">==</span> .insert &#123;</span><br><span class="line">        <span class="comment">// Create a new instance of the appropriate class, insert it into the array, and add a new row to the table view.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="tableView-layoutMargins-x2F-tableView-separatorInset-x2F-UIEdgeInsets-–-修改边缘的空白空间的大小"><a href="#tableView-layoutMargins-x2F-tableView-separatorInset-x2F-UIEdgeInsets-–-修改边缘的空白空间的大小" class="headerlink" title="tableView.layoutMargins &#x2F; tableView.separatorInset &#x2F; UIEdgeInsets – 修改边缘的空白空间的大小"></a>tableView.layoutMargins &#x2F; tableView.separatorInset &#x2F; UIEdgeInsets – 修改边缘的空白空间的大小</h2><p>未设置前:<br><img src="/../Images/withoutUIEdgeInsets.png" alt="withoutUIEdgeInsets.png"></p>
<p>在viewDidLoad()中加入代码:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tableView.layoutMargins -- the default spacing to use when laying out content in the view.</span></span><br><span class="line">tableView.layoutMargins <span class="operator">=</span> <span class="type">UIEdgeInsets</span>.zero</span><br><span class="line"><span class="comment">// tableView.separatorInset -- the default inset of cell separators.</span></span><br><span class="line">tableView.separatorInset <span class="operator">=</span> <span class="type">UIEdgeInsets</span>.zero</span><br></pre></td></tr></table></figure>
<p>在tableView的cellForRowAt方法中加入代码:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里是给每个cell设置layoutMargins</span></span><br><span class="line">cell.layoutMargins <span class="operator">=</span> <span class="type">UIEdgeInsets</span>.zero</span><br></pre></td></tr></table></figure>
<p>设置后的效果:<br><img src="/Images/withUIEdgeInsets.png" alt="WithUIEdgeInsets"></p>
<h2 id="tableView-backgroundColor-–-设置tableView的底色"><a href="#tableView-backgroundColor-–-设置tableView的底色" class="headerlink" title="tableView.backgroundColor – 设置tableView的底色"></a>tableView.backgroundColor – 设置tableView的底色</h2><p>将某张图片设置tableView的底色,并编排该底色</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> backgroundImage <span class="operator">=</span> <span class="type">UIImage</span>(named: <span class="string">&quot;white_wall&quot;</span>) &#123;</span><br><span class="line">    tableView.backgroundColor <span class="operator">=</span> <span class="type">UIColor</span>(patternImage: backgroundImage)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="tableView-allowsMultipleSelection-–-除了编辑状态下-允许多行选定"><a href="#tableView-allowsMultipleSelection-–-除了编辑状态下-允许多行选定" class="headerlink" title="tableView.allowsMultipleSelection – 除了编辑状态下,允许多行选定"></a>tableView.allowsMultipleSelection – 除了编辑状态下,允许多行选定</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tableView.allowsMultipleSelection <span class="operator">=</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h2 id="tableView-allowsMultipleSelectionDuringEditing-–-编辑状态下允许多行选定"><a href="#tableView-allowsMultipleSelectionDuringEditing-–-编辑状态下允许多行选定" class="headerlink" title="tableView.allowsMultipleSelectionDuringEditing – 编辑状态下允许多行选定"></a>tableView.allowsMultipleSelectionDuringEditing – 编辑状态下允许多行选定</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tableView.allowsMultipleSelectionDuringEditing <span class="operator">=</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h2 id="tableView-reloadData"><a href="#tableView-reloadData" class="headerlink" title="tableView.reloadData()"></a>tableView.reloadData()</h2><p>Reloads the rows and sections of the table view:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tableView.reloadData()</span><br></pre></td></tr></table></figure>

<h2 id="override-func-setEditing-editing-Bool-animated-Bool-–-默认"><a href="#override-func-setEditing-editing-Bool-animated-Bool-–-默认" class="headerlink" title="override func setEditing(_ editing: Bool, animated: Bool) {} – 默认"></a>override func setEditing(_ editing: Bool, animated: Bool) {} – 默认</h2><p>这是个默认在tableView中会实现的方法,一般不需要去修改它。<br>比如你定义了一个UIBarButtonItem:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">editButton <span class="operator">=</span> <span class="type">UIBarButtonItem</span>(barButtonSystemItem: .edit, target: <span class="keyword">self</span>, action: <span class="keyword">#selector</span>(enterEditingMode))</span><br></pre></td></tr></table></figure>
<p>若点击该edit的button,就会自动调用到setEditing方法。<br>setEditing(true, animated: true) – 就是出现editing模式;<br>setEditing(false, animated: true) – 就是取消editing模式。</p>
<p>那么,什么时候需要覆写该setEditing方法呢?<br>比如当你想点击该edit按钮后,你想让toolbarItems出现你自定义的按钮,包括你想取消editing模式时,又出现toolbarItems自定义的其他按钮,那你就可以去使用它,但每次覆写都必须实现super.setEditing(editing, animated: animated):</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点击edit按钮调用的方法:</span></span><br><span class="line"><span class="keyword">@objc</span> <span class="keyword">func</span> <span class="title function_">enterEditingMode</span>() &#123;</span><br><span class="line">    navigationItem.rightBarButtonItems <span class="operator">=</span> [cancelButton]</span><br><span class="line"><span class="comment">//        toolbarItems = [spacerButton, deleteAllButton]</span></span><br><span class="line">    setEditing(<span class="literal">true</span>, animated: <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取消edit模式调用的方法:</span></span><br><span class="line"><span class="keyword">@objc</span> <span class="keyword">func</span> <span class="title function_">cancelEditingMode</span>() &#123;</span><br><span class="line">    navigationItem.rightBarButtonItems <span class="operator">=</span> [editButtonItem]</span><br><span class="line"><span class="comment">//        toolbarItems = [spacerButton, notesCountButton, spacerButton, newNoteButton]</span></span><br><span class="line">    setEditing(<span class="literal">false</span>, animated: <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">setEditing</span>(<span class="keyword">_</span> <span class="params">editing</span>: <span class="type">Bool</span>, <span class="params">animated</span>: <span class="type">Bool</span>) &#123; <span class="comment">// ??</span></span><br><span class="line">    <span class="keyword">super</span>.setEditing(editing, animated: animated)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> editing &#123;</span><br><span class="line">        toolbarItems <span class="operator">=</span> [spacerButton]</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        toolbarItems <span class="operator">=</span> [spacerButton, notesCountButton, spacerButton, newNoteButton]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="tableView-isEditing-–-反映tableView是否在editing模式"><a href="#tableView-isEditing-–-反映tableView是否在editing模式" class="headerlink" title="tableView.isEditing – 反映tableView是否在editing模式"></a>tableView.isEditing – 反映tableView是否在editing模式</h2><p>tableView.isEditing is a boolean value that determines whether the table view is in editing mode.<br>例子请结合 tableView.indexPathsForSelectedRows 一起看。</p>
<h2 id="tableView-indexPathsForSelectedRows"><a href="#tableView-indexPathsForSelectedRows" class="headerlink" title="tableView.indexPathsForSelectedRows"></a>tableView.indexPathsForSelectedRows</h2><p>The index paths that represent the selected rows. 就是一个所有被选中cell的index列表。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">tableView</span>(<span class="keyword">_</span> <span class="params">tableView</span>: <span class="type">UITableView</span>, <span class="params">didDeselectRowAt</span> <span class="params">indexPath</span>: <span class="type">IndexPath</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> tableView.isEditing &#123;</span><br><span class="line">        <span class="keyword">if</span> tableView.indexPathsForSelectedRows <span class="operator">==</span> <span class="literal">nil</span> <span class="operator">||</span> tableView.indexPathsForSelectedRows<span class="operator">!</span>.isEmpty &#123;</span><br><span class="line">            toolbarItems <span class="operator">=</span> [spacerButton, deleteAllButton]</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 其他代码省略</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="tableView-indexPathForSelectedRow-–-返回被选中列的IndexPath"><a href="#tableView-indexPathForSelectedRow-–-返回被选中列的IndexPath" class="headerlink" title="tableView.indexPathForSelectedRow – 返回被选中列的IndexPath"></a>tableView.indexPathForSelectedRow – 返回被选中列的IndexPath</h2><h2 id="cell-selectedBackgroundView-–-设置cell在选中状态下的背景view"><a href="#cell-selectedBackgroundView-–-设置cell在选中状态下的背景view" class="headerlink" title="cell.selectedBackgroundView – 设置cell在选中状态下的背景view"></a>cell.selectedBackgroundView – 设置cell在选中状态下的背景view</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cell: UITableViewCell</span></span><br><span class="line"><span class="comment">// selectedCellView: UIView?</span></span><br><span class="line">cell.selectedBackgroundView <span class="operator">=</span> selectedCellView</span><br></pre></td></tr></table></figure>

<h2 id="cell-multipleSelectionBackgroundView-–-设置cell在被多选状态下的背景view"><a href="#cell-multipleSelectionBackgroundView-–-设置cell在被多选状态下的背景view" class="headerlink" title="cell.multipleSelectionBackgroundView – 设置cell在被多选状态下的背景view"></a>cell.multipleSelectionBackgroundView – 设置cell在被多选状态下的背景view</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cell: UITableViewCell</span></span><br><span class="line"><span class="keyword">let</span> multipleSelectedCellView <span class="operator">=</span> <span class="type">UIView</span>()</span><br><span class="line">multipleSelectedCellView.backgroundColor <span class="operator">=</span> <span class="type">UIColor</span>.orange.withAlphaComponent(<span class="number">0.2</span>)</span><br><span class="line">cell.multipleSelectionBackgroundView <span class="operator">=</span> multipleSelectedCellView</span><br></pre></td></tr></table></figure>

<h2 id="UITableViewCell-tintColor-–-cell在editing模式下选择区域的背景颜色"><a href="#UITableViewCell-tintColor-–-cell在editing模式下选择区域的背景颜色" class="headerlink" title="UITableViewCell.tintColor – cell在editing模式下选择区域的背景颜色"></a>UITableViewCell.tintColor – cell在editing模式下选择区域的背景颜色</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cell: UITableViewCell</span></span><br><span class="line">cell.tintColor <span class="operator">=</span> .orange</span><br></pre></td></tr></table></figure>
<p><img src="/images/cell-tintColor.gif" alt="cell-tintColor"></p>
<h1 id="UIImage"><a href="#UIImage" class="headerlink" title="UIImage"></a>UIImage</h1><h2 id="生成UIImage的方法"><a href="#生成UIImage的方法" class="headerlink" title="生成UIImage的方法"></a>生成UIImage的方法</h2><h3 id="UIImage-named"><a href="#UIImage-named" class="headerlink" title="UIImage(named:)"></a>UIImage(named:)</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> imageName <span class="operator">=</span> <span class="string">&quot;nssl0042.jpg&quot;</span></span><br><span class="line"><span class="keyword">let</span> image <span class="operator">=</span> <span class="type">UIImage</span>(named: imageName)</span><br></pre></td></tr></table></figure>

<h1 id="UINavigationController"><a href="#UINavigationController" class="headerlink" title="UINavigationController"></a>UINavigationController</h1><p>Declaration:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MainActor</span> <span class="keyword">class</span> <span class="title class_">UINavigationController</span> : <span class="title class_">UIViewController</span></span><br></pre></td></tr></table></figure>

<h2 id="title-标题"><a href="#title-标题" class="headerlink" title="title - 标题"></a>title - 标题</h2><p>直接在页面使用 title &#x3D; “ I’m the title, etc. “ 即可。</p>
<h3 id="largeTitle"><a href="#largeTitle" class="headerlink" title="largeTitle"></a>largeTitle</h3><p>在UINavigationController中,title的default style都是small text,那么如何设置成largeTitle呢?</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">navigationController<span class="operator">?</span>.navigationBar.prefersLargeTitles <span class="operator">=</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>以上。</p>
<p>那么,一些类似detail的页面不需要largeTitle而主页面需要的情况下,该怎么设置呢？<br>只要在detail页面加入代码:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">navigationItem.largeTitleDisplayMode <span class="operator">=</span> .never</span><br></pre></td></tr></table></figure>
<p>以上。</p>
<h2 id="UINavigationBar"><a href="#UINavigationBar" class="headerlink" title="UINavigationBar"></a>UINavigationBar</h2><p>By default, a UINavigationController has a bar across the top, called a UINavigationBar, and as developers we can add buttons to this navigation bar that call our methods.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">navigationItem.rightBarButtonItem <span class="operator">=</span> <span class="type">UIBarButtonItem</span>(barButtonSystemItem: .action, target: <span class="keyword">self</span>, action: <span class="keyword">#selector</span>(shareTapped))</span><br></pre></td></tr></table></figure>
<p>这里选择的是barButtonSystemItem: .action, 可以选择其他的,比如 .cancel &#x2F; .done &#x2F; .add &#x2F; .camera &#x2F;.bookmarks &#x2F;.edit 等等很多其他的。</p>
<p>还可以让图标自定义显示:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">navigationItem.leftBarButtonItem <span class="operator">=</span> <span class="type">UIBarButtonItem</span>(title: <span class="string">&quot;Score&quot;</span>, style: .plain, target: <span class="keyword">self</span>, action: <span class="keyword">#selector</span>(showScore))</span><br></pre></td></tr></table></figure>
<p>该自定义的图标可设置样式:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">navigationItem.leftBarButtonItem.setTitleTextAttributes([<span class="type">NSAttributedString</span>.<span class="type">Key</span>.font: <span class="type">UIFont</span>.systemFont(ofSize: <span class="number">11</span>), <span class="type">NSAttributedString</span>.<span class="type">Key</span>.foregroundColor : <span class="type">UIColor</span>.darkText], for: .normal)</span><br></pre></td></tr></table></figure>

<h3 id="点击页面即隐藏或显示navigationBar"><a href="#点击页面即隐藏或显示navigationBar" class="headerlink" title="点击页面即隐藏或显示navigationBar"></a>点击页面即隐藏或显示navigationBar</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">viewWillAppear</span>(<span class="keyword">_</span> <span class="params">animated</span>: <span class="type">Bool</span>) &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewWillAppear(animated)</span><br><span class="line">    navigationController<span class="operator">?</span>.hidesBarsOnTap <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">viewWillDisappear</span>(<span class="keyword">_</span> <span class="params">animated</span>: <span class="type">Bool</span>) &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewWillDisappear(animated)</span><br><span class="line">    navigationController<span class="operator">?</span>.hidesBarsOnTap <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在显示该页面时,即开启点击页面任何处可隐藏navigationBar,再点击可显示navigationBar的功能。<br>但为何在viewWillDisappear中还要取消该功能?<br>想想这样的场景,在detail页面可观看一张图片,点击可显示&#x2F;隐藏navigationBar,但如果你点击返回退回到前一页(可能是主页面),该页面并不需要隐藏navigationBar,但却在navigationController中开启了该功能,会非常的不好,所以需要取消。</p>
<h2 id="Disclosure-Indicator"><a href="#Disclosure-Indicator" class="headerlink" title="Disclosure Indicator"></a>Disclosure Indicator</h2><p>Disclosure Indicator 即如下图每个cell右边的箭头(&gt;)符号:<br><img src="/Images/disclosureIndicator.png" alt="disclosureIndicator"><br>如何设置显示或不显示:<br>在storyBoard中选中cell,在其的属性中的Accessory中去设置:<br><img src="/Images/accesoryOfCell.png" alt="accesoryOfCell"><br>可以看到我们选择的是DisclosureIndicator,还有DetailDisclosure&#x2F;Checkmark&#x2F;Detail都是很好的选择,主要看所使用的场景。</p>
<h2 id="UINavigationController-的-popViewController-x2F-pushViewController"><a href="#UINavigationController-的-popViewController-x2F-pushViewController" class="headerlink" title="UINavigationController? 的 popViewController &#x2F; pushViewController"></a>UINavigationController? 的 popViewController &#x2F; pushViewController</h2><p>UINavigationController是IOS编程中的一个view controller的容器，通过栈管理viewControllers，每一次pushViewController操作都将在栈顶添加一个view controller，然后通过popViewController将该栈最顶端的controller移除。<br>上面说的栈最顶端是这样的,navigationController?.viewControllers中保存着所有的view controller,你push进去一个view controller,就放在这个列表的最后面,你pop的话,也是将列表的最后面那个view controller删除。这就是栈的后进先出的概念。</p>
<p>这里自己写了个例子:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ViewController.swift</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ViewController</span>: <span class="title class_">UIViewController</span> &#123;</span><br><span class="line">    <span class="keyword">@IBOutlet</span> <span class="keyword">var</span> textView: <span class="type">UITextView</span>!</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">viewDidLoad</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        </span><br><span class="line">        navigationItem.rightBarButtonItem <span class="operator">=</span> <span class="type">UIBarButtonItem</span>(barButtonSystemItem: .action, target: <span class="keyword">self</span>, action: <span class="keyword">#selector</span>(toDetailView))</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(navigationController<span class="operator">?</span>.viewControllers)</span><br><span class="line">        <span class="comment">// Optional([&lt;SwiftTest001.ViewController: 0x117e07490&gt;])</span></span><br><span class="line">        <span class="comment">// 一个ViewController</span></span><br><span class="line"></span><br><span class="line">        navigationController<span class="operator">?</span>.popViewController(animated: <span class="literal">true</span>)</span><br><span class="line">        <span class="comment">// 这里pop了,为什么下面显示的栈里面还是有一个ViewController?</span></span><br><span class="line">        <span class="comment">// 感觉是因为栈里总得有一个ViewController吧,</span></span><br><span class="line">        <span class="comment">// 所以这行代码是没有意义的。</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(navigationController<span class="operator">?</span>.viewControllers)</span><br><span class="line">        <span class="comment">// Optional([&lt;SwiftTest001.ViewController: 0x117e07490&gt;])</span></span><br><span class="line">        <span class="comment">// 还是原来那个ViewController</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">@objc</span> <span class="keyword">func</span> <span class="title function_">toDetailView</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> vc <span class="operator">=</span> storyboard<span class="operator">?</span>.instantiateViewController(withIdentifier: <span class="string">&quot;Detail&quot;</span>) <span class="keyword">as?</span> <span class="type">DetailViewController</span> &#123;</span><br><span class="line">            navigationController<span class="operator">?</span>.pushViewController(vc, animated: <span class="literal">true</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// DetailViewController.swift</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DetailViewController</span>: <span class="title class_">UIViewController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">viewDidLoad</span>() &#123;</span><br><span class="line">        navigationItem.leftBarButtonItem <span class="operator">=</span> <span class="type">UIBarButtonItem</span>(barButtonSystemItem: .cancel, target: <span class="keyword">self</span>, action: <span class="keyword">#selector</span>(deleteTopView))</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(navigationController<span class="operator">?</span>.viewControllers)</span><br><span class="line">        <span class="comment">// Optional([&lt;SwiftTest001.ViewController: 0x117e07490&gt;, &lt;SwiftTest001.DetailViewController: 0x117e22d20&gt;])</span></span><br><span class="line">        <span class="comment">// 有二个ViewController了,栈顶就是这个DetailViewController</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">@objc</span> <span class="keyword">func</span> <span class="title function_">deleteTopView</span>() &#123;</span><br><span class="line">        navigationController<span class="operator">?</span>.popViewController(animated: <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(navigationController<span class="operator">?</span>.viewControllers)</span><br><span class="line">        <span class="comment">// Optional([&lt;SwiftTest001.ViewController: 0x117e07490&gt;])</span></span><br><span class="line">        <span class="comment">// 又回到原来的那个ViewController了,pop出的就是后进来的DetailViewController了。</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="UIButton"><a href="#UIButton" class="headerlink" title="UIButton"></a>UIButton</h1><h2 id="设置UIButton上的文字-–-setTitle"><a href="#设置UIButton上的文字-–-setTitle" class="headerlink" title="设置UIButton上的文字 – .setTitle()"></a>设置UIButton上的文字 – .setTitle()</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> submit <span class="operator">=</span> <span class="type">UIButton</span>(type: .system)</span><br><span class="line">submit.translatesAutoresizingMaskIntoConstraints <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"><span class="comment">// 设置显示的文字</span></span><br><span class="line">submit.setTitle(<span class="string">&quot;SUBMIT&quot;</span>, for: .normal)</span><br><span class="line">view.addSubview(submit)</span><br></pre></td></tr></table></figure>

<h2 id="在UIButton上设置UIImage"><a href="#在UIButton上设置UIImage" class="headerlink" title="在UIButton上设置UIImage"></a>在UIButton上设置UIImage</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 前提是,button1是UIButton类型的按钮</span></span><br><span class="line">button1.setImage(<span class="type">UIImage</span>(named: countries[<span class="number">0</span>]), for: .normal)</span><br></pre></td></tr></table></figure>

<h2 id="设置UIButton的边框粗细"><a href="#设置UIButton的边框粗细" class="headerlink" title="设置UIButton的边框粗细"></a>设置UIButton的边框粗细</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">button1.layer.borderWidth <span class="operator">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>our border will be 1 pixel on non-retina devices, 2 pixels on retina devices, and 3 on retina HD devices. </p>
<h2 id="设置UIButton的边框颜色"><a href="#设置UIButton的边框颜色" class="headerlink" title="设置UIButton的边框颜色"></a>设置UIButton的边框颜色</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">button1.layer.borderColor <span class="operator">=</span> <span class="type">UIColor</span>.lightGray.cgColor</span><br></pre></td></tr></table></figure>
<p>By default, the border of CALayer is black, but you can change that if you want by using the UIColor data type. I said that CALayer brings with it a little more complexity, and here’s where it starts to be visible: CALayer sits at a lower technical level than UIButton, which means it doesn’t understand what a UIColor is. UIButton knows what a UIColor is because they are both at the same technical level, but CALayer is below UIButton, so UIColor is a mystery.</p>
<p>Don’t despair, though: CALayer has its own way of setting colors called CGColor, which comes from Apple’s Core Graphics framework. This, like CALayer, is at a lower level than UIButton, so the two can talk happily – again, as long as you’re happy with the extra complexity.</p>
<p>Even better, UIColor (which sits above CGColor) is able to convert to and from CGColor easily, which means you don’t need to worry about the complexity.</p>
<p>以上的颜色也可以写成这种表现形式:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UIColor</span>(red: <span class="number">1.0</span>, green: <span class="number">0.6</span>, blue: <span class="number">0.2</span>, alpha: <span class="number">1.0</span>).cgColor</span><br></pre></td></tr></table></figure>

<h2 id="设置UIButton的大小"><a href="#设置UIButton的大小" class="headerlink" title="设置UIButton的大小"></a>设置UIButton的大小</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> letterButton <span class="operator">=</span> <span class="type">UIButton</span>(type: .system)</span><br><span class="line">letterButton.setTitle(<span class="string">&quot;WWW&quot;</span>, for: .normal)</span><br><span class="line"><span class="keyword">let</span> frame <span class="operator">=</span> <span class="type">CGRect</span>(x: col <span class="operator">*</span> width, y: row <span class="operator">*</span> height, width: width, height: height)</span><br><span class="line">letterButton.frame <span class="operator">=</span> frame</span><br></pre></td></tr></table></figure>


<h2 id="通过IB来创建UIButton的Action方法"><a href="#通过IB来创建UIButton的Action方法" class="headerlink" title="通过IB来创建UIButton的Action方法"></a>通过IB来创建UIButton的Action方法</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/read/2/5/from-outlets-to-actions-creating-an-ibaction">https://www.hackingwithswift.com/read/2/5/from-outlets-to-actions-creating-an-ibaction</a></p>
</blockquote>
<p>在IB中通过ctrl拉动UIButton按钮至assistant页面中,跳出页面选项选择Connection:Action而非Connection:Outlet。</p>
<p>会生成按钮点击的@IBAction方法:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@IBAction</span> <span class="keyword">func</span> <span class="title function_">buttonTapped</span>(<span class="keyword">_</span> <span class="params">sender</span>: <span class="type">UIButton</span>) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过此方法,可以使多个按钮使用同一方法的情况。<br>注意:有可能上面的sender的属性是Any,这时候最好把Any改成UIButton。</p>
<h2 id="如何在多个按钮使用同一方法的情况下-识别是哪个按钮被点击"><a href="#如何在多个按钮使用同一方法的情况下-识别是哪个按钮被点击" class="headerlink" title="如何在多个按钮使用同一方法的情况下,识别是哪个按钮被点击?"></a>如何在多个按钮使用同一方法的情况下,识别是哪个按钮被点击?</h2><p>在IB界面的这个UIButton属性中设置其的tag为一个唯一的数字:<br><img src="/Images/tagOfUIButton.webp" alt="tagOfUIButton"></p>
<p>随后在这个UIButton按钮的action中可查看其的tag:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@IBAction</span> <span class="keyword">func</span> <span class="title function_">buttonTapped</span>(<span class="keyword">_</span> <span class="params">sender</span>: <span class="type">UIButton</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(sender.tag)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="sender-isHidden-的Bool值-让UIButton隐身"><a href="#sender-isHidden-的Bool值-让UIButton隐身" class="headerlink" title="sender.isHidden 的Bool值 让UIButton隐身"></a>sender.isHidden 的Bool值 让UIButton隐身</h2><p>在 @IBAction func buttonTapped(_ sender: UIButton) { 中<br>设置sender.isHidden &#x3D; true 或者 false 可让该UIButton隐藏或显示。</p>
<h2 id="通过代码来给UIButton-添加action"><a href="#通过代码来给UIButton-添加action" class="headerlink" title="通过代码来给UIButton()添加action"></a>通过代码来给UIButton()添加action</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> submit <span class="operator">=</span> <span class="type">UIButton</span>(type: .system)</span><br><span class="line">submit.translatesAutoresizingMaskIntoConstraints <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">submit.setTitle(<span class="string">&quot;SUBMIT&quot;</span>, for: .normal)</span><br><span class="line">view.addSubview(submit)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为submit按钮添加一个objc类型的submitTapped方法,而且激活按钮要求是.touchUpInside,即按钮按下并松开时,松开手势得在按钮正上方</span></span><br><span class="line">submit.addTarget(<span class="keyword">self</span>, action: <span class="keyword">#selector</span>(submitTapped), for: .touchUpInside)</span><br><span class="line"></span><br><span class="line"><span class="keyword">@objc</span> <span class="keyword">func</span> <span class="title function_">submitTapped</span>(<span class="keyword">_</span> <span class="params">sender</span>: <span class="type">UIButton</span>) &#123; &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="让UIButton-隐藏但仍占据位置"><a href="#让UIButton-隐藏但仍占据位置" class="headerlink" title="让UIButton()隐藏但仍占据位置"></a>让UIButton()隐藏但仍占据位置</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> submit <span class="operator">=</span> <span class="type">UIButton</span>(type: .system)</span><br><span class="line">submit.translatesAutoresizingMaskIntoConstraints <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">submit.setTitle(<span class="string">&quot;SUBMIT&quot;</span>, for: .normal)</span><br><span class="line">view.addSubview(submit)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 隐藏该submit按钮但仍旧占位</span></span><br><span class="line">submit.isHidden <span class="operator">=</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h1 id="UIAlertController"><a href="#UIAlertController" class="headerlink" title="UIAlertController"></a>UIAlertController</h1><h2 id="一般使用"><a href="#一般使用" class="headerlink" title="一般使用"></a>一般使用</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ac <span class="operator">=</span> <span class="type">UIAlertController</span>(title: title, message: <span class="string">&quot;Your score is <span class="subst">\(score)</span>.&quot;</span>, preferredStyle: .alert)</span><br><span class="line">ac.addAction(<span class="type">UIAlertAction</span>(title: <span class="string">&quot;Continue&quot;</span>, style: .default, handler: askQuestion))</span><br><span class="line">present(ac, animated: <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对应的askQuestion方法</span></span><br><span class="line"><span class="comment">// 既设置了必要的action参数,也可在调用时不输入该参数。</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">askQuestion</span>(<span class="params">action</span>: <span class="type">UIAlertAction</span>! <span class="operator">=</span> <span class="literal">nil</span>) &#123; &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Apple recommends you use <strong>.alert</strong> when telling users about a situation change, and <strong>.actionSheet</strong> when asking them to choose from a set of options.</p>
<h2 id="像下面这样的方式-preferredStyle-actionSheet"><a href="#像下面这样的方式-preferredStyle-actionSheet" class="headerlink" title="像下面这样的方式 (preferredStyle: .actionSheet)"></a>像下面这样的方式 (preferredStyle: .actionSheet)</h2><p><img src="/Images/popoverPresentationController.gif" alt="popoverPresentationController"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">navigationItem.rightBarButtonItem <span class="operator">=</span> <span class="type">UIBarButtonItem</span>(title: <span class="string">&quot;Open&quot;</span>, style: .plain, target: <span class="keyword">self</span>, action: <span class="keyword">#selector</span>(openTapped))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">@objc</span> <span class="keyword">func</span> <span class="title function_">openTapped</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> ac <span class="operator">=</span> <span class="type">UIAlertController</span>(title: <span class="string">&quot;Open page…&quot;</span>, message: <span class="literal">nil</span>, preferredStyle: .actionSheet)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// var websites = [&quot;apple.com&quot;, &quot;hackingwithswift.com&quot;]</span></span><br><span class="line">    <span class="keyword">for</span> website <span class="keyword">in</span> websites &#123;</span><br><span class="line">        ac.addAction(<span class="type">UIAlertAction</span>(title: website, style: .default, handler: openPage))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ac.addAction(<span class="type">UIAlertAction</span>(title: <span class="string">&quot;Cancel&quot;</span>, style: .cancel, handler: <span class="literal">nil</span>))</span><br><span class="line">    <span class="comment">// 感觉主要是下面的代码,让菜单从下往上弹的。</span></span><br><span class="line">    <span class="comment">// 没感觉下面这行代码的意义,没有也一样可以,</span></span><br><span class="line">    <span class="comment">// 但看到的很多代码都有这一样,而且一般是哪个button点击后调用的,</span></span><br><span class="line">    <span class="comment">// 就设置ac.popoverPresentationController?.barButtonItem对应该button。</span></span><br><span class="line">    <span class="comment">// 但为啥要这么设置啊？？？？？？？？？？</span></span><br><span class="line">    ac.popoverPresentationController<span class="operator">?</span>.barButtonItem <span class="operator">=</span> <span class="keyword">self</span>.navigationItem.rightBarButtonItem</span><br><span class="line">    present(ac, animated: <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="添加TextField文本框供输入"><a href="#添加TextField文本框供输入" class="headerlink" title="添加TextField文本框供输入"></a>添加TextField文本框供输入</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@objc</span> <span class="keyword">func</span> <span class="title function_">promptForAnswer</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> ac <span class="operator">=</span> <span class="type">UIAlertController</span>(title: <span class="string">&quot;Enter answer&quot;</span>, message: <span class="literal">nil</span>, preferredStyle: .alert)</span><br><span class="line">    <span class="comment">// 可以添加不止一个TextField输入框</span></span><br><span class="line">    ac.addTextField()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> submitAction <span class="operator">=</span> <span class="type">UIAlertAction</span>(title: <span class="string">&quot;Submit&quot;</span>, style: .default) &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>, <span class="keyword">weak</span> ac] action <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> answer <span class="operator">=</span> ac<span class="operator">?</span>.textFields<span class="operator">?</span>[<span class="number">0</span>].text <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">        <span class="keyword">self</span><span class="operator">?</span>.submit(answer)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ac.addAction(submitAction)</span><br><span class="line">    present(ac, animated: <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="UIActivityViewController"><a href="#UIActivityViewController" class="headerlink" title="UIActivityViewController"></a>UIActivityViewController</h1><p>UIActivityViewController will automatically give us functionality to share by iMessage, by email and by Twitter and Facebook, as well as saving the image to the photo library, assigning it to contact, printing it out via AirPrint, and more. It even hooks into AirDrop and the iOS extensions system so that other apps can read the image straight from us.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">navigationItem.rightBarButtonItem <span class="operator">=</span> <span class="type">UIBarButtonItem</span>(barButtonSystemItem: .action, target: <span class="keyword">self</span>, action: <span class="keyword">#selector</span>(shareTapped))</span><br><span class="line"></span><br><span class="line"><span class="keyword">@objc</span> <span class="keyword">func</span> <span class="title function_">shareTapped</span>() &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> image <span class="operator">=</span> imageView.image<span class="operator">?</span>.jpegData(compressionQuality: <span class="number">0.8</span>) <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;No image found&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &quot;activityItems:&quot;是要传递的东西。这里传递的是一张图片。</span></span><br><span class="line">    <span class="keyword">let</span> vc <span class="operator">=</span> <span class="type">UIActivityViewController</span>(activityItems: [imageView.image<span class="operator">!</span>], applicationActivities: [])</span><br><span class="line">    <span class="comment">// 这里将vc.popoverPresentationController?.barButtonItem也绑定在navigationItem.rightBarButtonItem,</span></span><br><span class="line">    <span class="comment">// 感觉是,总得绑在一个触发的UIBarButtonItem上面,而只有这个正在被触发。</span></span><br><span class="line">    vc.popoverPresentationController<span class="operator">?</span>.barButtonItem <span class="operator">=</span> navigationItem.rightBarButtonItem</span><br><span class="line">    present(vc, animated: <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="若选择Save-Image-还需要编辑Info-plist"><a href="#若选择Save-Image-还需要编辑Info-plist" class="headerlink" title="若选择Save Image,还需要编辑Info.plist"></a>若选择Save Image,还需要编辑Info.plist</h2><p>在Info.plist中添加row,选择 “Privacy - Photo Library Additions Usage Description”, 添加String值类似“We need to save photos you like.”</p>
<h1 id="UIToolbar"><a href="#UIToolbar" class="headerlink" title="UIToolbar"></a>UIToolbar</h1><p>UIToolbar holds and shows a collection of UIBarButtonItem objects that the user can tap on. </p>
<p><img src="/Images/toolbarItems.png" alt="toolbarItems.png"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> spacer <span class="operator">=</span> <span class="type">UIBarButtonItem</span>(barButtonSystemItem: .flexibleSpace, target: <span class="literal">nil</span>, action: <span class="literal">nil</span>)</span><br><span class="line"><span class="keyword">let</span> refresh <span class="operator">=</span> <span class="type">UIBarButtonItem</span>(barButtonSystemItem: .refresh, target: webView, action: <span class="keyword">#selector</span>(webView.reload))</span><br><span class="line"></span><br><span class="line">toolbarItems <span class="operator">=</span> [spacer, refresh]</span><br><span class="line"><span class="comment">// 决定toolbarItems是否显示</span></span><br><span class="line">navigationController<span class="operator">?</span>.isToolbarHidden <span class="operator">=</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h2 id="toolbar的样式设定"><a href="#toolbar的样式设定" class="headerlink" title="toolbar的样式设定"></a>toolbar的样式设定</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> toolbar <span class="operator">=</span> navigationController<span class="operator">?</span>.toolbar <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// background: transparent</span></span><br><span class="line">toolbar.setBackgroundImage(<span class="type">UIImage</span>(), forToolbarPosition: .any, barMetrics: .default)</span><br><span class="line">toolbar.setShadowImage(<span class="type">UIImage</span>(), forToolbarPosition: .any)</span><br><span class="line">toolbar.isTranslucent <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// foreground</span></span><br><span class="line">toolbar.tintColor <span class="operator">=</span> .orange</span><br></pre></td></tr></table></figure>

<h1 id="WKWebView"><a href="#WKWebView" class="headerlink" title="WKWebView"></a>WKWebView</h1><h2 id="import"><a href="#import" class="headerlink" title="import"></a>import</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> WebKit</span><br></pre></td></tr></table></figure>

<h2 id="正常使用"><a href="#正常使用" class="headerlink" title="正常使用"></a>正常使用</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ViewController</span>: <span class="title class_">UIViewController</span>, <span class="title class_">WKNavigationDelegate</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> webView: <span class="type">WKWebView</span>!</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 为什么要在loadView()而非viewDidLoad()中加载webView,那是因为这个view需要直接load成功,而非load完后再去加载,感觉会造成资源浪费</span></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">loadView</span>() &#123;</span><br><span class="line">        webView <span class="operator">=</span> <span class="type">WKWebView</span>()</span><br><span class="line">        <span class="comment">// 因为下面这行,所以ViewController需要遵循WKNavigationDelegate !!!</span></span><br><span class="line">        webView.navigationDelegate <span class="operator">=</span> <span class="keyword">self</span></span><br><span class="line">        view <span class="operator">=</span> webView</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">viewDidLoad</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> url <span class="operator">=</span> <span class="type">URL</span>(string: <span class="string">&quot;https://www.hackingwithswift.com&quot;</span>)<span class="operator">!</span></span><br><span class="line">        webView.load(<span class="type">URLRequest</span>(url: url))</span><br><span class="line">        webView.allowsBackForwardNavigationGestures <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用webView加载内容-并显示出来"><a href="#使用webView加载内容-并显示出来" class="headerlink" title="使用webView加载内容,并显示出来"></a>使用webView加载内容,并显示出来</h2><p>显示效果是类似这样的:<br><img src="/Images/webViewLoadHtmlString.png" alt="webViewLoadHtmlString"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> WebKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Petition</span>: <span class="title class_">Codable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> title: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> signatureCount: <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DetailViewController</span>: <span class="title class_">UIViewController</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> webView: <span class="type">WKWebView</span>!</span><br><span class="line">    <span class="keyword">var</span> detailItem: <span class="type">Petition</span>?</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">loadView</span>() &#123;</span><br><span class="line">        webView <span class="operator">=</span> <span class="type">WKWebView</span>()</span><br><span class="line">        view <span class="operator">=</span> webView</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">viewDidLoad</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> detailItem <span class="operator">=</span> detailItem <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> html <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        &lt;html&gt;</span></span><br><span class="line"><span class="string">        &lt;head&gt;</span></span><br><span class="line"><span class="string">        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;style&gt; body &#123; font-size: 150%; &#125; &lt;/style&gt;</span></span><br><span class="line"><span class="string">        &lt;/head&gt;</span></span><br><span class="line"><span class="string">        &lt;body&gt;</span></span><br><span class="line"><span class="string">        <span class="subst">\(detailItem.body)</span></span></span><br><span class="line"><span class="string">        &lt;/body&gt;</span></span><br><span class="line"><span class="string">        &lt;/html&gt;</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        webView.loadHTMLString(html, baseURL: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="webView可实现的方法"><a href="#webView可实现的方法" class="headerlink" title="webView可实现的方法"></a>webView可实现的方法</h2><h3 id="func-webView-webView-WKWebView-didFinish-navigation-WKNavigation"><a href="#func-webView-webView-WKWebView-didFinish-navigation-WKNavigation" class="headerlink" title="func webView(_ webView: WKWebView, didFinish navigation: WKNavigation!) { }"></a>func webView(_ webView: WKWebView, didFinish navigation: WKNavigation!) { }</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">webView</span>(<span class="keyword">_</span> <span class="params">webView</span>: <span class="type">WKWebView</span>, <span class="params">didFinish</span> <span class="params">navigation</span>: <span class="type">WKNavigation</span>!) &#123;</span><br><span class="line">    title <span class="operator">=</span> webView.title</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可实现网页显示标题</p>
<h3 id="func-webView-webView-WKWebView-decidePolicyFor-navigationAction-WKNavigationAction-decisionHandler-escaping-WKNavigationActionPolicy-gt-Void"><a href="#func-webView-webView-WKWebView-decidePolicyFor-navigationAction-WKNavigationAction-decisionHandler-escaping-WKNavigationActionPolicy-gt-Void" class="headerlink" title="func webView(_ webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -&gt; Void) { }"></a>func webView(_ webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -&gt; Void) { }</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">webView</span>(<span class="keyword">_</span> <span class="params">webView</span>: <span class="type">WKWebView</span>, <span class="params">decidePolicyFor</span> <span class="params">navigationAction</span>: <span class="type">WKNavigationAction</span>, <span class="params">decisionHandler</span>: <span class="keyword">@escaping</span> (<span class="type">WKNavigationActionPolicy</span>) -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> url <span class="operator">=</span> navigationAction.request.url</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> host <span class="operator">=</span> url<span class="operator">?</span>.host &#123;</span><br><span class="line">        <span class="keyword">for</span> website <span class="keyword">in</span> websites &#123;</span><br><span class="line">            <span class="keyword">if</span> host.contains(website) &#123;</span><br><span class="line">                decisionHandler(.allow)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    decisionHandler(.cancel)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这方法就像是网页浏览器的过滤器,任何url都会在这边过滤一下,最终决定是decisionHandler(.allow)运行呢,还是decisionHandler(.cancel)拒绝呢。</p>
<h1 id="UIProgressView"><a href="#UIProgressView" class="headerlink" title="UIProgressView"></a>UIProgressView</h1><p>UIProgressView is a colored bar that shows how far a task is through its work, sometimes called a “progress bar.”</p>
<h2 id="实际案例-使用到addObserver-x2F-observeValue这两个观察者-x2F-处理者-即KVO"><a href="#实际案例-使用到addObserver-x2F-observeValue这两个观察者-x2F-处理者-即KVO" class="headerlink" title="实际案例 + 使用到addObserver&#x2F;observeValue这两个观察者&#x2F;处理者(即KVO)"></a>实际案例 + 使用到addObserver&#x2F;observeValue这两个观察者&#x2F;处理者(即KVO)</h2><p>通过网页的加载进度,直接反映在UIProgressView进度条上:</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/read/4/4/monitoring-page-loads-uitoolbar-and-uiprogressview">https://www.hackingwithswift.com/read/4/4/monitoring-page-loads-uitoolbar-and-uiprogressview</a></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> progressView: <span class="type">UIProgressView</span>!</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">loadView</span>() &#123;</span><br><span class="line">    webView <span class="operator">=</span> <span class="type">WKWebView</span>()</span><br><span class="line">    webView.navigationDelegate <span class="operator">=</span> <span class="keyword">self</span></span><br><span class="line">    view <span class="operator">=</span> webView</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">viewDidLoad</span>() &#123;</span><br><span class="line">    <span class="comment">// 省略其他代码</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> url <span class="operator">=</span> <span class="type">URL</span>(string: <span class="string">&quot;https://hackingwithswift.com&quot;</span>)<span class="operator">!</span></span><br><span class="line">	webView.load(<span class="type">URLRequest</span>(url: url))</span><br><span class="line"></span><br><span class="line">    progressView <span class="operator">=</span> <span class="type">UIProgressView</span>(progressViewStyle: .default)</span><br><span class="line">    progressView.sizeToFit()</span><br><span class="line">    <span class="keyword">let</span> progressButton <span class="operator">=</span> <span class="type">UIBarButtonItem</span>(customView: progressView)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这里就让progressButton占满toolbarItems这一整行</span></span><br><span class="line">    toolbarItems <span class="operator">=</span> [progressButton]</span><br><span class="line">    <span class="comment">// 决定toolbarItems是否显示</span></span><br><span class="line">    navigationController<span class="operator">?</span>.isToolbarHidden <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在这个被定位主view的webView中增加一个观察者,主要观察这个key--WKWebView.estimatedProgress,有变化就会被告知</span></span><br><span class="line">    webView.addObserver(<span class="keyword">self</span>, forKeyPath: <span class="keyword">#keyPath</span>(<span class="type">WKWebView</span>.estimatedProgress), options: .new, context: <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这是观察后实时进行处理的函数</span></span><br><span class="line"><span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">observeValue</span>(<span class="params">forKeyPath</span> <span class="params">keyPath</span>: <span class="type">String</span>?, <span class="params">of</span> <span class="params">object</span>: <span class="keyword">Any</span><span class="operator">?</span>, <span class="params">change</span>: [<span class="params">NSKeyValueChangeKey</span> : <span class="keyword">Any</span>]<span class="operator">?</span>, <span class="params">context</span>: <span class="type">UnsafeMutableRawPointer</span>?) &#123;</span><br><span class="line">    <span class="keyword">if</span> keyPath <span class="operator">==</span> <span class="string">&quot;estimatedProgress&quot;</span> &#123;</span><br><span class="line">        <span class="comment">// estimatedProgress is a Double, Unhelpfully, UIProgressView&#x27;s progress property is a Float</span></span><br><span class="line">        progressView.progress <span class="operator">=</span> <span class="type">Float</span>(webView.estimatedProgress)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="UITextChecker"><a href="#UITextChecker" class="headerlink" title="UITextChecker"></a>UITextChecker</h1><p>UITextChecker类来源于UIKit,在SwiftUI没有替代方案的情况下,只能使用该方法了。</p>
<p>使用的案例(简单实现,下面的NSRange和rangeOfMisspelledWord又会重复一遍这个操作):<br>查找用户输入的英语单词是否在字典里,有没有拼错的情况:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> word <span class="operator">=</span> <span class="string">&quot;swift&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> checker <span class="operator">=</span> <span class="type">UITextChecker</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// location是从哪个位置开始,一般都是0,length是计算word在utf16中的长度</span></span><br><span class="line"><span class="keyword">let</span> range <span class="operator">=</span> <span class="type">NSRange</span>(location: <span class="number">0</span>, length: word.utf16.count)</span><br><span class="line"></span><br><span class="line"><span class="comment">// in是要核对的词,range是核对的范围长度,wrap是持续核对的意思(具体没有试过)</span></span><br><span class="line"><span class="keyword">let</span> misspelledRange <span class="operator">=</span> checker.rangeOfMisspelledWord(in: word, range: range, startingAt: <span class="number">0</span>, wrap: <span class="literal">false</span>, language: <span class="string">&quot;en&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回值要么是The range of the first misspelled word encountered</span></span><br><span class="line"><span class="comment">// 没找到就是&#123;NSNotFound, 0&#125; if none is found.</span></span><br><span class="line"><span class="keyword">let</span> allGood <span class="operator">=</span> misspelledRange.location <span class="operator">==</span> <span class="type">NSNotFound</span></span><br><span class="line"><span class="comment">// 有这个单词也没拼错的情况返回true,不然返回false</span></span><br></pre></td></tr></table></figure>

<p>方法的解释可以参考下面的文章:</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/books/ios-swiftui/working-with-strings">https://www.hackingwithswift.com/books/ios-swiftui/working-with-strings</a><br><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/books/ios-swiftui/validating-words-with-uitextchecker">https://www.hackingwithswift.com/books/ios-swiftui/validating-words-with-uitextchecker</a></p>
</blockquote>
<p>注意：<br>UITextChecker uses the built-in system dictionary.我们不用为其特意准备单词表等文档。</p>
<h1 id="Auto-Layout-自动页面布局的设置"><a href="#Auto-Layout-自动页面布局的设置" class="headerlink" title="Auto Layout 自动页面布局的设置"></a>Auto Layout 自动页面布局的设置</h1><h2 id="通过Storyboard来设置"><a href="#通过Storyboard来设置" class="headerlink" title="通过Storyboard来设置"></a>通过Storyboard来设置</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/read/6/2/advanced-auto-layout">https://www.hackingwithswift.com/read/6/2/advanced-auto-layout</a></p>
</blockquote>
<p>以上是三面国旗间如何通过storyboard来自动设置布局,以让起在portrait&#x2F;landscape中均能够有一个好的效果。<br>通过该视频就能大致了解了,而看文字的话比较繁琐。</p>
<h2 id="通过Storyboard自动布局后如何让它变为自动布局"><a href="#通过Storyboard自动布局后如何让它变为自动布局" class="headerlink" title="通过Storyboard自动布局后如何让它变为自动布局"></a>通过Storyboard自动布局后如何让它变为自动布局</h2><p>在Storyboard中布局各个view后,可以让屏幕自动布局页面,这样在landscape或是不同屏幕大小的机型上,都可以自动适应布局:</p>
<ol>
<li>Select the view controller by clicking on “View Controller” in the document outline, </li>
<li>then go to the Editor menu </li>
<li>and choose Resolve Auto Layout Issues &gt; Reset To Suggested Constraints.</li>
</ol>
<h2 id="通过Storyboard布局后-如何让一个view在Storyboard上回到它应该显示的位置上？"><a href="#通过Storyboard布局后-如何让一个view在Storyboard上回到它应该显示的位置上？" class="headerlink" title="通过Storyboard布局后,如何让一个view在Storyboard上回到它应该显示的位置上？"></a>通过Storyboard布局后,如何让一个view在Storyboard上回到它应该显示的位置上？</h2><p>我们在Storyboard上扔下一个UILabel,让其显示”Here is a UILbale !”,字体设置为30,随后通过鼠标contrl指向空白处,此时选择”Center Horizontally in safe area” &#x2F; “Center Vertically in safe area”,随后鼠标点击该label,我们看的是:<br><img src="/Images/labelLayout_0.png" alt="labelLayout"><br>我们来分析一个这个图:<br>可以看到实线包围的label和一个虚线包围的label。实线的(the solid orange lines)代表你的label现在在的位置,而虚线的(the dashed orange lines)代表程序运行后你的label会在的位置。</p>
<p>那么如何让这个label回到它在程序运行后应该在的位置呢?<br>Editor menu and choosing Resolve Auto Layout Issues &gt; Update Frames<br>设置后是这样的:<br><img src="/Images/labelLayout_1.png" alt="labelLayout"><br>这样就这样了,没有橙线了。</p>
<h2 id="通过addConstraints-with-Visual-Format-Language-VFL"><a href="#通过addConstraints-with-Visual-Format-Language-VFL" class="headerlink" title="通过addConstraints with Visual Format Language (VFL)"></a>通过addConstraints with Visual Format Language (VFL)</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/read/6/3/auto-layout-in-code-addconstraints-with-visual-format-language">https://www.hackingwithswift.com/read/6/3/auto-layout-in-code-addconstraints-with-visual-format-language</a></p>
</blockquote>
<p>一个不通过Storyboard可视化布局来显示页面的简单例子:<br>(因为之前有执念一直在想有没有办法能够实现,所以一知道怎么做了,就写进了笔记里)</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">viewDidLoad</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">            </span><br><span class="line">    <span class="keyword">let</span> imageView <span class="operator">=</span> <span class="type">UIImageView</span>()</span><br><span class="line">    <span class="comment">// 关键的translatesAutoresizingMaskIntoConstraints的设置</span></span><br><span class="line">    imageView.translatesAutoresizingMaskIntoConstraints <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    imageView.image <span class="operator">=</span> <span class="type">UIImage</span>(systemName: <span class="string">&quot;star&quot;</span>)</span><br><span class="line">    imageView.layer.backgroundColor <span class="operator">=</span> <span class="type">UIColor</span>.red.cgColor</span><br><span class="line">    <span class="comment">// 这里不要关心我这里布局代码用到的是anchor,只是随便用了个布局方法</span></span><br><span class="line">    imageView.widthAnchor.constraint(equalToConstant: <span class="number">100</span>).isActive <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">    imageView.heightAnchor.constraint(equalToConstant: <span class="number">100</span>).isActive <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">    </span><br><span class="line">    view.addSubview((imageView))</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里之前一直想随便写个view让其能够显示,始终没有显示,后来发觉是因为没有这行代码:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">imageView.translatesAutoresizingMaskIntoConstraints <span class="operator">=</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<p>because by default iOS generates Auto Layout constraints for you based on a view’s size and position. We’ll be doing it by hand, so we need to disable this feature.</p>
<p>Q: 为什么 imageView.translatesAutoresizingMaskIntoConstraints &#x3D; true 的时候就没有显示这个view呢？<br>A: I have no answer…….</p>
<p>详细一点的例子:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 首先是 五个label图像元素</span></span><br><span class="line">verride <span class="keyword">func</span> <span class="title function_">viewDidLoad</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> label1 <span class="operator">=</span> <span class="type">UILabel</span>()</span><br><span class="line">    label1.translatesAutoresizingMaskIntoConstraints <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    label1.backgroundColor <span class="operator">=</span> <span class="type">UIColor</span>.red</span><br><span class="line">    label1.text <span class="operator">=</span> <span class="string">&quot;THESE&quot;</span></span><br><span class="line">    label1.sizeToFit()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> label2 <span class="operator">=</span> <span class="type">UILabel</span>()</span><br><span class="line">    label2.translatesAutoresizingMaskIntoConstraints <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    label2.backgroundColor <span class="operator">=</span> <span class="type">UIColor</span>.cyan</span><br><span class="line">    label2.text <span class="operator">=</span> <span class="string">&quot;ARE&quot;</span></span><br><span class="line">    label2.sizeToFit()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> label3 <span class="operator">=</span> <span class="type">UILabel</span>()</span><br><span class="line">    label3.translatesAutoresizingMaskIntoConstraints <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    label3.backgroundColor <span class="operator">=</span> <span class="type">UIColor</span>.yellow</span><br><span class="line">    label3.text <span class="operator">=</span> <span class="string">&quot;SOME&quot;</span></span><br><span class="line">    label3.sizeToFit()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> label4 <span class="operator">=</span> <span class="type">UILabel</span>()</span><br><span class="line">    label4.translatesAutoresizingMaskIntoConstraints <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    label4.backgroundColor <span class="operator">=</span> <span class="type">UIColor</span>.green</span><br><span class="line">    label4.text <span class="operator">=</span> <span class="string">&quot;AWESOME&quot;</span></span><br><span class="line">    label4.sizeToFit()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> label5 <span class="operator">=</span> <span class="type">UILabel</span>()</span><br><span class="line">    label5.translatesAutoresizingMaskIntoConstraints <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    label5.backgroundColor <span class="operator">=</span> <span class="type">UIColor</span>.orange</span><br><span class="line">    label5.text <span class="operator">=</span> <span class="string">&quot;LABELS&quot;</span></span><br><span class="line">    label5.sizeToFit()        </span><br><span class="line"></span><br><span class="line">    view.addSubview(label1)</span><br><span class="line">    view.addSubview(label2)</span><br><span class="line">    view.addSubview(label3)</span><br><span class="line">    view.addSubview(label4)</span><br><span class="line">    view.addSubview(label5)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在这些图像都挤在左上角！还互相叠着！</p>
<p>设置一个dict:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> viewsDictionary <span class="operator">=</span> [<span class="string">&quot;label1&quot;</span>: label1, <span class="string">&quot;label2&quot;</span>: label2, <span class="string">&quot;label3&quot;</span>: label3, <span class="string">&quot;label4&quot;</span>: label4, <span class="string">&quot;label5&quot;</span>: label5]</span><br></pre></td></tr></table></figure>

<p>添加布局:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> label <span class="keyword">in</span> viewsDictionary.keys &#123;</span><br><span class="line">    view.addConstraints( <span class="type">NSLayoutConstraint</span>.constraints(withVisualFormat: <span class="string">&quot;H:|[<span class="subst">\(label)</span>]|&quot;</span>, options: [], metrics: <span class="literal">nil</span>, views: viewsDictionary))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>NSLayoutConstraint.constraints(withVisualFormat:)相对比较关键。<br>里面的用字符串表示的”H:|[label1]|”中,H代表Horizontal,前后的两个｜分别代表了屏幕的左右边缘。</p>
<p>看懂下面的代码:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view.addConstraints( <span class="type">NSLayoutConstraint</span>.constraints(withVisualFormat: <span class="string">&quot;V:|[label1]-[label2]-[label3]-[label4]-[label5]&quot;</span>, options: [], metrics: <span class="literal">nil</span>, views: viewsDictionary))</span><br></pre></td></tr></table></figure>
<p>5个label按照次序沿着屏幕左侧开始依次排列。其中分隔每个label的符号”-“意味着有间隔,这个间隔的默认值是10,可以自定义。</p>
<p>以及设置更精确的数据:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view.addConstraints( <span class="type">NSLayoutConstraint</span>.constraints(withVisualFormat: <span class="string">&quot;V:|[label1(==88)]-[label2(==88)]-[label3(==88)]-[label4(==88)]-[label5(==88)]-(&gt;=10)-|&quot;</span>, options: [], metrics: <span class="literal">nil</span>, views: viewsDictionary))</span><br></pre></td></tr></table></figure>

<p>以及使用到metrics参数的情况:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> metrics <span class="operator">=</span> [<span class="string">&quot;labelHeight&quot;</span>: <span class="number">88</span>]</span><br><span class="line">view.addConstraints( <span class="type">NSLayoutConstraint</span>.constraints(withVisualFormat: <span class="string">&quot;V:|[label1(labelHeight)]-[label2(labelHeight)]-[label3(labelHeight)]-[label4(labelHeight)]-[label5(labelHeight)]-&gt;=10-|&quot;</span>, options: [], metrics: metrics, views: viewsDictionary))</span><br></pre></td></tr></table></figure>
<p>So when your designer &#x2F; manager &#x2F; inner-pedant decides that 88 points is wrong and you want some other number, you can change it in one place to have everything update.</p>
<p>以及使用优先级priority的情况:(优先级是从1-1000,数字越大优先级越高) - @数字</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;V:|[label1(labelHeight@999)]-[label2(label1)]-[label3(label1)]-[label4(label1)]-[label5(label1)]-&gt;=10-|&quot;</span></span><br></pre></td></tr></table></figure>
<p>自己理解:label1设置了一个高度,并对该高度设置了一个优先级,那么其他四个label的高度和其一样(包括优先级)。</p>
<h2 id="通过Auto-Layout-anchors来自动布局"><a href="#通过Auto-Layout-anchors来自动布局" class="headerlink" title="通过Auto Layout anchors来自动布局"></a>通过Auto Layout anchors来自动布局</h2><p>Every UIView has a set of anchors that define its layouts rules.<br>The most important ones are<br><strong>widthAnchor</strong>, <strong>heightAnchor</strong>, <strong>topAnchor</strong>, <strong>bottomAnchor</strong>, <strong>leftAnchor</strong>, <strong>rightAnchor</strong>, <strong>leadingAnchor</strong>, <strong>trailingAnchor</strong>, <strong>centerXAnchor</strong>, and <strong>centerYAnchor</strong>.</p>
<p>一般用例:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> label <span class="keyword">in</span> [label1, label2, label3, label4, label5] &#123;</span><br><span class="line">    label.widthAnchor.constraint(equalTo: view.widthAnchor).isActive <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">    label.heightAnchor.constraint(equalToConstant: <span class="number">88</span>).isActive <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一般用例:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> previous <span class="operator">=</span> previous &#123;</span><br><span class="line">    <span class="comment">// we have a previous label – create a height constraint</span></span><br><span class="line">    label.topAnchor.constraint(equalTo: previous.bottomAnchor, constant: <span class="number">10</span>).isActive <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// this is the first label</span></span><br><span class="line">    label.topAnchor.constraint(equalTo: view.safeAreaLayoutGuide.topAnchor, constant: <span class="number">0</span>).isActive <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里用到的view.safeAreaLayoutGuide其实理解下来就是除了上下那两块的其他安全区域的屏幕范围。</p>
<p>还有这样的:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yourView.widthAnchor.constraint(equalTo: view.safeAreaLayoutGuide.widthAnchor, multiplier: <span class="number">0.5</span>, constant: <span class="number">50</span>).isActive <span class="operator">=</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>就是在0.5倍的基础上再加50的意思。</p>
<p>还可以用到<strong>NSLayoutConstraint.activate</strong>集合很多规则:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">NSLayoutConstraint</span>.activate([</span><br><span class="line">    scoreLabel.topAnchor.constraint(equalTo: view.layoutMarginsGuide.topAnchor),</span><br><span class="line">    scoreLabel.trailingAnchor.constraint(equalTo: view.layoutMarginsGuide.trailingAnchor),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// more constraints to be added here!</span></span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<p>Notice the way I’m pinning the label to view.layoutMarginsGuide – that will make the score label have a little distance from the right edge of the screen.</p>
<h3 id="yourView-setContentHuggingPriority-UILayoutPriority-Int-for"><a href="#yourView-setContentHuggingPriority-UILayoutPriority-Int-for" class="headerlink" title="yourView.setContentHuggingPriority(UILayoutPriority(Int), for: )"></a>yourView.setContentHuggingPriority(UILayoutPriority(Int), for: )</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cluesLabel.setContentHuggingPriority(<span class="type">UILayoutPriority</span>(<span class="number">1</span>), for: .vertical)</span><br><span class="line">answersLabel.setContentHuggingPriority(<span class="type">UILayoutPriority</span>(<span class="number">1</span>), for: .vertical)</span><br></pre></td></tr></table></figure>
<p>优先级是从1-1000的,此处设置为1,代表最没有优先级,for是指适用于垂直面的。</p>
<h2 id="创建的Game项目的屏幕大小layout的适配"><a href="#创建的Game项目的屏幕大小layout的适配" class="headerlink" title="创建的Game项目的屏幕大小layout的适配"></a>创建的Game项目的屏幕大小layout的适配</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/read/14/2/getting-up-and-running-skcropnode">https://www.hackingwithswift.com/read/14/2/getting-up-and-running-skcropnode</a></p>
</blockquote>
<p>创建了一个Game项目,之前教程中均是使用spriteKit来制作的,一般都会设置屏幕大小为1024*768,这在一般iPad上都没问题,11-inch iPad Pro会比较特殊,所以需要做一个适配:<br>在GameViewController.swift中,将<br>“scene.scaleMode &#x3D; .aspectFill”<br>替换成<br>“scene.scaleMode &#x3D; .fill”</p>
<h2 id="UIEdgeInsets-–-类似于给UIView加一个padding的设置"><a href="#UIEdgeInsets-–-类似于给UIView加一个padding的设置" class="headerlink" title="UIEdgeInsets – 类似于给UIView加一个padding的设置"></a>UIEdgeInsets – 类似于给UIView加一个padding的设置</h2><p>我们创建一个UITextView:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@IBOutlet</span> <span class="keyword">var</span> textView: <span class="type">UITextView</span>!</span><br></pre></td></tr></table></figure>
<p>并在storyboard上设置了它的大小,执行后是这样的:<br><img src="/Images/UIEdgeInsets_0.png" alt="UIEdgeInsets"></p>
<p>如果我们给它加上Inset:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">textView.contentInset <span class="operator">=</span> <span class="type">UIEdgeInsets</span>(top: <span class="number">50</span>, left: <span class="number">50</span>, bottom: <span class="number">50</span>, right: <span class="number">50</span>)</span><br></pre></td></tr></table></figure>
<p>它就会是这样:<br><img src="/Images/UIEdgeInsets_1.png" alt="UIEdgeInsets"></p>
<h1 id="UITabBarController"><a href="#UITabBarController" class="headerlink" title="UITabBarController"></a>UITabBarController</h1><h2 id="如何更改Tabbar的显示文字和图标"><a href="#如何更改Tabbar的显示文字和图标" class="headerlink" title="如何更改Tabbar的显示文字和图标"></a>如何更改Tabbar的显示文字和图标</h2><p>假设3个页面依次嵌套是这样的:<br>View Controller Scene – Navigation Controller Scene – Tab Bar Controller Scene</p>
<p>如何更改Tabbar的显示文字和图标？<br>需要在Storyboard中找到Navigation Controller Scene(而非Tab Bar Controller Scene),随后选到这个Tabbar元素(a new type of object called a UITabBarItem),再右侧属性栏的Bar Item中去更改其的Title和Image。</p>
<h2 id="如何增加Tab页面"><a href="#如何增加Tab页面" class="headerlink" title="如何增加Tab页面"></a>如何增加Tab页面</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/read/7/5/finishing-touches-didfinishlaunchingwithoptions">https://www.hackingwithswift.com/read/7/5/finishing-touches-didfinishlaunchingwithoptions</a></p>
</blockquote>
<p>打开AppDelegate.swif,找寻到didFinishLaunchingWithOptions方法,在里面添加如下代码,最终的代码是:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">application</span>(<span class="keyword">_</span> <span class="params">application</span>: <span class="type">UIApplication</span>, <span class="params">didFinishLaunchingWithOptions</span> <span class="params">launchOptions</span>: [<span class="type">UIApplication</span>.<span class="params">LaunchOptionsKey</span> : <span class="keyword">Any</span>]<span class="operator">?</span> <span class="operator">=</span> <span class="literal">nil</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> tabBarController <span class="operator">=</span> window<span class="operator">?</span>.rootViewController <span class="keyword">as?</span> <span class="type">UITabBarController</span> &#123;</span><br><span class="line">        <span class="comment">// 以上代码,因为上面讲过3个页面嵌套,Tab Bar Controller Scene是最root的view</span></span><br><span class="line">        <span class="comment">// 找到我们的storyboard,我们的storyboard默认取名是Main</span></span><br><span class="line">        <span class="keyword">let</span> storyboard <span class="operator">=</span> <span class="type">UIStoryboard</span>(name: <span class="string">&quot;Main&quot;</span>, bundle: <span class="literal">nil</span>)</span><br><span class="line">        <span class="comment">// 之前给Navigation Controller Scene起过一个StoryboardID是NavController,这里生成一个这样的页面</span></span><br><span class="line">        <span class="keyword">let</span> vc <span class="operator">=</span> storyboard.instantiateViewController(withIdentifier: <span class="string">&quot;NavController&quot;</span>)</span><br><span class="line">        <span class="comment">// 从storyboard中可以看到,Navigation Controller Scene里面有一个tabBarItem,</span></span><br><span class="line">        <span class="comment">// 所以给tabBarItem定义成一个UITabBarItem,重要的是tag为1,因为本来就有存在的那个tag为0</span></span><br><span class="line">        vc.tabBarItem <span class="operator">=</span> <span class="type">UITabBarItem</span>(tabBarSystemItem: .topRated, tag: <span class="number">1</span>)</span><br><span class="line">        <span class="comment">// 将该tabBarItem所在的vc添加进tabBarController</span></span><br><span class="line">        tabBarController.viewControllers<span class="operator">?</span>.append(vc)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>随后,如何在相同的一个ViewControllerScene中区别开是哪个tab页面?</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> urlString: <span class="type">String</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> navigationController<span class="operator">?</span>.tabBarItem.tag <span class="operator">==</span> <span class="number">0</span> &#123;</span><br><span class="line">    <span class="comment">// urlString = &quot;https://api.whitehouse.gov/v1/petitions.json?limit=100&quot;</span></span><br><span class="line">    urlString <span class="operator">=</span> <span class="string">&quot;https://www.hackingwithswift.com/samples/petitions-1.json&quot;</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// urlString = &quot;https://api.whitehouse.gov/v1/petitions.json?signatureCountFloor=10000&amp;limit=100&quot;</span></span><br><span class="line">    urlString <span class="operator">=</span> <span class="string">&quot;https://www.hackingwithswift.com/samples/petitions-2.json&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="UILabel"><a href="#UILabel" class="headerlink" title="UILabel()"></a>UILabel()</h1><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">scoreLabel <span class="operator">=</span> <span class="type">UILabel</span>()</span><br><span class="line">scoreLabel.translatesAutoresizingMaskIntoConstraints <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"><span class="comment">// 设置对齐</span></span><br><span class="line">scoreLabel.textAlignment <span class="operator">=</span> .right</span><br><span class="line"><span class="comment">// 设置内容</span></span><br><span class="line">scoreLabel.text <span class="operator">=</span> <span class="string">&quot;Score: 0&quot;</span></span><br><span class="line"><span class="comment">// 设置字体大小</span></span><br><span class="line">scoreLabel.font <span class="operator">=</span> <span class="type">UIFont</span>.systemFont(ofSize: <span class="number">24</span>)</span><br><span class="line"><span class="comment">// 设置背景色</span></span><br><span class="line">scoreLabel.backgroundColor <span class="operator">=</span> .blue</span><br><span class="line"><span class="comment">// 设置字体颜色</span></span><br><span class="line">scoreLabel.textColor <span class="operator">=</span> <span class="type">UIColor</span>.red</span><br><span class="line">view.addSubview(scoreLabel)</span><br></pre></td></tr></table></figure>

<h1 id="UITextfield"><a href="#UITextfield" class="headerlink" title="UITextfield"></a>UITextfield</h1><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">currentAnswer <span class="operator">=</span> <span class="type">UITextField</span>()</span><br><span class="line">currentAnswer.translatesAutoresizingMaskIntoConstraints <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"><span class="comment">// 设置placeholder</span></span><br><span class="line">currentAnswer.placeholder <span class="operator">=</span> <span class="string">&quot;Tap letters to guess&quot;</span></span><br><span class="line"><span class="comment">// 设置对齐</span></span><br><span class="line">currentAnswer.textAlignment <span class="operator">=</span> .center</span><br><span class="line"><span class="comment">// 设置字体大小</span></span><br><span class="line">currentAnswer.font <span class="operator">=</span> <span class="type">UIFont</span>.systemFont(ofSize: <span class="number">44</span>)</span><br><span class="line"><span class="comment">// 设置是否用户可输入</span></span><br><span class="line">currentAnswer.isUserInteractionEnabled <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">view.addSubview(currentAnswer)</span><br></pre></td></tr></table></figure>

<p>注意:UITextField只能显示一行,而UITextView可以显示多行,这就是两者的区别。</p>
<h1 id="UITextView"><a href="#UITextView" class="headerlink" title="UITextView"></a>UITextView</h1><p>UITextView可以显示多行,而UITextField只能显示一行,这就是两者的区别。</p>
<h2 id="UITextView-contentInset-–-类似于一个padding"><a href="#UITextView-contentInset-–-类似于一个padding" class="headerlink" title="UITextView.contentInset – 类似于一个padding"></a>UITextView.contentInset – 类似于一个padding</h2><p>具体操作见 “Auto Layout 自动页面布局的设置” -&gt; “UIEdgeInsets” 。</p>
<h2 id="UITextView-endEditing-true-x2F-false-–-隐藏-x2F-显示-keyboard"><a href="#UITextView-endEditing-true-x2F-false-–-隐藏-x2F-显示-keyboard" class="headerlink" title="UITextView.endEditing(true&#x2F;false) – 隐藏&#x2F;显示 keyboard"></a>UITextView.endEditing(true&#x2F;false) – 隐藏&#x2F;显示 keyboard</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// textView: UITextView</span></span><br><span class="line">textView.endEditing(<span class="literal">true</span>)</span><br></pre></td></tr></table></figure>

<h1 id="GCD-Grand-Central-Dispatch"><a href="#GCD-Grand-Central-Dispatch" class="headerlink" title="GCD - Grand Central Dispatch"></a>GCD - Grand Central Dispatch</h1><p>GCD是帮助你自动化管理进程的一套东西。GCD中的三个方法之一，最重要的就是async()。</p>
<p>后台进程中,有四种选择,或者叫QoS level set:</p>
<ol>
<li>User Interactive: this is the highest priority background thread, and should be used when you want a background thread to do work that is important to keep your user interface working. This priority will ask the system to dedicate nearly all available CPU time to you to get the job done as quickly as possible.</li>
<li>User Initiated: this should be used to execute tasks requested by the user that they are now waiting for in order to continue using your app. It’s not as important as user interactive work – i.e., if the user taps on buttons to do other stuff, that should be executed first – but it is important because you’re keeping the user waiting.</li>
<li>The Utility queue: this should be used for long-running tasks that the user is aware of, but not necessarily desperate for now. If the user has requested something and can happily leave it running while they do something else with your app, you should use Utility.</li>
<li>The Background queue: this is for long-running tasks that the user isn’t actively aware of, or at least doesn’t care about its progress or when it completes.</li>
</ol>
<p>Those QoS queues affect the way the system prioritizes your work: User Interactive and User Initiated tasks will be executed as quickly as possible regardless of their effect on battery life, Utility tasks will be executed with a view to keeping power efficiency as high as possible without sacrificing too much performance, whereas Background tasks will be executed with power efficiency as its priority.</p>
<p>如何使用:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在默认的Background queue进程中</span></span><br><span class="line"><span class="comment">// The default GCD background queue has a lower priority than .userInitiated but higher than .utility.</span></span><br><span class="line"><span class="type">DispatchQueue</span>.global().async &#123;</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 指定在User Initiated进程中</span></span><br><span class="line"><span class="type">DispatchQueue</span>.global(qos: .userInitiated).async &#123;</span><br></pre></td></tr></table></figure>

<p>此外,在 async() 里面的代码不需要使用[weak self] in之类的语句,因为async()执行完就会被丢弃,不存在留存东西的情况。</p>
<p><strong>performSelector(inBackground:)</strong> 和 <strong>performSelector(onMainThread:)</strong> 这两种方法更好用一些,因为更加简单,只要决定是放在main thread,还是background上运行就行。<br>(初步用下来,performSelector会有些问题,莫名的警告之类的,可能更推荐使用DispatchQueue.global()&#x2F;DispatchQueue.main之类的吧)<br>示例代码:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">performSelector(onMainThread: <span class="keyword">#selector</span>(showError), with: <span class="literal">nil</span>, waitUntilDone: <span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">@objc</span> <span class="keyword">func</span> <span class="title function_">showError</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> ac <span class="operator">=</span> <span class="type">UIAlertController</span>(title: <span class="string">&quot;Loading error&quot;</span>, message: <span class="string">&quot;There was a problem loading the feed; please check your connection and try again.&quot;</span>, preferredStyle: .alert)</span><br><span class="line">    ac.addAction(<span class="type">UIAlertAction</span>(title: <span class="string">&quot;OK&quot;</span>, style: .default))</span><br><span class="line">    present(ac, animated: <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This is an Objective-C call, so the @objc attribute is required.</p>
<p>这里发现个情况，几种代码的情况竟然都是可以的:<br>场景是,一个class ViewController: UITableViewController内定义了fun tableView的实现,这时候,需要在background中对tabaleView中的UI数据进行更新,肯定是要在主线程即main thread中更新的,<br>我们可以:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">    <span class="keyword">self</span><span class="operator">?</span>.tableView.reloadData()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也可以:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里写self?是因为在DispatchQueue.global().async这个closure中,里面引用的外部self必须是个optional,这里请忽略</span></span><br><span class="line"><span class="keyword">self</span><span class="operator">?</span>.tableView.performSelector(onMainThread: <span class="keyword">#selector</span>(<span class="keyword">self</span><span class="operator">?</span>.tableView.reloadData), with: <span class="literal">nil</span>, waitUntilDone: <span class="literal">false</span>)</span><br></pre></td></tr></table></figure>

<p>竟然还可以:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span><span class="operator">?</span>.tableView.performSelector(onMainThread: <span class="keyword">#selector</span>(<span class="type">UITableView</span>.reloadData), with: <span class="literal">nil</span>, waitUntilDone: <span class="literal">false</span>)</span><br></pre></td></tr></table></figure>
<p>没想到的是,#selector(UITableView.reloadData)中的“UITableView.”竟然也是可以引用到这个方法的,一时半会儿有点概念不清晰，但又感觉可能可以。</p>
<h1 id="UICollectionView"><a href="#UICollectionView" class="headerlink" title="UICollectionView"></a>UICollectionView</h1><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/read/10/2/designing-uicollectionview-cells">https://www.hackingwithswift.com/read/10/2/designing-uicollectionview-cells</a></p>
</blockquote>
<p>在Storyboard上创建UIColletionView的过程,与创建UITableView差不多,也是在删除原有的controller,在libraries里拖拉出一个Collection View Controller拖进storyboard。</p>
<p>接下来要建立一个对应UICollectionViewCell的Cocoa Touch Class的文件,在storyboard中找到CollectionViewCell(就如同找到table cell一样),让其的class对应该协议,此外要给该CollectionViewCell的identifier取个名字,好在代码中生成这个cell。</p>
<h2 id="需要实现的方法-1"><a href="#需要实现的方法-1" class="headerlink" title="需要实现的方法"></a>需要实现的方法</h2><h3 id="override-func-collectionView-collectionView-UICollectionView-numberOfItemsInSection-section-Int-gt-Int"><a href="#override-func-collectionView-collectionView-UICollectionView-numberOfItemsInSection-section-Int-gt-Int" class="headerlink" title="override func collectionView(_ collectionView: UICollectionView, numberOfItemsInSection section: Int) -&gt; Int { }"></a>override func collectionView(_ collectionView: UICollectionView, numberOfItemsInSection section: Int) -&gt; Int { }</h3><p>示例代码:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">collectionView</span>(<span class="keyword">_</span> <span class="params">collectionView</span>: <span class="type">UICollectionView</span>, <span class="params">numberOfItemsInSection</span> <span class="params">section</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">10</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="override-func-collectionView-collectionView-UICollectionView-cellForItemAt-indexPath-IndexPath-gt-UICollectionViewCell"><a href="#override-func-collectionView-collectionView-UICollectionView-cellForItemAt-indexPath-IndexPath-gt-UICollectionViewCell" class="headerlink" title="override func collectionView(_ collectionView: UICollectionView, cellForItemAt indexPath: IndexPath) -&gt; UICollectionViewCell {}"></a>override func collectionView(_ collectionView: UICollectionView, cellForItemAt indexPath: IndexPath) -&gt; UICollectionViewCell {}</h3><p>示例代码:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">collectionView</span>(<span class="keyword">_</span> <span class="params">collectionView</span>: <span class="type">UICollectionView</span>, <span class="params">cellForItemAt</span> <span class="params">indexPath</span>: <span class="type">IndexPath</span>) -&gt; <span class="type">UICollectionViewCell</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> cell <span class="operator">=</span> collectionView.dequeueReusableCell(withReuseIdentifier: <span class="string">&quot;Person&quot;</span>, for: indexPath) <span class="keyword">as?</span> <span class="type">PersonCell</span> <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// we failed to get a PersonCell – bail out!</span></span><br><span class="line">        <span class="built_in">fatalError</span>(<span class="string">&quot;Unable to dequeue PersonCell.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// if we&#x27;re still here it means we got a PersonCell, so we can return it</span></span><br><span class="line">    <span class="keyword">return</span> cell</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="可以实现的方法-1"><a href="#可以实现的方法-1" class="headerlink" title="可以实现的方法"></a>可以实现的方法</h2><h3 id="override-func-collectionView-collectionView-UICollectionView-didSelectItemAt-indexPath-IndexPath"><a href="#override-func-collectionView-collectionView-UICollectionView-didSelectItemAt-indexPath-IndexPath" class="headerlink" title="override func collectionView(_ collectionView: UICollectionView, didSelectItemAt indexPath: IndexPath) { }"></a>override func collectionView(_ collectionView: UICollectionView, didSelectItemAt indexPath: IndexPath) { }</h3><p>示例代码:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">collectionView</span>(<span class="keyword">_</span> <span class="params">collectionView</span>: <span class="type">UICollectionView</span>, <span class="params">didSelectItemAt</span> <span class="params">indexPath</span>: <span class="type">IndexPath</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> person <span class="operator">=</span> people[indexPath.item]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> ac <span class="operator">=</span> <span class="type">UIAlertController</span>(title: <span class="string">&quot;Rename person&quot;</span>, message: <span class="literal">nil</span>, preferredStyle: .alert)</span><br><span class="line">    ac.addTextField()</span><br><span class="line"></span><br><span class="line">    ac.addAction(<span class="type">UIAlertAction</span>(title: <span class="string">&quot;Cancel&quot;</span>, style: .cancel))</span><br><span class="line"></span><br><span class="line">    ac.addAction(<span class="type">UIAlertAction</span>(title: <span class="string">&quot;OK&quot;</span>, style: .default) &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>, <span class="keyword">weak</span> ac] <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> newName <span class="operator">=</span> ac<span class="operator">?</span>.textFields<span class="operator">?</span>[<span class="number">0</span>].text <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">        person.name <span class="operator">=</span> newName</span><br><span class="line"></span><br><span class="line">        <span class="keyword">self</span><span class="operator">?</span>.collectionView.reloadData()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    present(ac, animated: <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="UIImagePickerController"><a href="#UIImagePickerController" class="headerlink" title="UIImagePickerController"></a>UIImagePickerController</h1><p>This new class is designed to let users select an image from their camera to import into an app. When you first create a UIImagePickerController, iOS will automatically ask the user whether the app can access their photos.</p>
<h2 id="privacy-permission"><a href="#privacy-permission" class="headerlink" title="privacy permission"></a>privacy permission</h2><p>查看、使用用户的照片,需要对用户进行告知:<br>we need to add a text string describing our intent. So, open Info.plist, select any item, click +, then choose the key name “Privacy - Photo Library Additions Usage Description”. Give it the value “We need to import photos” then press return.</p>
<h2 id="一般示例代码"><a href="#一般示例代码" class="headerlink" title="一般示例代码"></a>一般示例代码</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 先由一个按钮引出</span></span><br><span class="line">navigationItem.leftBarButtonItem <span class="operator">=</span> <span class="type">UIBarButtonItem</span>(barButtonSystemItem: .add, target: <span class="keyword">self</span>, action: <span class="keyword">#selector</span>(addNewPerson))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引出方法</span></span><br><span class="line"><span class="keyword">@objc</span> <span class="keyword">func</span> <span class="title function_">addNewPerson</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> picker <span class="operator">=</span> <span class="type">UIImagePickerController</span>()</span><br><span class="line">    picker.allowsEditing <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment">// 由于这行代码,需要本身的class必须遵循到UIImagePickerControllerDelegate protocol,</span></span><br><span class="line">    <span class="comment">// 而且还要额外遵循 UINavigationControllerDelegate protocol.</span></span><br><span class="line">    picker.delegate <span class="operator">=</span> <span class="keyword">self</span></span><br><span class="line">    present(picker, animated: <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用户选择照片后,会自动运行到一个方法:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">imagePickerController</span>(<span class="keyword">_</span> <span class="params">picker</span>: <span class="type">UIImagePickerController</span>, <span class="params">didFinishPickingMediaWithInfo</span> <span class="params">info</span>: [<span class="type">UIImagePickerController</span>.<span class="params">InfoKey</span> : <span class="keyword">Any</span>]) &#123;</span><br><span class="line">ntroller, didFinishPickingMediaWithInfo info: [<span class="type">UIImagePickerController</span>.<span class="type">InfoKey</span> : <span class="keyword">Any</span>]) &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> image <span class="operator">=</span> info[.editedImage] <span class="keyword">as?</span> <span class="type">UIImage</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> imageName <span class="operator">=</span> <span class="type">UUID</span>().uuidString</span><br><span class="line">    <span class="keyword">let</span> imagePath <span class="operator">=</span> getDocumentsDirectory().appendingPathComponent(imageName)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> jpegData <span class="operator">=</span> image.jpegData(compressionQuality: <span class="number">0.8</span>) &#123;</span><br><span class="line">        <span class="keyword">try?</span> jpegData.write(to: imagePath)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dismiss(animated: <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">getDocumentsDirectory</span>() -&gt; <span class="type">URL</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> paths <span class="operator">=</span> <span class="type">FileManager</span>.default.urls(for: .documentDirectory, in: .userDomainMask)</span><br><span class="line">    <span class="keyword">return</span> paths[<span class="number">0</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中,info参数是一个dict,它有两个参数,分别是 <strong>.editedImage</strong> (the image that was edited) or <strong>.originalImage</strong> , but in our case it should only ever be the former unless you change the allowsEditing property.</p>
<h1 id="SpriteKit"><a href="#SpriteKit" class="headerlink" title="SpriteKit"></a>SpriteKit</h1><p>(According to the project 11 from “100 hundred days of Swift”)</p>
<p>Create a new project in xCode and choose Game, sets its Game Technology to be Spritekit.</p>
<h2 id="坐标系统的不同"><a href="#坐标系统的不同" class="headerlink" title="坐标系统的不同"></a>坐标系统的不同</h2><p>1.UIKit的物体坐标都是基于一个view的左上角为起点的,而SpriteKit是基于物体的中心点。<br>2.UIKit的坐标系Y:0是基于屏幕的上边沿,而SpriteKit是基于屏幕的下边沿。</p>
<h2 id="GameScene-sks-是类似于Interface-Builder的"><a href="#GameScene-sks-是类似于Interface-Builder的" class="headerlink" title="GameScene.sks 是类似于Interface Builder的"></a>GameScene.sks 是类似于Interface Builder的</h2><p>双击打开GameScene.sks,就打开了Scene Editor,这图形界面类似于Interface Builder。</p>
<h2 id="SKScene"><a href="#SKScene" class="headerlink" title="SKScene"></a>SKScene</h2><p>当建立一个project是基于Game的，那么GameScene.swift文件的GameScene这个class就是基于SKScene协议的。</p>
<h2 id="didMove-to-类似于viewDidLoad"><a href="#didMove-to-类似于viewDidLoad" class="headerlink" title="didMove(to:) 类似于viewDidLoad()"></a>didMove(to:) 类似于viewDidLoad()</h2><p>在里面写入代码:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">didMove</span>(<span class="params">to</span> <span class="params">view</span>: <span class="type">SKView</span>) &#123;</span><br><span class="line">    <span class="comment">// 建立一个背景图片的节点</span></span><br><span class="line">    <span class="keyword">let</span> background <span class="operator">=</span> <span class="type">SKSpriteNode</span>(imageNamed: <span class="string">&quot;background.jpg&quot;</span>)</span><br><span class="line">    <span class="comment">// 图片的中心点是基于CGPoint坐标的,这里设置的是屏幕的中心点</span></span><br><span class="line">    background.position <span class="operator">=</span> <span class="type">CGPoint</span>(x: <span class="number">512</span>, y: <span class="number">384</span>)</span><br><span class="line">    <span class="comment">// The .replace option means &quot;just draw it, ignoring any alpha values,&quot; which makes it fast for things without gaps such as our background.</span></span><br><span class="line">    background.blendMode <span class="operator">=</span> .replace</span><br><span class="line">    <span class="comment">// 这个背景图片的节点在整个场景的z坐标的-1位置,其实就是放在最后面</span></span><br><span class="line">    background.zPosition <span class="operator">=</span> <span class="operator">-</span><span class="number">1</span></span><br><span class="line">    <span class="comment">// 这是用于给场景添加节点的方法</span></span><br><span class="line">    addChild(background)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="override-func-didMove-to-view-SKView"><a href="#override-func-didMove-to-view-SKView" class="headerlink" title="override func didMove(to view: SKView) { }"></a>override func didMove(to view: SKView) { }</h2><p>这个类似于viewDidLoad方法。</p>
<h2 id="override-func-update-currentTime-TimeInterval"><a href="#override-func-update-currentTime-TimeInterval" class="headerlink" title="override func update(_ currentTime: TimeInterval) { }"></a>override func update(_ currentTime: TimeInterval) { }</h2><p>The update() method is called once every frame, and lets us make changes to our game.<br>Try not to do too much work, because it can slow your game down.</p>
<h2 id="override-func-touchesBegan-touches-Set-with-event-UIEvent"><a href="#override-func-touchesBegan-touches-Set-with-event-UIEvent" class="headerlink" title="override func touchesBegan(_ touches: Set, with event: UIEvent?) { }"></a>override func touchesBegan(_ touches: Set<UITouch>, with event: UIEvent?) { }</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">touchesBegan</span>(<span class="keyword">_</span> <span class="params">touches</span>: <span class="type">Set</span>&lt;<span class="type">UITouch</span>&gt;, <span class="params">with</span> <span class="params">event</span>: <span class="type">UIEvent</span>?) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 每次触碰到屏幕就会进入循环</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> touch <span class="operator">=</span> touches.first &#123;</span><br><span class="line">        <span class="comment">// 取得触碰的位置坐标</span></span><br><span class="line">        <span class="keyword">let</span> location <span class="operator">=</span> touch.location(in: <span class="keyword">self</span>)</span><br><span class="line">        <span class="comment">// 生成一个SKSpriteNode节点,该节点是基于CGSize生成的一个红色正方形</span></span><br><span class="line">        <span class="keyword">let</span> box <span class="operator">=</span> <span class="type">SKSpriteNode</span>(color: <span class="type">UIColor</span>.red, size: <span class="type">CGSize</span>(width: <span class="number">64</span>, height: <span class="number">64</span>))</span><br><span class="line">        <span class="comment">// 该正方形所放置的位置</span></span><br><span class="line">        box.position <span class="operator">=</span> location</span><br><span class="line">        <span class="comment">// 添加进场景</span></span><br><span class="line">        addChild(box)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="override-func-touchesEnded-touches-Set-with-event-UIEvent"><a href="#override-func-touchesEnded-touches-Set-with-event-UIEvent" class="headerlink" title="override func touchesEnded(_ touches: Set, with event: UIEvent?) {}"></a>override func touchesEnded(_ touches: Set<UITouch>, with event: UIEvent?) {}</h2><p>Tells the responder when one or more fingers raised from a view or window.</p>
<h2 id="override-func-touchesMoved-touches-Set-with-event-UIEvent"><a href="#override-func-touchesMoved-touches-Set-with-event-UIEvent" class="headerlink" title="override func touchesMoved(_ touches: Set, with event: UIEvent?) { }"></a>override func touchesMoved(_ touches: Set<UITouch>, with event: UIEvent?) { }</h2><p>测试下来,跟touchesBegan一样的用法,只是它只在触摸屏幕并移动时,才会被触发。<br>touchesMoved() is called when an existing touch changes position.</p>
<h2 id="SKSpriteNode-类似于各个主页面的节点"><a href="#SKSpriteNode-类似于各个主页面的节点" class="headerlink" title="SKSpriteNode 类似于各个主页面的节点"></a>SKSpriteNode 类似于各个主页面的节点</h2><p>建立一个正方形:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SKSpriteNode</span>(color: <span class="type">UIColor</span>.red, size: <span class="type">CGSize</span>(width: <span class="number">64</span>, height: <span class="number">64</span>))</span><br></pre></td></tr></table></figure>

<p>建立一个基于image文件的图形:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SKSpriteNode</span>(imageNamed:)</span><br></pre></td></tr></table></figure>

<p>好像不能直接建立一个圆形,是不是先要做一个圆形出来,随后再基于该圆形设计出该SKSpriteNode?<br>待后续碰到了再补充吧…<br>但下面代码中ball.physicsBody &#x3D; SKPhysicsBody(circleOfRadius: ball.size.width &#x2F; 2.0)就可以设计出一个圆形的物理属性来。</p>
<h3 id="SKSpriteNode-texture-gt-SKTexture-imageNamed"><a href="#SKSpriteNode-texture-gt-SKTexture-imageNamed" class="headerlink" title="SKSpriteNode.texture -&gt; SKTexture(imageNamed:)"></a>SKSpriteNode.texture -&gt; SKTexture(imageNamed:)</h3><p>class called SKTexture, which is to SKSpriteNode sort of what UIImage is to UIImageView – it holds image data, but isn’t responsible for showing it.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 之前设定的charNode是一个SKSpriteNode,显示的是图片&quot;penguinGood&quot;</span></span><br><span class="line">charNode <span class="operator">=</span> <span class="type">SKSpriteNode</span>(imageNamed: <span class="string">&quot;penguinGood&quot;</span>)</span><br><span class="line"><span class="comment">// 但现在我想把charNode显示的图片改成是&quot;penguinEvil&quot;</span></span><br><span class="line"><span class="comment">// 这时只要更改charNode的材质,即charNode.texture</span></span><br><span class="line"><span class="comment">// open class SKSpriteNode : SKNode, SKWarpable &#123;</span></span><br><span class="line"><span class="comment">//      open var texture: SKTexture?</span></span><br><span class="line">charNode.texture <span class="operator">=</span> <span class="type">SKTexture</span>(imageNamed: <span class="string">&quot;penguinEvil&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>Changing the character node’s texture like this is helpful because it means we don’t need to keep adding and removing nodes. Instead, we can just change the texture to match what kind of penguin this is, then change the node name to match so we can do tap detection later on.</p>
<h3 id="SKSpriteNode-texture"><a href="#SKSpriteNode-texture" class="headerlink" title="SKSpriteNode(texture:)"></a>SKSpriteNode(texture:)</h3><p>可以直接用SKTexture生成SKSpriteNode,而不需要再设置SKSpriteNode的texture:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 先设置SKTexture</span></span><br><span class="line"><span class="keyword">let</span> skyTexture <span class="operator">=</span> <span class="type">SKTexture</span>(imageNamed: <span class="string">&quot;sky&quot;</span>)</span><br><span class="line"><span class="comment">// 再生成SKSpriteNode</span></span><br><span class="line"><span class="keyword">let</span> sprite <span class="operator">=</span> <span class="type">SKSpriteNode</span>(texture: skyTexture)</span><br></pre></td></tr></table></figure>

<h3 id="SKSpriteNode-colorBlendFactor-x3D-1-amp-amp-SkSpriteNode-color-x3D-red"><a href="#SKSpriteNode-colorBlendFactor-x3D-1-amp-amp-SkSpriteNode-color-x3D-red" class="headerlink" title="SKSpriteNode.colorBlendFactor &#x3D; 1 &amp;&amp; SkSpriteNode.color &#x3D; .red"></a>SKSpriteNode.colorBlendFactor &#x3D; 1 &amp;&amp; SkSpriteNode.color &#x3D; .red</h3><p>Only SKSpriteNode has a colorBlendFactor property !!!<br>SKSpriteNode.colorBlendFactor是一个CGFloat,从0.0到1.0,代表与原材质的颜色的混同程序,0.0代表颜色不会改变,就是原材质,1.0代表可以完全改变原材质的颜色。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> firework <span class="operator">=</span> <span class="type">SKSpriteNode</span>(imageNamed: <span class="string">&quot;rocket&quot;</span>)</span><br><span class="line">firework.colorBlendFactor <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="comment">// 这时可以设置其的颜色</span></span><br><span class="line">fireworl.color <span class="operator">=</span> .cyan</span><br></pre></td></tr></table></figure>

<h2 id="SKShapeNode"><a href="#SKShapeNode" class="headerlink" title="SKShapeNode"></a>SKShapeNode</h2><p>SKShapeNode是SpriteKit的一个class,它可以让你在Game中方便且快捷地画出随意的图形,比如画圆形、线、长方形,之前接触到的就是使用贝塞尔图形来画画,在Project23中,水果忍者游戏中用来切水果划屏幕的那条线,它的容器就是SKShapeNode。</p>
<p>SKShapeNode有一个属性叫path,是用来描绘我们想要画的图形的。当path为nil,就什么都不画了;当path被设置为一个有效的路径的话,就可以按照SKShapeNode的设置来画图形了。<br>另外,SKShapeNode期望的path是一个CGPath属性,而我们使用UIBezierPath.cgPath就能够符合这一要求了。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> shape <span class="operator">=</span> <span class="type">SKShapeNode</span>()</span><br><span class="line">shape.path <span class="operator">=</span> <span class="type">UIBezierPath</span>(roundedRect: <span class="type">CGRect</span>(x: <span class="operator">-</span><span class="number">128</span>, y: <span class="operator">-</span><span class="number">128</span>, width: <span class="number">256</span>, height: <span class="number">256</span>), cornerRadius: <span class="number">64</span>).cgPath</span><br><span class="line">shape.position <span class="operator">=</span> <span class="type">CGPoint</span>(x: frame.midX, y: frame.midY)</span><br><span class="line">shape.fillColor <span class="operator">=</span> <span class="type">UIColor</span>.red</span><br><span class="line">shape.strokeColor <span class="operator">=</span> <span class="type">UIColor</span>.blue</span><br><span class="line">shape.lineWidth <span class="operator">=</span> <span class="number">10</span></span><br><span class="line">addChild(shape)</span><br></pre></td></tr></table></figure>

<h3 id="水果忍者中那条划过屏幕的线"><a href="#水果忍者中那条划过屏幕的线" class="headerlink" title="水果忍者中那条划过屏幕的线"></a>水果忍者中那条划过屏幕的线</h3><p>代码太多,还是看教程中的代码,读一遍就懂了。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/example-code/games/how-to-create-shapes-using-skshapenode">https://www.hackingwithswift.com/example-code/games/how-to-create-shapes-using-skshapenode</a></p>
</blockquote>
<h2 id="SKPhysicsBody属性"><a href="#SKPhysicsBody属性" class="headerlink" title="SKPhysicsBody属性"></a>SKPhysicsBody属性</h2><p>感觉是给 场景 或 节点 添加物理属性范围的。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// box虽然有两个框架,就是上面设置的正方形</span></span><br><span class="line"><span class="comment">// 但还得给这个box设置一个物理框架,范围就是这个正方形的范围(也就是说也能设置个圆形物理框架吧吧)</span></span><br><span class="line">box.physicsBody <span class="operator">=</span> <span class="type">SKPhysicsBody</span>(rectangleOf: <span class="type">CGSize</span>(width: <span class="number">64</span>, height: <span class="number">64</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// The second line of code adds a physics body to the whole scene that is a line on each edge, effectively acting like a container for the scene.</span></span><br><span class="line">physicsBody <span class="operator">=</span> <span class="type">SKPhysicsBody</span>(edgeLoopFrom: frame)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>还能添加圆形的球以及圆形的物理属性范围,<br>以及使用到 <strong>.resitution</strong> 的反弹属性,值范围为0-1的小数。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ball <span class="operator">=</span> <span class="type">SKSpriteNode</span>(imageNamed: <span class="string">&quot;ballRed&quot;</span>)</span><br><span class="line"><span class="comment">// ball的物理属性范围仍旧是其本身</span></span><br><span class="line">ball.physicsBody <span class="operator">=</span> <span class="type">SKPhysicsBody</span>(circleOfRadius: ball.size.width <span class="operator">/</span> <span class="number">2.0</span>)</span><br><span class="line"><span class="comment">// restitution是 恢复原状 的意思</span></span><br><span class="line">ball.physicsBody<span class="operator">?</span>.restitution <span class="operator">=</span> <span class="number">0.4</span></span><br><span class="line">ball.position <span class="operator">=</span> location</span><br><span class="line">addChild(ball)</span><br></pre></td></tr></table></figure>

<p>设计一个有物理属性但不会跟着动的东西,简单说就是,我造了个东西,这东西被撞了却不会动,但撞它的其他东西会被弹开:<br>这里使用到了 <strong>.isDynamic</strong> :</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> bouncer <span class="operator">=</span> <span class="type">SKSpriteNode</span>(imageNamed: <span class="string">&quot;bouncer&quot;</span>)</span><br><span class="line">bouncer.position <span class="operator">=</span> <span class="type">CGPoint</span>(x: <span class="number">512</span>, y: <span class="number">0</span>)</span><br><span class="line">bouncer.physicsBody <span class="operator">=</span> <span class="type">SKPhysicsBody</span>(circleOfRadius: bouncer.size.width <span class="operator">/</span> <span class="number">2.0</span>)</span><br><span class="line">bouncer.physicsBody<span class="operator">?</span>.isDynamic <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">addChild(bouncer)</span><br></pre></td></tr></table></figure>

<h3 id="SKPhysicsBody-texture-lt-T-SKTexture-gt-size-lt-T-CGSize-gt"><a href="#SKPhysicsBody-texture-lt-T-SKTexture-gt-size-lt-T-CGSize-gt" class="headerlink" title="SKPhysicsBody(texture: &lt;#T##SKTexture#&gt;, size: &lt;#T##CGSize#&gt;)"></a>SKPhysicsBody(texture: &lt;#T##SKTexture#&gt;, size: &lt;#T##CGSize#&gt;)</h3><p>之前都是SKPhysicsBody(circleOfRadius),或者SKPhysicsBody(rectangleOf: &lt;#T##CGSize#&gt;)来定义,虽然对生成SKPhysicsBody的效率会有很大的提高,但有时候需要让该物体的每个pixel都作为SKPhysicsBody的时候,就需要用到SKPhysicsBody(texture: &lt;#T##SKTexture#&gt;, size: &lt;#T##CGSize#&gt;),虽然会降低效率,但有时是有必要的。<br>SpriteKit can create pixel-perfect collision detection by examining the pixels in a sprite’s texture.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// let sprite = SKSpriteNode(imageNamed: &quot;enemy&quot;)</span></span><br><span class="line"></span><br><span class="line">sprite.physicsBody <span class="operator">=</span> <span class="type">SKPhysicsBody</span>(texture: sprite.texture<span class="operator">!</span>, size: sprite.size)</span><br></pre></td></tr></table></figure>

<h3 id="节点的physicsBody-categoryBitMask属性"><a href="#节点的physicsBody-categoryBitMask属性" class="headerlink" title="节点的physicsBody?.categoryBitMask属性"></a>节点的physicsBody?.categoryBitMask属性</h3><p>碰撞的时候,需要识别碰撞体,最简单的方式,是给节点设置一个name的值,但也可以给节点的physicsBody?.categoryBitMask添加值,这里的bit可以理解为是位运算的意思。<br>注意：UInt8,UInt16,UInt32,UInt64 分别表示 8 位,16 位,32 位 和 64 位的无符号整数形式。<br>比如:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置物理体的标示符  &lt;&lt;左移运算符  左移一位，相当于扩大2倍</span></span><br><span class="line"><span class="keyword">let</span> birdCategory: <span class="type">UInt32</span> <span class="operator">=</span> <span class="number">1</span> <span class="operator">&lt;&lt;</span> <span class="number">0</span>  <span class="comment">//1</span></span><br><span class="line"><span class="keyword">let</span> worldCategory: <span class="type">UInt32</span> <span class="operator">=</span> <span class="number">1</span> <span class="operator">&lt;&lt;</span> <span class="number">1</span>  <span class="comment">//2</span></span><br><span class="line"><span class="keyword">let</span> pipeCategory: <span class="type">UInt32</span> <span class="operator">=</span> <span class="number">1</span> <span class="operator">&lt;&lt;</span> <span class="number">2</span>  <span class="comment">//4</span></span><br><span class="line"><span class="keyword">let</span> scoreCategory: <span class="type">UInt32</span> <span class="operator">=</span> <span class="number">1</span> <span class="operator">&lt;&lt;</span> <span class="number">3</span>  <span class="comment">//8</span></span><br></pre></td></tr></table></figure>
<p>具体的例子见 ontactTestBitMask &amp;&amp; collisionBitMask 知识点。(会带上上面的四个标识符一起使用)</p>
<h3 id="节点的physicsBody-的velocity速度属性"><a href="#节点的physicsBody-的velocity速度属性" class="headerlink" title="节点的physicsBody?的velocity速度属性"></a>节点的physicsBody?的velocity速度属性</h3><p>可设置该节点的速度,比如在touchesBegan方法中,当用户点击屏幕,就对速度进行更改:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">touchesBegan</span>(<span class="keyword">_</span> <span class="params">touches</span>: <span class="type">Set</span>&lt;<span class="type">UITouch</span>&gt;, <span class="params">with</span> <span class="params">event</span>: <span class="type">UIEvent</span>?) &#123;</span><br><span class="line">    <span class="comment">// 省略其他代码</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 本来因为重力等原因dy是负值,用户点击的同时,值为0</span></span><br><span class="line">    bird.physicsBody<span class="operator">?</span>.velocity <span class="operator">=</span> <span class="type">CGVector</span>(dx: <span class="number">0</span>, dy: <span class="number">0</span>)</span><br><span class="line">    <span class="comment">// 但一旦停止点击,dy的值又会变成负值,小鸟又会不断下降,这是因为</span></span><br><span class="line">    <span class="comment">// self.physicsWorld.gravity = CGVector(dx: 0.0, dy: -3.0) 这个的预先设定</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 此时可以给其一个向上的速度或是力</span></span><br><span class="line">    bird.physicsBody<span class="operator">?</span>.applyImpulse(<span class="type">CGVector</span>(dx: <span class="number">0</span>, dy: <span class="number">10</span>))</span><br></pre></td></tr></table></figure>

<h3 id="节点的physicsBody-的applyImpulse方法"><a href="#节点的physicsBody-的applyImpulse方法" class="headerlink" title="节点的physicsBody?的applyImpulse方法"></a>节点的physicsBody?的applyImpulse方法</h3><p>在 “节点的physicsBody?的velocity速度属性”知识点的例子中已经出现。</p>
<h3 id="节点的physicsBody-的angularVelocity属性"><a href="#节点的physicsBody-的angularVelocity属性" class="headerlink" title="节点的physicsBody?的angularVelocity属性"></a>节点的physicsBody?的angularVelocity属性</h3><p>angularVelocity 是指自身旋转的速度。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sprite.physicsBody = SKPhysicsBody(texture: sprite.texture!, size: sprite.size)</span></span><br><span class="line"></span><br><span class="line">sprite.physicsBody<span class="operator">?</span>.angularVelocity <span class="operator">=</span> <span class="number">5</span></span><br></pre></td></tr></table></figure>

<h3 id="节点的physicsBody-angularDamping属性"><a href="#节点的physicsBody-angularDamping属性" class="headerlink" title="节点的physicsBody?angularDamping属性"></a>节点的physicsBody?angularDamping属性</h3><p>angularDamping 是指减少自身旋转的速度。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sprite.physicsBody = SKPhysicsBody(texture: sprite.texture!, size: sprite.size)</span></span><br><span class="line"><span class="comment">// sprite.physicsBody?.angularVelocity = 5</span></span><br><span class="line"></span><br><span class="line">sprite.physicsBody<span class="operator">?</span>.angularDamping <span class="operator">=</span> <span class="number">2</span></span><br></pre></td></tr></table></figure>

<h3 id="节点的physicsBody-linearDamping属性"><a href="#节点的physicsBody-linearDamping属性" class="headerlink" title="节点的physicsBody?linearDamping属性"></a>节点的physicsBody?linearDamping属性</h3><p>linearDampin 是指减少linear上的移动速度。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sprite.physicsBody = SKPhysicsBody(texture: sprite.texture!, size: sprite.size)</span></span><br><span class="line"><span class="comment">// sprite.physicsBody?.velocity = CGVector(dx: -500, dy: 0)</span></span><br><span class="line"></span><br><span class="line">sprite.physicsBody<span class="operator">?</span>.linearDamping <span class="operator">=</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h2 id="SKScene的physicsWorld属性"><a href="#SKScene的physicsWorld属性" class="headerlink" title="SKScene的physicsWorld属性"></a>SKScene的physicsWorld属性</h2><h3 id="SKScene的physicsWorld-gravity–重力属性"><a href="#SKScene的physicsWorld-gravity–重力属性" class="headerlink" title="SKScene的physicsWorld.gravity–重力属性"></a>SKScene的physicsWorld.gravity–重力属性</h3><p>其实感觉不能叫重力属性,因为你可以设置成各个方向都有引力。<br>self.physicsWorld.gravity是CGVector数据类型。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span>.physicsWorld.gravity <span class="operator">=</span> <span class="type">CGVector</span>(dx: <span class="number">0.0</span>, dy: <span class="operator">-</span><span class="number">3.0</span>)</span><br></pre></td></tr></table></figure>
<p>以上代码,代表x方向没有正引力也没有负引力,y方向有3个负引力。</p>
<h3 id="SKScene的physicsWorld-contactDelegate-代理"><a href="#SKScene的physicsWorld-contactDelegate-代理" class="headerlink" title="SKScene的physicsWorld.contactDelegate 代理"></a>SKScene的physicsWorld.contactDelegate 代理</h3><p>物理世界的碰撞检测代理一般都设置为场景自己:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span>.physicsWorld.contactDelegate <span class="operator">=</span> <span class="keyword">self</span></span><br></pre></td></tr></table></figure>
<p>此时场景需要遵循 SKPhysicsContactDelegate 的代理协议。</p>
<h2 id="SKAction"><a href="#SKAction" class="headerlink" title="SKAction"></a>SKAction</h2><h3 id="SKAction-rotate"><a href="#SKAction-rotate" class="headerlink" title="SKAction.rotate"></a>SKAction.rotate</h3><p>先加载一个图形:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> slotGlow: <span class="type">SKSpriteNode</span> <span class="operator">=</span> <span class="type">SKSpriteNode</span>(imageNamed: <span class="string">&quot;slotGlowGood&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>是这个样子的:<br><img src="/Images/slotGlowGood@2x.png" alt="slotGlowGood@2x"></p>
<p>我们要让它沿着中心点始终在转:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如何运动:</span></span><br><span class="line"><span class="comment">// 1.旋转 -- rotate</span></span><br><span class="line"><span class="comment">// 2.角度一个pi,即180度</span></span><br><span class="line"><span class="comment">// 3.时间为10秒,就是旋转的快慢</span></span><br><span class="line"><span class="keyword">let</span> spin <span class="operator">=</span> <span class="type">SKAction</span>.rotate(byAngle: .pi, duration: <span class="number">10</span>)</span><br><span class="line"><span class="comment">// 始终在旋转不停止</span></span><br><span class="line"><span class="keyword">let</span> spinForever <span class="operator">=</span> <span class="type">SKAction</span>.repeatForever(spin)</span><br><span class="line"><span class="comment">// 让这个slotGlow运行这个运动模式</span></span><br><span class="line">slotGlow.run(spinForever)</span><br></pre></td></tr></table></figure>

<h3 id="SKAction-moveBy-x-y-duration"><a href="#SKAction-moveBy-x-y-duration" class="headerlink" title="SKAction.moveBy(x:y:duration:)"></a>SKAction.moveBy(x:y:duration:)</h3><p>移动位置及持续时间。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// charNode = SKSpriteNode(imageNamed: &quot;penguinGood&quot;)</span></span><br><span class="line"><span class="comment">// charNode已可在主画面显示</span></span><br><span class="line">charNode.run(<span class="type">SKAction</span>.moveBy(x: <span class="number">0</span>, y: <span class="number">80</span>, duration: <span class="number">0.05</span>))</span><br></pre></td></tr></table></figure>

<h3 id="SKAction-wait-forDuration"><a href="#SKAction-wait-forDuration" class="headerlink" title="SKAction.wait(forDuration:)"></a>SKAction.wait(forDuration:)</h3><p>等待。以秒计算。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> delay <span class="operator">=</span> <span class="type">SKAction</span>.wait(forDuration: <span class="number">0.25</span>)</span><br></pre></td></tr></table></figure>

<h3 id="SKAction-animate-with-lt-T-SKTexture-gt-timePerFrame-lt-T-TimeInterval-gt"><a href="#SKAction-animate-with-lt-T-SKTexture-gt-timePerFrame-lt-T-TimeInterval-gt" class="headerlink" title="SKAction.animate(with: &lt;#T##[SKTexture]#&gt;, timePerFrame: &lt;#T##TimeInterval#&gt;)"></a>SKAction.animate(with: &lt;#T##[SKTexture]#&gt;, timePerFrame: &lt;#T##TimeInterval#&gt;)</h3><p>比如做一个小鸟飞翔的动画,可以拿到的小鸟的照片分别是bird-01&#x2F;bird-02&#x2F;bird-03,图像分别是:<br><img src="/Images/bird-01.png" alt="bird-01"><img src="/Images/bird-02.png" alt="bird-02"><img src="/Images/bird-03.png" alt="bird-03"><br>代码是:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bird = SKSpriteNode(imageNamed: &quot;bird-01&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> birdTexture1 <span class="operator">=</span> <span class="type">SKTexture</span>(imageNamed: <span class="string">&quot;bird-01&quot;</span>)</span><br><span class="line">birdTexture1.filteringMode <span class="operator">=</span> .nearest</span><br><span class="line"><span class="keyword">let</span> birdTexture2 <span class="operator">=</span> <span class="type">SKTexture</span>(imageNamed: <span class="string">&quot;bird-02&quot;</span>)</span><br><span class="line">birdTexture2.filteringMode <span class="operator">=</span> .nearest</span><br><span class="line"><span class="keyword">let</span> birdTexture3 <span class="operator">=</span> <span class="type">SKTexture</span>(imageNamed: <span class="string">&quot;bird-03&quot;</span>)</span><br><span class="line">birdTexture3.filteringMode <span class="operator">=</span> .nearest</span><br><span class="line"><span class="keyword">let</span> anim <span class="operator">=</span> <span class="type">SKAction</span>.animate(with: [birdTexture1,birdTexture2,birdTexture3], timePerFrame: <span class="number">0.2</span>)</span><br><span class="line">bird.run(<span class="type">SKAction</span>.repeatForever(anim), withKey: <span class="string">&quot;fly&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="SKAction-run-block"><a href="#SKAction-run-block" class="headerlink" title="SKAction.run(block:)"></a>SKAction.run(block:)</h3><p>SKAction.run(block:) will run any code we want, provided as a closure. “Block” is Objective-C’s name for a Swift closure.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> notVisible <span class="operator">=</span> <span class="type">SKAction</span>.run &#123; [<span class="keyword">unowned</span> <span class="keyword">self</span>] <span class="keyword">in</span> <span class="keyword">self</span>.isVisible <span class="operator">=</span> <span class="literal">false</span> &#125;</span><br></pre></td></tr></table></figure>
<p>为何要用SKAction.run来执行这段代码,而不是直接去执行呢?<br>感觉是因为类似下面的SKAction.sequence()需要依序执行action和改变一些属性的情况。</p>
<h3 id="SKSpriteNode-run-lt-T-action-SKAction-SKAction-gt-withKey-lt-T-String-gt"><a href="#SKSpriteNode-run-lt-T-action-SKAction-SKAction-gt-withKey-lt-T-String-gt" class="headerlink" title="SKSpriteNode.run(&lt;#T##action: SKAction##SKAction#&gt;, withKey: &lt;#T##String#&gt;)"></a>SKSpriteNode.run(&lt;#T##action: SKAction##SKAction#&gt;, withKey: &lt;#T##String#&gt;)</h3><p>这里出现一个withKey参数,可以这么设置:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bird.run(<span class="type">SKAction</span>.repeatForever(anim), withKey: <span class="string">&quot;fly&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>如果要停止这个动画,就可以使用到:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bird.removeAction(forKey: <span class="string">&quot;fly&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>还有一个让SKLabelNode显示的文字瞬间变大又还原的案例:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scoreLabelNode.run(<span class="type">SKAction</span>.sequence([<span class="type">SKAction</span>.scale(to: <span class="number">1.5</span>, duration: <span class="type">TimeInterval</span>(<span class="number">0.1</span>)), <span class="type">SKAction</span>.scale(to: <span class="number">1.0</span>, duration: <span class="type">TimeInterval</span>(<span class="number">0.1</span>))]))</span><br></pre></td></tr></table></figure>
<p><img src="/Images/SKLabelNodeScale.gif" alt="SKLabelNodeScale"></p>
<h3 id="SKSpriteNode-removeAction-forKey-lt-T-String-gt"><a href="#SKSpriteNode-removeAction-forKey-lt-T-String-gt" class="headerlink" title="SKSpriteNode.removeAction(forKey: &lt;#T##String#&gt;)"></a>SKSpriteNode.removeAction(forKey: &lt;#T##String#&gt;)</h3><p>紧接着上面的例子,用法是:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bird.removeAction(forKey: <span class="string">&quot;fly&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="SKAction-sequence"><a href="#SKAction-sequence" class="headerlink" title="SKAction.sequence()"></a>SKAction.sequence()</h3><p>SKAction.sequence() takes an array of actions, and executes them in order. Each action won’t start executing until the previous one finished.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">hit</span>() &#123;</span><br><span class="line">    isHit <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> delay <span class="operator">=</span> <span class="type">SKAction</span>.wait(forDuration: <span class="number">0.25</span>)</span><br><span class="line">    <span class="keyword">let</span> hide <span class="operator">=</span> <span class="type">SKAction</span>.moveBy(x: <span class="number">0</span>, y: <span class="operator">-</span><span class="number">80</span>, duration: <span class="number">0.5</span>)</span><br><span class="line">    <span class="keyword">let</span> notVisible <span class="operator">=</span> <span class="type">SKAction</span>.run &#123; [<span class="keyword">unowned</span> <span class="keyword">self</span>] <span class="keyword">in</span> <span class="keyword">self</span>.isVisible <span class="operator">=</span> <span class="literal">false</span> &#125;</span><br><span class="line">    charNode.run(<span class="type">SKAction</span>.sequence([delay, hide, notVisible]))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="SKAction-group"><a href="#SKAction-group" class="headerlink" title="SKAction.group()"></a>SKAction.group()</h3><p>An action group specifies that all actions inside it should execute simultaneously.<br>这里要注意的一点是,SKAction.group()内的SKAction,是同时执行的,所以我们平时可以配合SKAction.sequence()一起使用,但要注意两者的明显不同之处。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> scaleOut <span class="operator">=</span> <span class="type">SKAction</span>.scale(to: <span class="number">0.001</span>, duration: <span class="number">0.2</span>)</span><br><span class="line"><span class="keyword">let</span> fadeOut <span class="operator">=</span> <span class="type">SKAction</span>.fadeOut(withDuration: <span class="number">0.2</span>)</span><br><span class="line"><span class="keyword">let</span> group <span class="operator">=</span> <span class="type">SKAction</span>.group([scaleOut, fadeOut])</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> seq <span class="operator">=</span> <span class="type">SKAction</span>.sequence([group, .removeFromParent()])</span><br><span class="line">node.run(seq)</span><br></pre></td></tr></table></figure>

<h3 id="背景闪电的案例"><a href="#背景闪电的案例" class="headerlink" title="背景闪电的案例"></a>背景闪电的案例</h3><p>使用到 SKAction.sequence() &#x2F; SKAction.run &#x2F; SKAction.wait &#x2F; SKScene.run<br>效果图:<br><img src="/Images/backgroundcolorFlash.gif" alt="backgroundcolorFlash"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// var skyColor = SKColor(red: 81.0/255.0, green: 192.0/255.0, blue: 201.0/255.0, alpha: 1.0)</span></span><br><span class="line"><span class="comment">// self.backgroundColor = skyColor</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 当系统检测到特定碰撞时,即调用该bgFlash方法:</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">bgFlash</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> bgFlash <span class="operator">=</span> <span class="type">SKAction</span>.run (&#123;</span><br><span class="line">        <span class="keyword">self</span>.backgroundColor <span class="operator">=</span> <span class="type">SKColor</span>(red: <span class="number">1</span>, green: <span class="number">0</span>, blue: <span class="number">0</span>, alpha: <span class="number">1.0</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">let</span> bgNormal <span class="operator">=</span> <span class="type">SKAction</span>.run (&#123;</span><br><span class="line">        <span class="keyword">self</span>.backgroundColor <span class="operator">=</span> <span class="keyword">self</span>.skyColor</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">let</span> bgFlashAndNormal <span class="operator">=</span> <span class="type">SKAction</span>.sequence([bgFlash, <span class="type">SKAction</span>.wait(forDuration: <span class="type">TimeInterval</span>(<span class="number">0.05</span>)), bgNormal, <span class="type">SKAction</span>.wait(forDuration: <span class="type">TimeInterval</span>(<span class="number">0.05</span>))])</span><br><span class="line">    <span class="keyword">self</span>.run(<span class="type">SKAction</span>.sequence([<span class="type">SKAction</span>.repeat(bgFlashAndNormal, count: <span class="number">4</span>)]), withKey: <span class="string">&quot;flash&quot;</span>)</span><br><span class="line">    <span class="comment">// 加了下面这行代码就没了效果,感觉是异步的原因,</span></span><br><span class="line">    <span class="comment">// 上一行代码还没执行完,下一行就开始执行了,所以无效了。</span></span><br><span class="line">    <span class="comment">// self.removeAction(forKey: &quot;flash&quot;)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="“Game-Over”-字样从天而降-的案例"><a href="#“Game-Over”-字样从天而降-的案例" class="headerlink" title="“Game Over” 字样从天而降 的案例"></a>“Game Over” 字样从天而降 的案例</h3><p>使用到SKScene的默认Bool属性isUserInteractionEnabled,值为true。</p>
<p>以下例子是在游戏结束的瞬间:<br>1、玩家不能点击屏幕;<br>2、Game Over 字样从天而降;<br>3、玩家此时才能点击屏幕得到响应。</p>
<p><img src="/Images/gameover.gif" alt="GameOver"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//lazy var gameOverLabel: SKLabelNode = &#123;</span></span><br><span class="line"><span class="comment">//    let label = SKLabelNode(fontNamed: &quot;Chalkduster&quot;)</span></span><br><span class="line"><span class="comment">//    label.text = &quot;Game Over&quot;</span></span><br><span class="line"><span class="comment">//    return label</span></span><br><span class="line"><span class="comment">//&#125;()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// SKScene的默认属性isUserInteractionEnabled为true,此时用户是可以随便点击屏幕并有响应的</span></span><br><span class="line">isUserInteractionEnabled <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">addChild(gameOverLabel)</span><br><span class="line">gameOverLabel.position <span class="operator">=</span> <span class="type">CGPoint</span>(x: <span class="keyword">self</span>.size.width <span class="operator">*</span> <span class="number">0.5</span>, y: <span class="keyword">self</span>.size.height)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> delay <span class="operator">=</span> <span class="type">SKAction</span>.wait(forDuration: <span class="type">TimeInterval</span>(<span class="number">1</span>))</span><br><span class="line"><span class="keyword">let</span> move <span class="operator">=</span> <span class="type">SKAction</span>.move(by: <span class="type">CGVector</span>(dx: <span class="number">0</span>, dy: <span class="operator">-</span><span class="keyword">self</span>.size.height <span class="operator">*</span> <span class="number">0.5</span>), duration: <span class="number">1</span>)</span><br><span class="line">gameOverLabel.run(<span class="type">SKAction</span>.sequence([delay, move]), completion: &#123;</span><br><span class="line">    <span class="keyword">self</span>.isUserInteractionEnabled <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="SKAction-playSoundFileNamed"><a href="#SKAction-playSoundFileNamed" class="headerlink" title="SKAction.playSoundFileNamed()"></a>SKAction.playSoundFileNamed()</h3><p>SKAction.playSoundFileNamed()是在SKAction中用来播放声音的。</p>
<p>The three main sound file formats you’ll use are MP3, M4A and CAF, with the latter being a renamed AIFF file. AIFF is a pretty terrible file format when it comes to file size, but it’s much faster to load and use than MP3s and M4As, so you’ll use them often.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run(<span class="type">SKAction</span>.playSoundFileNamed(<span class="string">&quot;whackBad.caf&quot;</span>, waitForCompletion: <span class="literal">false</span>))</span><br></pre></td></tr></table></figure>
<p>这里是直接run,其实是因为func是在GameScene中,所以可以直接用run。而若你是在其他SKNode中,个人认为是可以使用SKNode.run()的。<br>注意:这里的run不同于SKAction.run(block:)</p>
<h3 id="SKaction-follow-lt-T-CGPath-gt-asOffset-lt-T-Bool-gt-orientToPath-lt-T-Bool-gt-speed-lt-T-CGFloat-gt"><a href="#SKaction-follow-lt-T-CGPath-gt-asOffset-lt-T-Bool-gt-orientToPath-lt-T-Bool-gt-speed-lt-T-CGFloat-gt" class="headerlink" title="SKaction.follow(&lt;#T##CGPath#&gt;, asOffset: &lt;#T##Bool#&gt;, orientToPath: &lt;#T##Bool#&gt;, speed: &lt;#T##CGFloat#&gt;)"></a>SKaction.follow(&lt;#T##CGPath#&gt;, asOffset: &lt;#T##Bool#&gt;, orientToPath: &lt;#T##Bool#&gt;, speed: &lt;#T##CGFloat#&gt;)</h3><p>意思是action是跟随者着CGPath的路径进行。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> path <span class="operator">=</span> <span class="type">UIBezierPath</span>()</span><br><span class="line">path.move(to: .zero)</span><br><span class="line">path.addLine(to: <span class="type">CGPoint</span>(x: xMovement, y: <span class="number">1000</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// orientToPath 的意思是跟着路径一起旋转角度。</span></span><br><span class="line"><span class="keyword">let</span> move <span class="operator">=</span> <span class="type">SKAction</span>.follow(path.cgPath, asOffset: <span class="literal">true</span>, orientToPath: <span class="literal">true</span>, speed: <span class="number">200</span>)</span><br><span class="line">node.run(move)</span><br></pre></td></tr></table></figure>
<p>给这个node设置了一个SKAction,这个SKAction是跟随这贝塞尔曲线(但上面确实直线,应该是跟上面的path有关系)运动。</p>
<p>The follow() method takes three other parameters, all of which are useful. The first decides whether the path coordinates are absolute or are relative to the node’s current position. If you specify asOffset as true, it means any coordinates in your path are adjusted to take into account the node’s position.<br>The third parameter to follow() is orientToPath and makes a complicated task into an easy one. When it’s set to true, the node will automatically rotate itself as it moves on the path so that it’s always facing down the path. Perfect for fireworks, and indeed most things! Finally, you can specify a speed to adjust how fast it moves along the path.</p>
<h2 id="SKPhysicsContactDelegate"><a href="#SKPhysicsContactDelegate" class="headerlink" title="SKPhysicsContactDelegate"></a>SKPhysicsContactDelegate</h2><p><strong>SKPhysicsContactDelegate协议</strong> 就类似于针对物理碰撞的处理器,所以一般都是符合SKScene协议的class(比如例子里就是GameScene) 需要另外去遵循的:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">GameScene</span>: <span class="title class_">SKScene</span>, <span class="title class_">SKPhysicsContactDelegate</span> &#123;</span><br></pre></td></tr></table></figure>

<p>此外,在didMove(to:)中我们需要添加的:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">didMove</span>(<span class="params">to</span> <span class="params">view</span>: <span class="type">SKView</span>) &#123;</span><br><span class="line">    <span class="comment">// 之前这行代码,就是让整个屏幕作为一个物理属性范围</span></span><br><span class="line">    physicsBody <span class="operator">=</span> <span class="type">SKPhysicsBody</span>(edgeLoopFrom: frame)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 让这整理屏幕作为一个物理属性范围,那么它的碰撞处理器是什么呢?</span></span><br><span class="line">    <span class="comment">// 是self,就是 class GameScene: SKScene, SKPhysicsContactDelegate &#123;</span></span><br><span class="line">    <span class="comment">// 这也是GameScene为什么要遵循SKPhysicsContactDelegate协议的原因</span></span><br><span class="line">    physicsWorld.contactDelegate <span class="operator">=</span> <span class="keyword">self</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="contactTestBitMask-amp-amp-collisionBitMask"><a href="#contactTestBitMask-amp-amp-collisionBitMask" class="headerlink" title="contactTestBitMask &amp;&amp; collisionBitMask"></a>contactTestBitMask &amp;&amp; collisionBitMask</h2><p>The <strong>collisionBitMask</strong> bitmask means “which nodes should I bump into?” By default, it’s set to everything, which is why our ball are already hitting each other and the bouncers. The <strong>contactTestBitMask</strong> bitmask means “which collisions do you want to know about?” and by default it’s set to nothing. So by setting <strong>contactTestBitMask</strong> to the value of <strong>collisionBitMask</strong> we’re saying, “tell me about every collision.”</p>
<p>所以下面的代码:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ball.physicsBody<span class="operator">!</span>.contactTestBitMask <span class="operator">=</span> ball.physicsBody<span class="operator">!</span>.collisionBitMask           </span><br></pre></td></tr></table></figure>
<p>ball.physicsBody!.collisionBitMask代表 球 的所有碰撞情况,前半句ball.physicsBody!.contactTestBitMask的意思是,哪些是需要进行上报的碰撞。<br>整个连起来就是,每个球的所有碰撞都得上报碰撞事件。</p>
<p>下面是一个完整的关于多个物体碰撞的例子:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置物理体的标示符  &lt;&lt;左移运算符  左移一位，相当于扩大2倍</span></span><br><span class="line"><span class="keyword">let</span> birdCategory: <span class="type">UInt32</span> <span class="operator">=</span> <span class="number">1</span> <span class="operator">&lt;&lt;</span> <span class="number">0</span>  <span class="comment">//1 二进制表示是1</span></span><br><span class="line"><span class="keyword">let</span> worldCategory: <span class="type">UInt32</span> <span class="operator">=</span> <span class="number">1</span> <span class="operator">&lt;&lt;</span> <span class="number">1</span>  <span class="comment">//2 二进制表示是10</span></span><br><span class="line"><span class="keyword">let</span> pipeCategory: <span class="type">UInt32</span> <span class="operator">=</span> <span class="number">1</span> <span class="operator">&lt;&lt;</span> <span class="number">2</span>  <span class="comment">//4 二进制表示是100</span></span><br><span class="line"><span class="keyword">let</span> scoreCategory: <span class="type">UInt32</span> <span class="operator">=</span> <span class="number">1</span> <span class="operator">&lt;&lt;</span> <span class="number">3</span>  <span class="comment">//8 二进制表示是1000</span></span><br></pre></td></tr></table></figure>

<p>给每个物理体设置physicsBody?.categoryBitMask的标识符:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 给地面添加一个识别</span></span><br><span class="line">ground.physicsBody<span class="operator">?</span>.categoryBitMask <span class="operator">=</span> worldCategory</span><br><span class="line"><span class="comment">// 给鸟添加一个识别</span></span><br><span class="line">bird.physicsBody<span class="operator">?</span>.categoryBitMask <span class="operator">=</span> birdCategory</span><br><span class="line"><span class="comment">// 给管道添加一个识别</span></span><br><span class="line">pipe.physicsBody<span class="operator">?</span>.categoryBitMask <span class="operator">=</span> pipeCategory</span><br><span class="line"><span class="comment">// 给得分墙添加一个识别</span></span><br><span class="line">contactNode.physicsBody<span class="operator">?</span>.categoryBitMask <span class="operator">=</span> scoreCategory</span><br></pre></td></tr></table></figure>

<p>给所有对于鸟可能发生的碰撞进行定义:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bird.physicsBody<span class="operator">?</span>.collisionBitMask <span class="operator">=</span> worldCategory <span class="operator">|</span> pipeCategory <span class="operator">|</span> scoreCategory </span><br><span class="line"><span class="comment">// 或运算,答案是14, 二进制表示是1110</span></span><br><span class="line"><span class="comment">// 上面这行代码可以不写的,因为你不定义collisionBitMask的话,collisionBitMask就代表所有会发生的碰撞。</span></span><br><span class="line"><span class="comment">// 但这样把所有可能发生的碰撞全写上,毕竟是笔记,尽量要全一点</span></span><br></pre></td></tr></table></figure>

<p>给所有对于鸟来说需要上报通知的碰撞进行定义:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bird.physicsBody<span class="operator">?</span>.contactTestBitMask <span class="operator">=</span> worldCategory <span class="operator">|</span> pipeCategory <span class="operator">|</span> scoreCategory</span><br><span class="line"><span class="comment">// 把以上三种会碰到的碰撞规定需要上报</span></span><br><span class="line"><span class="comment">// 这三种碰撞是所有可能的碰撞,所以代码也可以这样写:</span></span><br><span class="line"><span class="comment">// bird.physicsBody?.contactTestBitMask = bird.physicsBody?.collisionBitMask</span></span><br></pre></td></tr></table></figure>

<p>以上是对鸟可能发生的碰撞以及需要上报通知的定义,你完全可以去定义 地面&#x2F;管道&#x2F;得分墙 的可能发生的碰撞以及需要上报通知的情况,<br>毕竟这里代码参考的文章中就是这么写的。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/bc22ee0f87b4">https://www.jianshu.com/p/bc22ee0f87b4</a><br>但觉得没必要,你只要定义鸟的collisionBitMask和contactTestBitMask部分就可以了,如果遇到更复杂的情况,倒是可以对类似 地面&#x2F;管道&#x2F;得分墙 进行细节上的再定义。</p>
</blockquote>
<p>所以当碰撞发生的时候就可以去判断:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">didBegin</span>(<span class="keyword">_</span> <span class="params">contact</span>: <span class="type">SKPhysicsContact</span>) &#123;</span><br><span class="line">    <span class="comment">// 当上报的是scoreCategory,就知道是和得分墙的碰撞,这是就要进行加分等操作了</span></span><br><span class="line">    <span class="keyword">if</span> contact.bodyA.categoryBitMask <span class="operator">==</span> scoreCategory <span class="operator">||</span> contact.bodyB.categoryBitMask <span class="operator">==</span> scoreCategory &#123;</span><br><span class="line">        score <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">        scoreLabelNode.text <span class="operator">=</span> <span class="type">String</span>(score)</span><br><span class="line">        scoreLabelNode.run(<span class="type">SKAction</span>.sequence([<span class="type">SKAction</span>.scale(to: <span class="number">1.5</span>, duration: <span class="type">TimeInterval</span>(<span class="number">0.1</span>)), <span class="type">SKAction</span>.scale(to: <span class="number">1.0</span>, duration: <span class="type">TimeInterval</span>(<span class="number">0.1</span>))]))</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 当不是与得分墙的碰撞的话,就是鸟与管道或者地面的相撞了</span></span><br><span class="line">        <span class="comment">// collisionBitMask 设置成 worldCategory,是防止与管道再次发生相撞,让其直接掉到地上,</span></span><br><span class="line">        <span class="comment">// 若设置为0,因为标识符没有0的,就会发生一种情况,</span></span><br><span class="line">        <span class="comment">// 那就是小鸟直接往下掉,掉出屏幕！</span></span><br><span class="line">        bird.physicsBody<span class="operator">?</span>.collisionBitMask <span class="operator">=</span> worldCategory</span><br><span class="line">        overStatus()</span><br><span class="line">        bgFlash()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是,这样设置还是出现了问题,问题就是,当鸟撞上了得分墙了以后,它就被堵在了那里不能动了,所以鸟的collisionBitMask和contactTestBitMask都要去除scoreCategory:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bird.physicsBody<span class="operator">?</span>.collisionBitMask <span class="operator">=</span> worldCategory <span class="operator">|</span> pipeCategory</span><br><span class="line">bird.physicsBody<span class="operator">?</span>.contactTestBitMask <span class="operator">=</span> worldCategory <span class="operator">|</span> pipeCategory</span><br></pre></td></tr></table></figure>
<p>但是去除后,就不会有和得分墙的碰撞,也就无法产生得分了。<br>这时候就要在得分墙上动脑筋了:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">contactNode.physicsBody<span class="operator">?</span>.contactTestBitMask <span class="operator">=</span> birdCategory</span><br></pre></td></tr></table></figure>
<p>对于鸟的碰撞,contactNode需要去通知汇报碰撞情况,而此时因为鸟是被动一方,所以继续畅通无阻地通过这堵得分墙。</p>
<p>对于这个问题,总结一点,就是鸟设置的碰撞排除掉空气墙,而空气墙设置的碰撞要针对鸟,这样就行了。</p>
<h2 id="func-didBegin-contact-SKPhysicsContact"><a href="#func-didBegin-contact-SKPhysicsContact" class="headerlink" title="func didBegin(_ contact: SKPhysicsContact) {"></a>func didBegin(_ contact: SKPhysicsContact) {</h2><p>这是SKPhysicsContactDelegate默认会有的一个方法。<br>如果发生碰撞并上报事件了,就会调用该方法:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 之前要给需要的SKSpriteNode节点取名字,比如</span></span><br><span class="line"><span class="comment">// slotBase.name = &quot;good&quot;</span></span><br><span class="line"><span class="comment">// slotBase.name = &quot;bad&quot;</span></span><br><span class="line"><span class="comment">// ball.name = &quot;ball&quot;</span></span><br><span class="line"><span class="comment">// 这里多说一句,可以给节点取名字,也可以给节点的physicsBody?.categoryBitMask添加值,这样更好,</span></span><br><span class="line"><span class="comment">// 具体见 physicsBody?.categoryBitMask的讲解。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">didBegin</span>(<span class="keyword">_</span> <span class="params">contact</span>: <span class="type">SKPhysicsContact</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> contact.bodyA.node<span class="operator">?</span>.name <span class="operator">==</span> <span class="string">&quot;ball&quot;</span> &#123;</span><br><span class="line">        collisionBetween(ball: contact.bodyA.node<span class="operator">!</span>, object: contact.bodyB.node<span class="operator">!</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> contact.bodyB.node<span class="operator">?</span>.name <span class="operator">==</span> <span class="string">&quot;ball&quot;</span> &#123;</span><br><span class="line">        collisionBetween(ball: contact.bodyB.node<span class="operator">!</span>, object: contact.bodyA.node<span class="operator">!</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">collisionBetween</span>(<span class="params">ball</span>: <span class="type">SKNode</span>, <span class="params">object</span>: <span class="type">SKNode</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> object.name <span class="operator">==</span> <span class="string">&quot;good&quot;</span> &#123;</span><br><span class="line">        destroy(ball: ball)</span><br><span class="line">        score <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> object.name <span class="operator">==</span> <span class="string">&quot;bad&quot;</span> &#123;</span><br><span class="line">        destroy(ball: ball)</span><br><span class="line">        score <span class="operator">-=</span> <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">destroy</span>(<span class="params">ball</span>: <span class="type">SKNode</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;here&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> fireParticles <span class="operator">=</span> <span class="type">SKEmitterNode</span>(fileNamed: <span class="string">&quot;FireParticles&quot;</span>) &#123;</span><br><span class="line">        fireParticles.position <span class="operator">=</span> ball.position</span><br><span class="line">        addChild(fireParticles)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> a <span class="operator">=</span> <span class="type">SKEmitterNode</span>(fileNamed: <span class="string">&quot;FireParticles&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// SKSpriteNode节点的移除一定要从Parent处移除</span></span><br><span class="line">    ball.removeFromParent()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="SKLabelNode"><a href="#SKLabelNode" class="headerlink" title="SKLabelNode"></a>SKLabelNode</h2><p>The SKLabelNode class is somewhat similar to UILabel in that it has a text property, a font, a position, an alignment, and so on.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个SKLabelNode,字体使用&quot;粉笔灰&quot;</span></span><br><span class="line">scoreLabel <span class="operator">=</span> <span class="type">SKLabelNode</span>(fontNamed: <span class="string">&quot;Chalkduster&quot;</span>)</span><br><span class="line"><span class="comment">// SKLabelNode的内容</span></span><br><span class="line">scoreLabel.text <span class="operator">=</span> <span class="string">&quot;Score: 0&quot;</span></span><br><span class="line">scoreLabel.horizontalAlignmentMode <span class="operator">=</span> .right</span><br><span class="line">scoreLabel.position <span class="operator">=</span> <span class="type">CGPoint</span>(x: <span class="number">980</span>, y: <span class="number">700</span>)</span><br><span class="line">addChild(scoreLabel)</span><br></pre></td></tr></table></figure>

<h2 id="open-func-nodes-at-p-CGPoint-gt-SKNode"><a href="#open-func-nodes-at-p-CGPoint-gt-SKNode" class="headerlink" title="open func nodes(at p: CGPoint) -&gt; [SKNode]"></a>open func nodes(at p: CGPoint) -&gt; [SKNode]</h2><p>这方法是SKNode协议下的一个内置方法,作用是反馈在这个location的所有SKNode节点</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">touchesBegan</span>(<span class="keyword">_</span> <span class="params">touches</span>: <span class="type">Set</span>&lt;<span class="type">UITouch</span>&gt;, <span class="params">with</span> <span class="params">event</span>: <span class="type">UIEvent</span>?) &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> touch <span class="operator">=</span> touches.first &#123;</span><br><span class="line">        <span class="keyword">let</span> location <span class="operator">=</span> touch.location(in: <span class="keyword">self</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> objects <span class="operator">=</span> nodes(at: location)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> objects.contains(editLabel) &#123;</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">touchesMoved</span>(<span class="keyword">_</span> <span class="params">touches</span>: <span class="type">Set</span>&lt;<span class="type">UITouch</span>&gt;, <span class="params">with</span> <span class="params">event</span>: <span class="type">UIEvent</span>?) &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> touch <span class="operator">=</span> touches.first <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">    <span class="keyword">var</span> location <span class="operator">=</span> touch.location(in: <span class="keyword">self</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> node <span class="keyword">in</span> nodes(at: location) &#123;</span><br><span class="line">        <span class="keyword">if</span> node.name <span class="operator">==</span> <span class="string">&quot;player&quot;</span> &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="SKEmitterNode"><a href="#SKEmitterNode" class="headerlink" title="SKEmitterNode"></a>SKEmitterNode</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/read/11/7/special-effects-skemitternode">https://www.hackingwithswift.com/read/11/7/special-effects-skemitternode</a></p>
</blockquote>
<p>SpriteKit has a built-in particle editor to help you create effects like fire, snow, rain and smoke almost entirely through a graphical editor. </p>
<p>The SKEmitterNode class is new and powerful: it’s designed to create high-performance particle effects in SpriteKit games, and all you need to do is provide it with the filename of the particles you designed and it will do the rest.</p>
<h3 id="SKEmitterNode-fileNamed-的用例"><a href="#SKEmitterNode-fileNamed-的用例" class="headerlink" title="SKEmitterNode(fileNamed:)的用例"></a>SKEmitterNode(fileNamed:)的用例</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">destroy</span>(<span class="params">ball</span>: <span class="type">SKNode</span>) &#123;</span><br><span class="line">    <span class="comment">// 加载FireParticles.sks文件</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> fireParticles <span class="operator">=</span> <span class="type">SKEmitterNode</span>(fileNamed: <span class="string">&quot;FireParticles&quot;</span>) &#123;</span><br><span class="line">        fireParticles.position <span class="operator">=</span> ball.position</span><br><span class="line">        addChild(fireParticles)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ball.removeFromParent()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>就会有在ball被清除前,先出现一个爆炸的动画。<br>在xCode中你可以点击该FireParticles.sks文件,就可以看见右侧面板上有标题叫”SpriteKit Particle Emitter”,可以在里面更改动画效果等。</p>
<h3 id="SKEmitterNode的advanceSimulationTime-sec-TimeInterval"><a href="#SKEmitterNode的advanceSimulationTime-sec-TimeInterval" class="headerlink" title="SKEmitterNode的advanceSimulationTime(sec: TimeInterval)"></a>SKEmitterNode的advanceSimulationTime(sec: TimeInterval)</h3><p>让SKEmitterNode提前多少秒渲染。</p>
<p>用例:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">starField <span class="operator">=</span> <span class="type">SKEmitterNode</span>(fileNamed: <span class="string">&quot;starfield&quot;</span>)<span class="operator">!</span></span><br><span class="line">starField.position <span class="operator">=</span> <span class="type">CGPoint</span>(x: <span class="number">1024</span>, y: <span class="number">384</span>)</span><br></pre></td></tr></table></figure>
<p>效果是这样的:<br><img src="/Images/WithoutAdvanceSimulationTime.gif" alt="WithoutAdvanceSimulationTime"><br>你会发现星空是从右边屏幕开始慢慢渲染的,但我们需要星空一开始就充满屏幕,这时候就需要用到SKEmitterNode的advanceSimulationTime(sec: TimeInterval)。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 提前渲染10秒的星空</span></span><br><span class="line">starField.advanceSimulationTime(<span class="number">10</span>)</span><br></pre></td></tr></table></figure>
<p>效果是这样的:<br><img src="/Images/WithAdvanceSimulationTime.gif" alt="WithoutAdvanceSimulationTime"></p>
<h3 id="sks文件的制作"><a href="#sks文件的制作" class="headerlink" title=".sks文件的制作"></a>.sks文件的制作</h3><p>还没涉及到.sks文件的制作,上例中,文件制作完预览是这样的:<br><img src="/Images/FireParticles.gif" alt="FireParticles"></p>
<p>文章中提了一笔如何创建该sks文件:<br>Add a new file, but this time choose “Resource” under the iOS heading, then choose “SpriteKit Particle File” to see the list of options.</p>
<p>后续需要研究下怎么制作……………………….</p>
<h2 id="SKNode"><a href="#SKNode" class="headerlink" title="SKNode"></a>SKNode</h2><p>SKNode doesn’t draw images like sprites or hold text like labels; it just sits in our scene at a position, holding other nodes as children.<br>SKSpriteNode, SKLabelNode and SKEmitterNode, and they all come from SKNode.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">WhackSlot</span>: <span class="title class_">SKNode</span> &#123;</span><br><span class="line">    <span class="comment">// 这里没有写init()方法,但可以有</span></span><br><span class="line">    <span class="comment">// configure方法是自己写的,并不是本身固有的方法</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">configure</span>(<span class="params">at</span> <span class="params">position</span>: <span class="type">CGPoint</span>) &#123;</span><br><span class="line">        <span class="comment">// 确定SKNode在什么位置</span></span><br><span class="line">        <span class="keyword">self</span>.position <span class="operator">=</span> position</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 确定这个SKNode显示什么图片</span></span><br><span class="line">        <span class="keyword">let</span> sprite <span class="operator">=</span> <span class="type">SKSpriteNode</span>(imageNamed: <span class="string">&quot;whackHole&quot;</span>)</span><br><span class="line">        addChild(sprite)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 还可以加入SKCropNode让这里有个遮罩之类</span></span><br><span class="line">        <span class="comment">// 再给SKCropNode加入一个SKSpriteNode(imageNamed:)之类的</span></span><br><span class="line">        <span class="comment">// 再实现其的动画效果</span></span><br><span class="line">        <span class="comment">// 具体实现见https://www.hackingwithswift.com/read/14/2/getting-up-and-running-skcropnode</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="SKNode-removeAllChildren"><a href="#SKNode-removeAllChildren" class="headerlink" title="SKNode.removeAllChildren()"></a>SKNode.removeAllChildren()</h3><p>移除SKNode中的所有子节点。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// var pipes: SKNode!</span></span><br><span class="line"></span><br><span class="line">pipes.removeAllChildren()</span><br></pre></td></tr></table></figure>

<h3 id="SKNode-children-–-获取所有节点"><a href="#SKNode-children-–-获取所有节点" class="headerlink" title="SKNode.children – 获取所有节点"></a>SKNode.children – 获取所有节点</h3><p>children可以获取到所有的节点,它的定义是: [SKNode]。<br>下面是获取到所有节点,并始终刷新,判断节点的x坐标在屏幕左侧-300的位置时,即将其删除的例子:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">update</span>(<span class="keyword">_</span> <span class="params">currentTime</span>: <span class="type">TimeInterval</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> node <span class="keyword">in</span> children &#123;</span><br><span class="line">        <span class="keyword">if</span> node.position.x <span class="operator">&lt;</span> <span class="operator">-</span><span class="number">300</span> &#123;</span><br><span class="line">            node.removeFromParent()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="isUserInteractionEnabled-属性-–-是否让用户点击交互"><a href="#isUserInteractionEnabled-属性-–-是否让用户点击交互" class="headerlink" title="isUserInteractionEnabled 属性 – 是否让用户点击交互"></a>isUserInteractionEnabled 属性 – 是否让用户点击交互</h3><p>一个SKNode,如果只是做背景之类不需要用户点击进行交互的话,就可以:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// skNode: SKNode</span></span><br><span class="line"></span><br><span class="line">skNode.isUserInteractionEnabled <span class="operator">=</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h2 id="SKCropNode"><a href="#SKCropNode" class="headerlink" title="SKCropNode"></a>SKCropNode</h2><p>SKCropNode is a special kind of SKNode subclass that uses an image as a cropping mask: anything in the colored part will be visible, anything in the transparent part will be invisible.<br>SKCropNode是SKNode的子类。<br>SKCropNode.maskNode得是个SKSpriteNode。<br>SKCropNode.maskNode的作用就是:<br>在SKCropNode.maskNode范围内,这是前提,<br>SKCropNode这个node中的texture(素材),必须是要出现在maskNode范围内的才会显示。</p>
<p>示例:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">WhackSlot</span>: <span class="title class_">SKNode</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">configure</span>(<span class="params">at</span> <span class="params">position</span>: <span class="type">CGPoint</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.position <span class="operator">=</span> position</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> sprite <span class="operator">=</span> <span class="type">SKSpriteNode</span>(imageNamed: <span class="string">&quot;whackHole&quot;</span>)</span><br><span class="line">        addChild(sprite)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> cropNode <span class="operator">=</span> <span class="type">SKCropNode</span>()</span><br><span class="line">        cropNode.position <span class="operator">=</span> <span class="type">CGPoint</span>(x: <span class="number">0</span>, y: <span class="number">15</span>)</span><br><span class="line">        <span class="comment">// 把cropNode放在其他node之上</span></span><br><span class="line">        cropNode.zPosition <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">        <span class="comment">// 若设置成cropNode.maskNode = nil 则charNode就会显示出来</span></span><br><span class="line">        cropNode.maskNode <span class="operator">=</span> <span class="type">SKSpriteNode</span>(imageNamed: <span class="string">&quot;whackMask&quot;</span>)</span><br><span class="line"></span><br><span class="line">        charNode <span class="operator">=</span> <span class="type">SKSpriteNode</span>(imageNamed: <span class="string">&quot;penguinGood&quot;</span>)</span><br><span class="line">        charNode.position <span class="operator">=</span> <span class="type">CGPoint</span>(x: <span class="number">0</span>, y: <span class="operator">-</span><span class="number">90</span>)</span><br><span class="line">        charNode.name <span class="operator">=</span> <span class="string">&quot;character&quot;</span></span><br><span class="line">        cropNode.addChild(charNode)</span><br><span class="line">        </span><br><span class="line">        addChild(cropNode)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>解释下代码:<br>cropNode的位置在(0,15), cropNode.maskNode 是一张图片,可以理解成是cropNode的背景图,但实施其是一个人mask,在mask内的显示,不在的不显示。<br>charNode的位置在(0,-90),它在 cropNode.maskNode 的下面,所以不显示这个charNode。<br>后续会有代码让charNode往上升,就能看到了,不过这是后话。</p>
<p>I hope you noticed the important thing, which is that the character node is added to the crop node, and the crop node was added to the slot. This is because the crop node only crops nodes that are inside it, so we need to have a clear hierarchy: the slot has the hole and crop node as children, and the crop node has the character node as a child.</p>
<h2 id="AnchorPoint"><a href="#AnchorPoint" class="headerlink" title="AnchorPoint"></a>AnchorPoint</h2><p>在SpriteKit的游戏开发中经常会使用到AnchorPoint锚点这一属性,这需要配合position属性一起使用。<br>在SpriteKit中(0,0)这个点是在左下角,但UIKit中是左上角。<br>锚点的类型是CGPoint类型数据,取值范围是(0,0)~(1,1)之间,如下图:<br><img src="/Images/anchorPoint.webp" alt="AnchorPoint">。</p>
<p>我们以(0,0)为左上角来讲解:<br>View的position为(50,50):<br>1、 若AnchorPoint为(0.5,0.5), 就说明锚点取的是View的中心点, 则View的中心点位置是(50,50), 如下图:<br><img src="/Images/AnchorPoint_1.png" alt="AnchorPoint"><br>2、若AnchorPoint为(0,0),就说明锚点取的是View的左上角,则View的左上角位置是(50,50),如下图:<br><img src="/Images/AnchorPoint_2.png" alt="AnchorPoint"><br>3、若AnchorPoint为(1,1),就说明锚点取的是View的右下角,则View的右下角位置是(50,50),如下图:<br><img src="/Images/AnchorPoint_3.png" alt="AnchorPoint"></p>
<h2 id="UIViewController-与-GameScene-的关系"><a href="#UIViewController-与-GameScene-的关系" class="headerlink" title="UIViewController 与 GameScene 的关系"></a>UIViewController 与 GameScene 的关系</h2><p>默认建立game后,会有GameScene.swift和GameViewController.swift这两个文件,要解释一下的是,GameViewController.swift中的UIViewController,掌管着GameScene.swift中的GameScene。</p>
<h3 id="UIViewController的默认方法"><a href="#UIViewController的默认方法" class="headerlink" title="UIViewController的默认方法"></a>UIViewController的默认方法</h3><h4 id="override-func-motionBegan-motion-UIEvent-EventSubtype-with-event-UIEvent-检测设备的-晃动-x2F-shake-x2F-摇晃-效果"><a href="#override-func-motionBegan-motion-UIEvent-EventSubtype-with-event-UIEvent-检测设备的-晃动-x2F-shake-x2F-摇晃-效果" class="headerlink" title="override func motionBegan(_ motion: UIEvent.EventSubtype, with event: UIEvent?) { } 检测设备的 晃动&#x2F;shake&#x2F;摇晃 效果"></a>override func motionBegan(_ motion: UIEvent.EventSubtype, with event: UIEvent?) { } 检测设备的 晃动&#x2F;shake&#x2F;摇晃 效果</h4><p>motionBegan()只能在view controller中设置,而不能在game scenes中设置。<br>下面是在GameViewController.swift的UIViewController中建立一个方法,来调用GameScene.swift中的explodeFireworks方法:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">GameViewController</span>: <span class="title class_">UIViewController</span> &#123;</span><br><span class="line">    <span class="comment">// 省略必须的代码</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">motionBegan</span>(<span class="keyword">_</span> <span class="params">motion</span>: <span class="type">UIEvent</span>.<span class="type">EventSubtype</span>, <span class="params">with</span> <span class="params">event</span>: <span class="type">UIEvent</span>?) &#123;</span><br><span class="line">        <span class="comment">// 感觉这行代码是检测主体的view是否是一个SKView</span></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> skView <span class="operator">=</span> view <span class="keyword">as?</span> <span class="type">SKView</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">        <span class="comment">// 感觉这行代码是检测SKView的scene是否是GameScene</span></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> gameScene <span class="operator">=</span> skView.scene <span class="keyword">as?</span> <span class="type">GameScene</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">        <span class="comment">// 如果上面检测都成立,就运行GameScene.swift文件中的GameScene类中的explodeFireworks方法。</span></span><br><span class="line">        gameScene.explodeFireworks()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注:在模拟器中使用”ctrl”+”cmd”+”z”来模拟设备的晃动效果。</p>
<h1 id="NSCoding"><a href="#NSCoding" class="headerlink" title="NSCoding"></a>NSCoding</h1><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/read/12/3/fixing-project-10-nscoding">https://www.hackingwithswift.com/read/12/3/fixing-project-10-nscoding</a></p>
</blockquote>
<p>一般都推荐使用Codable了,所以这里就不写关于NSCoding的笔记了。</p>
<h1 id="UISlider"><a href="#UISlider" class="headerlink" title="UISlider"></a>UISlider</h1><h2 id="如何取得滑动值"><a href="#如何取得滑动值" class="headerlink" title="如何取得滑动值"></a>如何取得滑动值</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在storyboard上建立一个slider</span></span><br><span class="line"><span class="keyword">@IBOutlet</span> <span class="keyword">var</span> intensity: <span class="type">UISlider</span>!</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如何取得UISlider的滑动数值</span></span><br><span class="line"><span class="comment">// 使用intensity.value即可</span></span><br><span class="line">intensity.value</span><br></pre></td></tr></table></figure>

<h2 id="如何跟踪滑动值的改变"><a href="#如何跟踪滑动值的改变" class="headerlink" title="如何跟踪滑动值的改变"></a>如何跟踪滑动值的改变</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在storyboard上建立对应该Slider的action事件</span></span><br><span class="line"><span class="comment">// 每次滑动Slider都会触发该方法</span></span><br><span class="line"><span class="keyword">@IBAction</span> <span class="keyword">func</span> <span class="title function_">intensityChanged</span>(<span class="keyword">_</span> <span class="params">sender</span>: <span class="keyword">Any</span>) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="CoreImage"><a href="#CoreImage" class="headerlink" title="CoreImage"></a>CoreImage</h1><p>Core Image is Apple’s high-speed image manipulation tookit. It does only one thing, which is to apply filters to images that manipulate them in various ways.</p>
<h2 id="需要import"><a href="#需要import" class="headerlink" title="需要import"></a>需要import</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> CoreImage</span><br></pre></td></tr></table></figure>
<h2 id="CIContext"><a href="#CIContext" class="headerlink" title="CIContext"></a>CIContext</h2><p>The first is a Core Image context, which is the Core Image component that handles rendering. We create it here and use it throughout our app, because creating a context is computationally expensive so we don’t want to keep doing it and it’s best to re-use them where possible.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> context: <span class="type">CIContext</span>!</span><br><span class="line"></span><br><span class="line"><span class="comment">// viewDidLoad()</span></span><br><span class="line">context <span class="operator">=</span> <span class="type">CIContext</span>()</span><br></pre></td></tr></table></figure>
<p>具体的例子见下面的CIFilter的讲解。</p>
<h2 id="CIFilter"><a href="#CIFilter" class="headerlink" title="CIFilter"></a>CIFilter</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/read/13/4/applying-filters-cicontext-cifilter">https://www.hackingwithswift.com/read/13/4/applying-filters-cicontext-cifilter</a><br>(以上有多种filter的选择,对应值的转换,以及项目实际模拟出来的各种效果,如果需要的时候可以看一下)<br>(也可以在用户导入照片的时候,提供必要的filter让其修改下照片效果等)</p>
</blockquote>
<p>The second is a Core Image filter, and will store whatever filter the user has activated. This filter will be given various input settings before we ask it to output a result for us to show in the image view.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> currentFilter: <span class="type">CIFilter</span>!</span><br><span class="line"></span><br><span class="line"><span class="comment">// viewDidLoad()</span></span><br><span class="line">context <span class="operator">=</span> <span class="type">CIContext</span>()</span><br><span class="line"><span class="comment">// creates an example filter that will apply a sepia tone effect to images.</span></span><br><span class="line">currentFilter <span class="operator">=</span> <span class="type">CIFilter</span>(name: <span class="string">&quot;CISepiaTone&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// The CIImage data type is UIImage.</span></span><br><span class="line"><span class="keyword">let</span> beginImage <span class="operator">=</span> <span class="type">CIImage</span>(image: currentImage)</span><br><span class="line"><span class="comment">// we send the result into the current Core Image Filter using the kCIInputImageKey. There are lots of Core Image key constants like this; at least this one is somewhat self-explanatory!</span></span><br><span class="line">currentFilter.setValue(beginImage, forKey: kCIInputImageKey)</span><br><span class="line"></span><br><span class="line"><span class="comment">// The first line safely reads the output image from our current filter. </span></span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> image <span class="operator">=</span> currentFilter.outputImage <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line"><span class="comment">// The second line uses the value of our intensity slider to set the kCIInputIntensityKey value of our current Core Image filter. For sepia toning a value of 0 means &quot;no effect&quot; and 1 means &quot;fully sepia.&quot;</span></span><br><span class="line"><span class="comment">// var intensity: UISlider!</span></span><br><span class="line">currentFilter.setValue(intensity.value, forKey: kCIInputIntensityKey)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 下面的 if 语句中的代码,我们也可以总结出:</span></span><br><span class="line"><span class="comment">// 要想从CIImage -&gt; UIImage, 必须是:</span></span><br><span class="line"><span class="comment">// CIImage -&gt; CGImage -&gt; UIImage.</span></span><br><span class="line"><span class="comment">// -----------------------------------</span></span><br><span class="line"><span class="comment">// it creates a new data type called CGImage from the output image of the current filter.</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> cgimg <span class="operator">=</span> context.createCGImage(image, from: image.extent) &#123;</span><br><span class="line">    <span class="comment">// 转换成UIImageView需要的UIImage</span></span><br><span class="line">    <span class="keyword">let</span> processedImage <span class="operator">=</span> <span class="type">UIImage</span>(cgImage: cgimg)</span><br><span class="line">    <span class="comment">// 放入UIImageView</span></span><br><span class="line">    imageView.image <span class="operator">=</span> processedImage</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="UIImageWriteToSavedPhotosAlbum"><a href="#UIImageWriteToSavedPhotosAlbum" class="headerlink" title="UIImageWriteToSavedPhotosAlbum()"></a>UIImageWriteToSavedPhotosAlbum()</h1><p>向用户的相册写入图片。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 假设有一个UIButton的action是下面的func</span></span><br><span class="line"><span class="keyword">@IBAction</span> <span class="keyword">func</span> <span class="title function_">save</span>(<span class="keyword">_</span> <span class="params">sender</span>: <span class="keyword">Any</span>) &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> image <span class="operator">=</span> imageView.image <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">UIImageWriteToSavedPhotosAlbum</span>(image, <span class="keyword">self</span>, <span class="keyword">#selector</span>(image(<span class="keyword">_</span>:didFinishSavingWithError:contextInfo:)), <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@objc</span> <span class="keyword">func</span> <span class="title function_">image</span>(<span class="keyword">_</span> <span class="params">image</span>: <span class="type">UIImage</span>, <span class="params">didFinishSavingWithError</span> <span class="params">error</span>: <span class="type">Error</span>?, <span class="params">contextInfo</span>: <span class="type">UnsafeRawPointer</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> error <span class="operator">=</span> error &#123;</span><br><span class="line">        <span class="comment">// we got back an error!</span></span><br><span class="line">        <span class="keyword">let</span> ac <span class="operator">=</span> <span class="type">UIAlertController</span>(title: <span class="string">&quot;Save error&quot;</span>, message: error.localizedDescription, preferredStyle: .alert)</span><br><span class="line">        ac.addAction(<span class="type">UIAlertAction</span>(title: <span class="string">&quot;OK&quot;</span>, style: .default))</span><br><span class="line">        present(ac, animated: <span class="literal">true</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> ac <span class="operator">=</span> <span class="type">UIAlertController</span>(title: <span class="string">&quot;Saved!&quot;</span>, message: <span class="string">&quot;Your altered image has been saved to your photos.&quot;</span>, preferredStyle: .alert)</span><br><span class="line">        ac.addAction(<span class="type">UIAlertAction</span>(title: <span class="string">&quot;OK&quot;</span>, style: .default))</span><br><span class="line">        present(ac, animated: <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="UIView-animate"><a href="#UIView-animate" class="headerlink" title="UIView.animate"></a>UIView.animate</h1><p>一般用法:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UIView</span>.animate(withDuration: <span class="operator">&lt;</span>#<span class="type">T</span>##<span class="type">TimeInterval</span>#<span class="operator">&gt;</span>, delay: <span class="operator">&lt;</span>#<span class="type">T</span>##<span class="type">TimeInterval</span>#<span class="operator">&gt;</span>, animations: <span class="operator">&lt;</span>#<span class="type">T</span>##() -&gt; <span class="type">Void</span>#<span class="operator">&gt;</span>)</span><br></pre></td></tr></table></figure>
<p>更丝滑的用法:(使用到了usingSpringWithDamping &#x2F; initialSpringVelocity,是为了增加润滑度的)</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UIView</span>.animate(withDuration: <span class="operator">&lt;</span>#<span class="type">T</span>##<span class="type">TimeInterval</span>#<span class="operator">&gt;</span>, delay: <span class="operator">&lt;</span>#<span class="type">T</span>##<span class="type">TimeInterval</span>#<span class="operator">&gt;</span>, usingSpringWithDamping: <span class="operator">&lt;</span>#<span class="type">T</span>##<span class="type">CGFloat</span>#<span class="operator">&gt;</span>, initialSpringVelocity: <span class="operator">&lt;</span>#<span class="type">T</span>##<span class="type">CGFloat</span>#<span class="operator">&gt;</span>, animations: <span class="operator">&lt;</span>#<span class="type">T</span>##() -&gt; <span class="type">Void</span>#<span class="operator">&gt;</span>)</span><br></pre></td></tr></table></figure>

<p>案例:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UIView</span>.animate(withDuration: <span class="number">1</span>, delay: <span class="number">0</span>, usingSpringWithDamping: <span class="number">0.5</span>, initialSpringVelocity: <span class="number">5</span>, options: [], animations: &#123;</span><br><span class="line">    <span class="keyword">self</span>.imageView.alpha <span class="operator">=</span> <span class="number">0.1</span></span><br><span class="line">    <span class="keyword">self</span>.imageView.backgroundColor <span class="operator">=</span> <span class="type">UIColor</span>.green</span><br><span class="line">    <span class="comment">// 后续可以设置案件让其还原</span></span><br><span class="line">    <span class="comment">// 比如</span></span><br><span class="line">    <span class="comment">// self.imageView.alpha = 1.0</span></span><br><span class="line">    <span class="comment">// self.imageView.backgroundColor = UIColor.clear</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这里补充一点 UIColor.clear 的定义</span></span><br><span class="line">    <span class="comment">// open class var clear: UIColor &#123; get &#125; // 0.0 white, 0.0 alpha</span></span><br><span class="line">    <span class="comment">// 所以上面代码会让背景色变白并且透明度为0即不可见</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="UIView-animate-的-completed-的trailing-closure参数"><a href="#UIView-animate-的-completed-的trailing-closure参数" class="headerlink" title="UIView.animate 的 completed 的trailing closure参数"></a>UIView.animate 的 completed 的trailing closure参数</h2><p>下面的代码可以在animate的动画结束之后再执行一段代码。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UIView</span>.animate(withDuration: <span class="number">1</span>, delay: <span class="number">0</span>, options: [], animations: &#123;</span><br><span class="line">    <span class="keyword">switch</span> <span class="keyword">self</span>.currentAnimation &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    default:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;) &#123; finished <span class="keyword">in</span></span><br><span class="line">    sender.isHidden <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="UIView-animate-的思考"><a href="#UIView-animate-的思考" class="headerlink" title="UIView.animate 的思考"></a>UIView.animate 的思考</h2><p>上面代码中,在UIView.animate中变化的是self.imageView.alpha。<br>同样的情景,但换做是一个UIButton,”_ sender: UIButton”是其传来的参数,你使用sender.isHidden &#x3D; true, 是不会有过渡变化的,而你使用sender.alpha &#x3D; 0,就会带来过渡的变化。后者很好理解,因为alpha的取值是从0-1.0之前,但为什么sender.isHidden从false到true,也是让图像从有到无,为何就没有用呢? (还记得在SwfitUI中,withAnimation中好像是可以放入true或false的改变的,也会有动画效果的)<br>教程中是这么讲的,”because isHidden is either true or false, it has no animatable values between.”<br>上面代码还用到了backgroundColor,是不是颜色从一种到另一种,其中是带有值的过渡的,所以也是可行的。</p>
<h2 id="使用需要是weak等去除强引用？没必要！"><a href="#使用需要是weak等去除强引用？没必要！" class="headerlink" title="使用需要是weak等去除强引用？没必要！"></a>使用需要是weak等去除强引用？没必要！</h2><p>For the animations closure we don’t need to use [weak self] because there’s no risk of strong reference cycles here – the closures passed to animate(withDuration:) method will be used once then thrown away.</p>
<h1 id="CGAffineTransform"><a href="#CGAffineTransform" class="headerlink" title="CGAffineTransform"></a>CGAffineTransform</h1><p>任何的UIView都可以使用CGAffineTransform。</p>
<p>一般用法案例:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UIView</span>.animate(withDuration: <span class="number">1</span>, delay: <span class="number">0</span>, usingSpringWithDamping: <span class="number">0.5</span>, initialSpringVelocity: <span class="number">5</span>, options: [], animations: &#123;</span><br><span class="line">    <span class="keyword">switch</span> <span class="keyword">self</span>.currentAnimation &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">self</span>.imageView.transform <span class="operator">=</span> <span class="type">CGAffineTransform</span>(scaleX: <span class="number">2</span>, y: <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">self</span>.imageView.transform <span class="operator">=</span> .identity</span><br><span class="line"></span><br><span class="line">    default:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里有两个知识点:</p>
<ol>
<li>UIView.transform 可更改外形、大小、角度等;</li>
<li>UIView.transform &#x3D; .identity 即可恢复原状。</li>
</ol>
<p>CGAffineTransform还有的用法:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 位移</span></span><br><span class="line"><span class="keyword">self</span>.imageView.transform <span class="operator">=</span> <span class="type">CGAffineTransform</span>(translationX: <span class="operator">-</span><span class="number">256</span>, y: <span class="operator">-</span><span class="number">256</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 旋转</span></span><br><span class="line"><span class="keyword">self</span>.imageView.transform <span class="operator">=</span> <span class="type">CGAffineTransform</span>(rotationAngle: <span class="type">CGFloat</span>.pi <span class="operator">*</span> <span class="number">3.0</span> <span class="operator">/</span> <span class="number">2.0</span>)</span><br><span class="line"><span class="comment">// 但要记住,它比较懒,怎么能最快到终点,就会选这个捷径,实际这个只逆时针转了90度</span></span><br></pre></td></tr></table></figure>

<h2 id="CGAffineTransform-identity"><a href="#CGAffineTransform-identity" class="headerlink" title="CGAffineTransform.identity"></a>CGAffineTransform.identity</h2><p>CGAffineTransform也有identity,作用是恢复到transform之前的状态。</p>
<h1 id="MapKit"><a href="#MapKit" class="headerlink" title="MapKit"></a>MapKit</h1><h2 id="MKMapView及其的delegate"><a href="#MKMapView及其的delegate" class="headerlink" title="MKMapView及其的delegate"></a>MKMapView及其的delegate</h2><p>在一个UIView中建立了一个MKMapView后,需要让UIView作为这个MKMapView的delegate的话,需要在storyboard中ctrl-drag这个MKMapView到UIView上面,就会出现让你选择delegate的情况,选择好了以后就可以了。</p>
<p>原文是这样写的:<br>Using the assistant editor, please create an outlet for your map view called mapView. You should also set your view controller to be the delegate of the map view by Ctrl-dragging from the map view to the orange and white view controller button just above the layout area. You will also need to add import MapKit to ViewController.swift so it understands what MKMapView is.<br>Note: If you don’t set the map’s delegate, the rest of this project won’t work too well.</p>
<h3 id="MKMapView的用例"><a href="#MKMapView的用例" class="headerlink" title="MKMapView的用例:"></a>MKMapView的用例:</h3><p>在storyboard上生成一个map kit view。 </p>
<h3 id="mapType-更改显示地图的样式"><a href="#mapType-更改显示地图的样式" class="headerlink" title="mapType 更改显示地图的样式"></a>mapType 更改显示地图的样式</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @IBOutlet var mapView: MKMapView!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示卫星地图,还有其他的一些选择</span></span><br><span class="line">mapView.mapType <span class="operator">=</span> .satellite</span><br></pre></td></tr></table></figure>

<h2 id="MKAnnotation-–-protocol"><a href="#MKAnnotation-–-protocol" class="headerlink" title="MKAnnotation – protocol"></a>MKAnnotation – protocol</h2><p>在地图上显示图钉。<br>遵循MKAnnotation协议的必须是class,不能是struct！！！<br>遵循MKAnnotation协议的情况下,必须要有一个coordinate: CLLocationCoordinate2D的声明,如下:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Capital</span>: <span class="title class_">NSObject</span>, <span class="title class_">MKAnnotation</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> title: <span class="type">String</span>?</span><br><span class="line">    <span class="comment">// 需要实现一个CLLocationCoordinate2D</span></span><br><span class="line">    <span class="keyword">var</span> coordinate: <span class="type">CLLocationCoordinate2D</span></span><br><span class="line">    <span class="keyword">var</span> info: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">title</span>: <span class="type">String</span>, <span class="params">coordinate</span>: <span class="type">CLLocationCoordinate2D</span>, <span class="params">info</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.title <span class="operator">=</span> title</span><br><span class="line">        <span class="keyword">self</span>.coordinate <span class="operator">=</span> coordinate</span><br><span class="line">        <span class="keyword">self</span>.info <span class="operator">=</span> info</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在viewDidLoad()中可以生成这个annotation:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> london <span class="operator">=</span> <span class="type">Capital</span>(title: <span class="string">&quot;London&quot;</span>, coordinate: <span class="type">CLLocationCoordinate2D</span>(latitude: <span class="number">51.507222</span>, longitude: <span class="operator">-</span><span class="number">0.1275</span>), info: <span class="string">&quot;Home to the 2012 Summer Olympics.&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> oslo <span class="operator">=</span> <span class="type">Capital</span>(title: <span class="string">&quot;Oslo&quot;</span>, coordinate: <span class="type">CLLocationCoordinate2D</span>(latitude: <span class="number">59.95</span>, longitude: <span class="number">10.75</span>), info: <span class="string">&quot;Founded over a thousand years ago.&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>随后在地图上显示这些annotation:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @IBOutlet var mapView: MKMapView!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 一起添加:</span></span><br><span class="line"><span class="comment">// mapView.addAnnotations(&lt;#T##annotations: [MKAnnotation]##[MKAnnotation]#&gt;)</span></span><br><span class="line">mapView.addAnnotations([london, oslo])</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者一个一个添加:</span></span><br><span class="line"><span class="comment">// mapView.addAnnotation(&lt;#T##annotation: MKAnnotation##MKAnnotation#&gt;)</span></span><br><span class="line">mapView.addAnnotation(london)</span><br><span class="line">mapView.addAnnotation(oslo)</span><br></pre></td></tr></table></figure>

<h3 id="func-mapView-mapView-MKMapView-viewFor-annotation-MKAnnotation-gt-MKAnnotationView"><a href="#func-mapView-mapView-MKMapView-viewFor-annotation-MKAnnotation-gt-MKAnnotationView" class="headerlink" title="func mapView(_ mapView: MKMapView, viewFor annotation: MKAnnotation) -&gt; MKAnnotationView? {"></a>func mapView(_ mapView: MKMapView, viewFor annotation: MKAnnotation) -&gt; MKAnnotationView? {</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/read/16/3/annotations-and-accessory-views-mkpinannotationview">https://www.hackingwithswift.com/read/16/3/annotations-and-accessory-views-mkpinannotationview</a></p>
</blockquote>
<p>Every time the map needs to show an annotation, it calls a <strong>viewFor method</strong> on its delegate. We don’t implement that method right now, so the default red pin is used with nothing special.</p>
<p>但首先要让View遵循 <strong>MKPinAnnotationView protocol</strong> :</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ViewController</span>: <span class="title class_">UIViewController</span>, <span class="title class_">MKMapViewDelegate</span> &#123;</span><br></pre></td></tr></table></figure>

<p>接下来就是完成func mapView(_ mapView: MKMapView, viewFor annotation: MKAnnotation) -&gt; MKAnnotationView? {</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">mapView</span>(<span class="keyword">_</span> <span class="params">mapView</span>: <span class="type">MKMapView</span>, <span class="params">viewFor</span> <span class="params">annotation</span>: <span class="type">MKAnnotation</span>) -&gt; <span class="type">MKAnnotationView</span>? &#123;</span><br><span class="line">    <span class="comment">// 1.If the annotation isn&#x27;t from a capital city, it must return nil so iOS uses a default view.</span></span><br><span class="line">    <span class="keyword">guard</span> annotation <span class="keyword">is</span> <span class="type">Capital</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2.Define a reuse identifier. This is a string that will be used to ensure we reuse annotation views as much as possible.</span></span><br><span class="line">    <span class="keyword">let</span> identifier <span class="operator">=</span> <span class="string">&quot;Capital&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3.Try to dequeue an annotation view from the map view&#x27;s pool of unused views.</span></span><br><span class="line">    <span class="keyword">var</span> annotationView <span class="operator">=</span> mapView.dequeueReusableAnnotationView(withIdentifier: identifier)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> annotationView <span class="operator">==</span> <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="comment">// 4.If it isn&#x27;t able to find a reusable view, create a new one using (MKPinAnnotationView is deprecated) and sets its canShowCallout property to true. This triggers the popup with the city name.</span></span><br><span class="line">        annotationView <span class="operator">=</span> <span class="type">MKMarkerAnnotationView</span>(annotation: annotation, reuseIdentifier: identifier)</span><br><span class="line">        annotationView<span class="operator">?</span>.canShowCallout <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 5. Create a new UIButton using the built-in .detailDisclosure type. This is a small blue &quot;i&quot; symbol with a circle around it.</span></span><br><span class="line">        <span class="comment">// we don&#x27;t need to use addTarget() to add an action to the button, because you&#x27;ll automatically be told by the map view using a calloutAccessoryControlTapped method.</span></span><br><span class="line">        <span class="keyword">let</span> btn <span class="operator">=</span> <span class="type">UIButton</span>(type: .detailDisclosure)</span><br><span class="line">        annotationView<span class="operator">?</span>.rightCalloutAccessoryView <span class="operator">=</span> btn</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 6. If it can reuse a view, update that view to use a different annotation.</span></span><br><span class="line">        annotationView<span class="operator">?</span>.annotation <span class="operator">=</span> annotation</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> annotationView</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来就是每个annotation被点击后实现方法了:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// calloutAccessoryControlTapped method can make the tapped button know to call it.</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">mapView</span>(<span class="keyword">_</span> <span class="params">mapView</span>: <span class="type">MKMapView</span>, <span class="params">annotationView</span> <span class="params">view</span>: <span class="type">MKAnnotationView</span>, <span class="params">calloutAccessoryControlTapped</span> <span class="params">control</span>: <span class="type">UIControl</span>) &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> capital <span class="operator">=</span> view.annotation <span class="keyword">as?</span> <span class="type">Capital</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">    <span class="keyword">let</span> placeName <span class="operator">=</span> capital.title</span><br><span class="line">    <span class="keyword">let</span> placeInfo <span class="operator">=</span> capital.info</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> ac <span class="operator">=</span> <span class="type">UIAlertController</span>(title: placeName, message: placeInfo, preferredStyle: .alert)</span><br><span class="line">    ac.addAction(<span class="type">UIAlertAction</span>(title: <span class="string">&quot;OK&quot;</span>, style: .default))</span><br><span class="line">    present(ac, animated: <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现效果是这样的:<br><img src="/Images/annotationButtonTapped.gif" alt="annotationButtonTapped"></p>
<h1 id="Timer"><a href="#Timer" class="headerlink" title="Timer"></a>Timer</h1><h2 id="Timer-scheduledTimer-timeInterval-lt-T-TimeInterval-gt-target-lt-T-Any-gt-selector-lt-T-Selector-gt-userInfo-lt-T-Any-gt-repeats-lt-T-Bool-gt"><a href="#Timer-scheduledTimer-timeInterval-lt-T-TimeInterval-gt-target-lt-T-Any-gt-selector-lt-T-Selector-gt-userInfo-lt-T-Any-gt-repeats-lt-T-Bool-gt" class="headerlink" title="Timer.scheduledTimer(timeInterval: &lt;#T##TimeInterval#&gt;, target: &lt;#T##Any#&gt;, selector: &lt;#T##Selector#&gt;, userInfo: &lt;#T##Any?#&gt;, repeats: &lt;#T##Bool#&gt;)"></a>Timer.scheduledTimer(timeInterval: &lt;#T##TimeInterval#&gt;, target: &lt;#T##Any#&gt;, selector: &lt;#T##Selector#&gt;, userInfo: &lt;#T##Any?#&gt;, repeats: &lt;#T##Bool#&gt;)</h2><p>多少个时间单位内(timeInterval), 执行什么代码(selector), 是否重复执行(repeats)。<br>After creating a Timer, it should be created using Timer.scheduledTimer() method to activate it.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Timer</span>.scheduledTimer(timeInterval: <span class="number">0.35</span>, target: <span class="keyword">self</span>, selector: <span class="keyword">#selector</span>(createEnemy), userInfo: <span class="literal">nil</span>, repeats: <span class="literal">true</span>)</span><br></pre></td></tr></table></figure>

<h2 id="invalidate-–-Timer-scheduledTimer的停止"><a href="#invalidate-–-Timer-scheduledTimer的停止" class="headerlink" title="invalidate() – Timer.scheduledTimer的停止"></a>invalidate() – Timer.scheduledTimer的停止</h2><p>让一个计时器停止:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// var gameTimer: Timer?</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// gameTimer = Timer.scheduledTimer(timeInterval: 0.35, target: self, selector: #selector(createEnemy), userInfo: nil, repeats: true)</span></span><br><span class="line"></span><br><span class="line">gameTimer<span class="operator">?</span>.invalidate()</span><br><span class="line">gameTimer <span class="operator">=</span> <span class="literal">nil</span></span><br></pre></td></tr></table></figure>

<h1 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h1><h2 id="print"><a href="#print" class="headerlink" title="print"></a>print</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;I&#x27;m inside the viewDidLoad() method!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line"><span class="comment">// &quot;1 2 3 4 5\n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, separator: <span class="string">&quot;-&quot;</span>)</span><br><span class="line"><span class="comment">// &quot;1-2-3-4-5\n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Some message&quot;</span>, terminator: <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="comment">// &quot;Some message&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="assert"><a href="#assert" class="headerlink" title="assert"></a>assert</h2><h3 id="一般用法"><a href="#一般用法" class="headerlink" title="一般用法"></a>一般用法</h3><p>两个参数,前面的条件不满足或是false,则显示预设的错误信息,并让测试时的程序崩溃。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">assert</span>(<span class="number">1</span> <span class="operator">==</span> <span class="number">1</span>, <span class="string">&quot;Maths failure!&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="breakpoints"><a href="#breakpoints" class="headerlink" title="breakpoints"></a>breakpoints</h2><ul>
<li><strong>Fn+F6</strong> – 到breakpoint处时,一行一行地执行</li>
<li><strong>Ctrl+Cmd+Y</strong> – 执行到下一个breakpoint</li>
</ul>
<h3 id="给Breakpoint加上条件"><a href="#给Breakpoint加上条件" class="headerlink" title="给Breakpoint加上条件"></a>给Breakpoint加上条件</h3><p>例如在循环中每十次进行一次breakpoint:<br>对着设定的breakpoint右键,跳出菜单中选择”edit breakpoint”,再跳出的菜单:<br><img src="/Images/editBreakpoint.png" alt="editBreakpoint"><br>在Condition中输入”i % 10 &#x3D;&#x3D; 0”即可。</p>
<h3 id="Exception-Breakpoint"><a href="#Exception-Breakpoint" class="headerlink" title="Exception Breakpoint"></a>Exception Breakpoint</h3><p>Exception Breakpoint will be automatically triggered when an exception is thrown. Exceptions are errors that aren’t handled, and will cause your code to crash. With breakpoints, you can say “pause execution as soon as an exception is thrown,” so that you can examine your program state and see what the problem is.</p>
<p>Cmd+8 调出“Show the Breakpoint navigator”,左下角按”+”按钮,调出如下菜单,选择”Exception Breakpoint”:<br><img src="/Images/exceptionBreakpoint.png" alt="Exception Breakpoint"><br>进行必要的设置:<br><img src="/image/../Images/conceptionBreakpointDetail.png" alt="conceptionBreakpointDetail"><br>The next time your code hits a fatal problem, the exception breakpoint will trigger and you can take action.</p>
<p>下面的图就是当出现错误的情况时,会出现 NSException:<br><img src="/Images/NSException.png" alt="NSException"></p>
<h2 id="lldb窗口"><a href="#lldb窗口" class="headerlink" title="lldb窗口"></a>lldb窗口</h2><p>LLDB is the default debugger in Xcode on macOS and supports debugging C, Objective-C and C++ on the desktop and iOS devices and simulator.</p>
<p>在运行project时,可以在菜单栏 View &gt; Debug Area &gt; Activate Console, 可以看到下面的lldb窗口:<br><img src="/Images/lldb.png" alt="lldb"></p>
<p>命令行:<br>p – 同print,比如要打印变量i,”p i”即可。</p>
<h2 id="View-Debugging"><a href="#View-Debugging" class="headerlink" title="View Debugging"></a>View Debugging</h2><p>在运行项目后,在代码页面, 菜单栏的 Debug -&gt; View Debugging -&gt; Capture View Hierarchy 。<br>如下图:</p>
<p><img src="/Images/viewDebugging.gif" alt="ViewDebugging"></p>
<p>Here’s the clever part: if you click and drag inside the hierarchy display, you’ll see you’re actually viewing a 3D representation of your view, which means you can look behind the layers to see what else is there. The hierarchy automatically puts some depth between each of its views, so they appear to pop off the canvas as you rotate them.</p>
<p>This debug mode is perfect for times when you know you’ve placed your view but for some reason can’t see it – often you’ll find the view is behind something else by accident.</p>
<p>还可以使用下图中打红圈的快捷键打开 View Debugging:<br><img src="/Images/viewDebuggingButton.png" alt="ViewDebuggingButton"></p>
<h1 id="CADisplayLink"><a href="#CADisplayLink" class="headerlink" title="CADisplayLink"></a>CADisplayLink</h1><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/example-code/system/how-to-synchronize-code-to-drawing-using-cadisplaylink">https://www.hackingwithswift.com/example-code/system/how-to-synchronize-code-to-drawing-using-cadisplaylink</a><br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/5e8d783d377a">https://www.jianshu.com/p/5e8d783d377a</a></p>
</blockquote>
<p>CADisplayLink是一个能让我们以和屏幕刷新率相同的频率将内容画到屏幕上的定时器。<br>我们在应用中创建一个新的 CADisplayLink 对象，把它添加到一个runloop中，并给它提供一个 target 和 selector 在屏幕刷新的时候调用。<br>CADisplayLink比NSTimer好的地方是,后者会有延迟,而CADisplayLink的好处是,我们不需要在格外关心屏幕的刷新频率了，因为它本身就是跟屏幕刷新同步的。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> displayLink <span class="operator">=</span> <span class="type">CADisplayLink</span>(target: <span class="keyword">self</span>, selector: <span class="keyword">#selector</span>(createEnemy))</span><br><span class="line">displayLink.preferredFrameRateRange <span class="operator">=</span> <span class="type">CAFrameRateRange</span>(minimum: <span class="number">1</span>, maximum: <span class="number">2</span>)</span><br><span class="line">displayLink.add(to: .current, forMode: .common)</span><br></pre></td></tr></table></figure>

<p>代码在Project17上跑的通,但有些疑问,为什么CAFrameRateRange(minimum: 0.5, maximum: 0.5)的时候就会疯狂执行,而数值大于1以后,就会正常一些。</p>
<p>这个模块,以后要做动画游戏的时候需要好好研究一下。<br>笔记待后续补充。</p>
<h1 id="info-plist"><a href="#info-plist" class="headerlink" title="info.plist"></a>info.plist</h1><p>plist是property list的缩写,它包含了app、插件(extensions)的元数据(metadata),这些是关于:what language is it, what version number is it, and so on。</p>
<h1 id="extension"><a href="#extension" class="headerlink" title="extension"></a>extension</h1><h2 id="safari-extensions"><a href="#safari-extensions" class="headerlink" title="safari extensions"></a>safari extensions</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/100">https://www.hackingwithswift.com/100</a> Day67-69</p>
</blockquote>
<p>p.s.(2023-1-28)这章节的内容实在是太乱了,新东西太多,后续还要再理一下,如果确实要写extension的话,最好结合上述网页上的实例再看。</p>
<p>safari extensions必须要在safari的action menu中才能启动,类似于:<br><img src="/Images/safariExtension.gif" alt="safariExtension"><br>这个extension是植入到Safari中的,它需要safari才会有用,而不是像其他程序一样可以独立运行。</p>
<p>生成一个在原有项目下的extension:<br>Go to the File menu and choose New &gt; Target. When you’re asked to choose a template, select iOS &gt; Application Extension &gt; Action Extension, then click Next. For the name just call it Extension(or other name whatever you want), make sure Action Type is set to “Presents User Interface”, then click Finish.<br>这样就在一个project中建立了一个extension,而我们给其取名”Extension”,最后我们在sfari的action menu中可以看到一个Extension的可点击项,上面图像中可以看到。</p>
<p>safari中就可以运行extension,安全性在哪里？<br>实际上,你的extension与safari是不会通信的,因为系统安全原因,而在这其中,iOS起到了一个中间桥梁的作用,iOS在其中安全地传递数据。</p>
<p>extensionContext:<br>母程序(parent app)就比如说你在safari里做了一个插件,那么这个safari就是母程序,插件就是extension。<br>当我们的插件被建立后,extensionContext是用来让我们控制与母程序交互的东西。</p>
<p>inputItems:<br>extensionContext?.inputItems是一个存有数据的数组,该数据是母程序发送给插件使用的。我们一般只关心第一个item,所以会写成extensionContext?.inputItems.first。</p>
<p>NSItemProvider:<br>母程序发送给我们的数据都被包装成了一个个NSItemProvider。我们的程序把所有的数组数据中的第一个取出,而这个被取出的数据应当是一个NSItemProvider。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> inputItem <span class="operator">=</span> extensionContext<span class="operator">?</span>.inputItems.first <span class="keyword">as?</span> <span class="type">NSExtensionItem</span> &#123;</span><br></pre></td></tr></table></figure>
<p>接下来我们把inputItem中的所有attachments,只取出第一个attachment,代码就是：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> itemProvider <span class="operator">=</span> inputItem.attachments<span class="operator">?</span>.first &#123;</span><br></pre></td></tr></table></figure>
<p>合起来的代码就是:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> inputItem <span class="operator">=</span> extensionContext<span class="operator">?</span>.inputItems.first <span class="keyword">as?</span> <span class="type">NSExtensionItem</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> itemProvider <span class="operator">=</span> inputItem.attachments<span class="operator">?</span>.first &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>loadItem(forTypeIdentifier: )<br>loadItem(forTypeIdentifier: )是要求数据提供者真正地去提供这个item给我们。因为它使用到了一个trailing closure,所以执行的是异步程序，这个方法会持续执行,这是因为有时候这个item提供者可能忙于载入或者发送数据。在这个trailing closure中,我们需要使用到 [weak self]去避免强引用,此外,我们还需要接受两个参数,第一个是item提供者给我们的一个dictionary,另一个是发生的任何error。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">itemProvider.loadItem(forTypeIdentifier: kUTTypePropertyList <span class="keyword">as</span> <span class="type">String</span>) &#123;[<span class="keyword">weak</span> <span class="keyword">self</span>] (dict, error) <span class="keyword">in</span></span><br><span class="line">    <span class="comment">// do stuff!</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>先要说一下的是,在Action.js中的代码中有一段:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// run及其代码的意思是:</span></span><br><span class="line"><span class="comment">// 告知iOS这个JavaScript已经预处理完毕,把这个dictionary(里面的key分别是&quot;URL&quot;和&quot;title&quot;以及对应的值)给extension吧</span></span><br><span class="line"><span class="attr">run</span>: <span class="keyword">function</span>(<span class="params">parameters</span>) &#123;</span><br><span class="line">    parameters.<span class="title function_">completionFunction</span>(&#123; <span class="string">&quot;URL&quot;</span>: <span class="variable language_">document</span>.<span class="property">URL</span>, <span class="string">&quot;title&quot;</span>: <span class="variable language_">document</span>.<span class="property">title</span> &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>loadItem的trailing closure接收到这个dictionary并进行处理,这也是其是异步方法的愿意。<br>&#x2F;&#x2F; do stuff中的代码依次是:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> itemDictionary <span class="operator">=</span> dict <span class="keyword">as?</span> <span class="type">NSDictionary</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br></pre></td></tr></table></figure>
<p>NSDictionary是一个对我们来说是新的数据类型,但它来自旧时代的iOS代码,就把它看作是一个Swift中的dictionary吧。现在更多使用的是modern Swift dictionaries,而非NSDictionary。但这里NSDictionary是与插件配合使用的。<br>打印了一下上面的itemDictionary:<br><img src="/Images/NSDictionary.png" alt="NSDictionary"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> javaScriptValues <span class="operator">=</span> itemDictionary[<span class="type">NSExtensionJavaScriptPreprocessingResultsKey</span>] <span class="keyword">as?</span> <span class="type">NSDictionary</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br></pre></td></tr></table></figure>
<p>这行代码中的key为NSExtensionJavaScriptPreprocessingResultsKey,这是从JavaScript中传递过来的数据的key。</p>
<p>如果你打印上面javaScriptValues的值,你会看到类似:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="type">URL</span> <span class="operator">=</span> <span class="string">&quot;https://www.apple.com/retail/code/&quot;</span>;</span><br><span class="line">    title <span class="operator">=</span> <span class="string">&quot;Apple Retail Store - Hour of Code Workshop&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来就可以设置插件中的这两个后续我们要使用的属性了:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span><span class="operator">?</span>.pageTitle <span class="operator">=</span> javaScriptValues[<span class="string">&quot;title&quot;</span>] <span class="keyword">as?</span> <span class="type">String</span> <span class="operator">??</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">self</span><span class="operator">?</span>.pageURL <span class="operator">=</span> javaScriptValues[<span class="string">&quot;URL&quot;</span>] <span class="keyword">as?</span> <span class="type">String</span> <span class="operator">??</span> <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>完成代码是:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> inputItem <span class="operator">=</span> extensionContext<span class="operator">?</span>.inputItems.first <span class="keyword">as?</span> <span class="type">NSExtensionItem</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> itemProvider <span class="operator">=</span> inputItem.attachments<span class="operator">?</span>.first &#123;</span><br><span class="line">        itemProvider.loadItem(forTypeIdentifier: kUTTypePropertyList <span class="keyword">as</span> <span class="type">String</span>) &#123;[<span class="keyword">weak</span> <span class="keyword">self</span>] (dict, error) <span class="keyword">in</span> </span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> itemDictionary <span class="operator">=</span> dict <span class="keyword">as?</span> <span class="type">NSDictionary</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> javaScriptValues <span class="operator">=</span> itemDictionary[<span class="type">NSExtensionJavaScriptPreprocessingResultsKey</span>] <span class="keyword">as?</span> <span class="type">NSDictionary</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">            <span class="keyword">self</span><span class="operator">?</span>.pageTitle <span class="operator">=</span> javaScriptValues[<span class="string">&quot;title&quot;</span>] <span class="keyword">as?</span> <span class="type">String</span> <span class="operator">??</span> <span class="string">&quot;&quot;</span></span><br><span class="line">            <span class="keyword">self</span><span class="operator">?</span>.pageURL <span class="operator">=</span> javaScriptValues[<span class="string">&quot;URL&quot;</span>] <span class="keyword">as?</span> <span class="type">String</span> <span class="operator">??</span> <span class="string">&quot;&quot;</span></span><br><span class="line">            </span><br><span class="line">            <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">                <span class="keyword">self</span><span class="operator">?</span>.title <span class="operator">=</span> <span class="keyword">self</span><span class="operator">?</span>.pageTitle</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&#x2F;&#x2F; do stuff中的代码是经过简单编写的,但建议自己去建立一个extension,看一下默认模版中是怎么遍历所有的items和providers,并最终找到第一张图片的。</p>
<p>info.plist内的设置:<br>先看一下设置后的info.plist内部的构成:<br><img src="/Images/NSExtensionOfInfoPlist.png" alt="NSExtensionOfInfoPlist"><br>有一个Information Property List。因为我们这里是一个插件,所以该list里面有一个NSExtension。<br>这个NSExtension里面一般有三样东西:<br>NSExtensionAttributes, NSExtensionMainStoryboard and NSExtensionPointIdentifier.<br>这里我们只关心会改变我们的插件行为的NSExtensionAttributes。<br>我们设置的目的是:<br>一是设置接收的是什么数据,二是设置后期要执行的语言类型及具体文件名。<br>在NSExtensionAttributes下面有一个NSExtensionActivationRule,Type是”String”,值是”TRUEPREDICATE”,把它修改Type为Dictionary,在里面“+”一个item,名字为”NSExtensionActivationSupportsWebPageWithMaxCount”,Type为String,值设为1。把这个值加到新设的Dictionary里面,是因为我们只想要收到网页数据(web pages),而对images或其他数据类型不感兴趣。<br>接下来选择NSExtensionAttributes,在里面添加名为”NSExtensionJavaScriptPreprocessingFile”,Type为”String”,值为”Action”。这样设置,就是当插件被called的时候,我们需要运行JavaScript的预处理文件,文件名为Action.js。这样需要注意,这里你设置的值是”Action”而不是”Action.js”,因为iOS会帮我们把.js加上去的。</p>
<p>既然在info.plist中已经设置了要执行的”Action.js”文件,那么我们就要创建它:<br>Right-click on your extension’s Info.plist file and choose New File. When you’re asked what template you want, choose iOS &gt; Other &gt; Empty, then name it Action.js, and put this text into it:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Action</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Action</span>.<span class="property"><span class="keyword">prototype</span></span> = &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// run及其代码的意思是:</span></span><br><span class="line"><span class="comment">// 告知iOS这个JavaScript已经预处理完毕,把这个dictionary(里面的key分别是&quot;URL&quot;和&quot;title&quot;以及对应的值)给extension吧</span></span><br><span class="line"><span class="attr">run</span>: <span class="keyword">function</span>(<span class="params">parameters</span>) &#123;</span><br><span class="line">    parameters.<span class="title function_">completionFunction</span>(&#123; <span class="string">&quot;URL&quot;</span>: <span class="variable language_">document</span>.<span class="property">URL</span>, <span class="string">&quot;title&quot;</span>: <span class="variable language_">document</span>.<span class="property">title</span> &#125;);</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="attr">finalize</span>: <span class="keyword">function</span>(<span class="params">parameters</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> customJavaScript = parameters[<span class="string">&quot;customJavaScript&quot;</span>];</span><br><span class="line">    <span class="built_in">eval</span>(customJavaScript);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">ExtensionPreprocessingJS</span> = <span class="keyword">new</span> <span class="title class_">Action</span></span><br></pre></td></tr></table></figure>
<p>There are two functions: run() and finalize(). The first is called before your extension is run, and the other is called after.<br>Apple expects the code to be exactly like this, so you shouldn’t change it other than to fill in the run() and finalize() functions.</p>
<p>设置到这里,我们在Project Navigator中可以看到的extenison是这样的:<br><img src="/Images/ExtensionFromProjectNavigator.png" alt="ExtensionFromProjectNavigator"><br>此外,在Build Phases的Compile Sources和Copy Bundle Resources中,应该是如上图这样,Action.js是在Copy Bundle Resources中,而不是在Compile Sources中。</p>
<p>最终的Action.js是这样的:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="type">Action</span> <span class="operator">=</span> function() &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">Action</span>.prototype <span class="operator">=</span> &#123;</span><br><span class="line">    </span><br><span class="line">run: function(parameters) &#123;</span><br><span class="line">    <span class="comment">// tell iOS the JavaScript has finished preprocessing, and give this data dictionary to the extension.</span></span><br><span class="line">    <span class="comment">// The data that is being sent has the keys &quot;URL&quot; and &quot;title&quot;, with the values being the page URL and page title.</span></span><br><span class="line">    parameters.completionFunction(&#123; <span class="string">&quot;URL&quot;</span>: document.<span class="type">URL</span>, <span class="string">&quot;title&quot;</span>: document.title &#125;);</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line">    </span><br><span class="line">finalize: function(parameters) &#123;</span><br><span class="line">    <span class="keyword">var</span> customJavaScript <span class="operator">=</span> parameters[<span class="string">&quot;customJavaScript&quot;</span>];</span><br><span class="line">    eval(customJavaScript);</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="type">ExtensionPreprocessingJS</span> <span class="operator">=</span> new <span class="type">Action</span></span><br></pre></td></tr></table></figure>

<p>在MainInterface.storyboard上建立一个UITextNode,让其auto layout,随后ctrl+drag让其在ActionViewController上对应属性:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@IBOutlet</span> <span class="keyword">var</span> script: <span class="type">UITextView</span>!</span><br></pre></td></tr></table></figure>

<p>在extension界面的右上角加一个执行的按钮:(注意extension界面只有在被调用到插件功能的时候才会启用)</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">navigationItem.rightBarButtonItem <span class="operator">=</span> <span class="type">UIBarButtonItem</span>(barButtonSystemItem: .done, target: <span class="keyword">self</span>, action: <span class="keyword">#selector</span>(done))</span><br></pre></td></tr></table></figure>

<p>此时写下要执行的objc的方法:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@objc</span> <span class="keyword">func</span> <span class="title function_">done</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> item <span class="operator">=</span> <span class="type">NSExtensionItem</span>()</span><br><span class="line">    <span class="comment">// 注意看在Action.js的finalize方法中定义到了</span></span><br><span class="line">    <span class="comment">// var customJavaScript = parameters[&quot;customJavaScript&quot;];</span></span><br><span class="line">    <span class="keyword">let</span> argument: <span class="type">NSDictionary</span> <span class="operator">=</span> [<span class="string">&quot;customJavaScript&quot;</span>: script.text]</span><br><span class="line">    <span class="keyword">let</span> webDictionary: <span class="type">NSDictionary</span> <span class="operator">=</span> [<span class="type">NSExtensionJavaScriptFinalizeArgumentKey</span>: argument]</span><br><span class="line">    <span class="keyword">let</span> customJavaScript <span class="operator">=</span> <span class="type">NSItemProvider</span>(item: webDictionary, typeIdentifier: kUTTypePropertyList <span class="keyword">as</span> <span class="type">String</span>)</span><br><span class="line">    item.attachments <span class="operator">=</span> [customJavaScript]</span><br><span class="line"></span><br><span class="line">    <span class="comment">// completeRequest(returningItems:)的调用会造成插件被关闭,并返回母程序,而且可以传回母程序任何我们定义的items。</span></span><br><span class="line">    extensionContext<span class="operator">?</span>.completeRequest(returningItems: [item])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以观察一下:<br>1、之前我们从safari接收到的是一个含有NSExtensionItem元素的列表,而这里extensionContext?.completeRequest(returningItems: [item]),最终传回safari的也是一个含有NSExtensionItem元素的列表。<br>2、我们朝NSDictionary传递的key是NSExtensionJavaScriptFinalizeArgumentKey,对应的是Action.js的finalize方法,而之前我们一开始从safari取得的key是NSExtensionJavaScriptPreprocessingResultsKey,对应的是Action.js的run方法。<br>这样就能说得通了。I realize that seems like far more effort than it ought to be, but it’s really just the reverse of what we are doing inside viewDidLoad().</p>
<h1 id="NotificationCenter"><a href="#NotificationCenter" class="headerlink" title="NotificationCenter"></a>NotificationCenter</h1><p>在我们的scenes背后,当有”键盘事件”、”应用进入后台”以及一些其他的事件,iOS会持续地向我们发出notification。我们可以对一些特定的notification加入observer进行回应,也可以进行数据的传递。</p>
<h2 id="Fixing-the-keyboard"><a href="#Fixing-the-keyboard" class="headerlink" title="Fixing the keyboard"></a>Fixing the keyboard</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/read/19/7/fixing-the-keyboard-notificationcenter">https://www.hackingwithswift.com/read/19/7/fixing-the-keyboard-notificationcenter</a></p>
</blockquote>
<p>iOS上会有一个keyboard的问题:<br>比如我们现在有一个可以输入多行的UITextView:<br><img src="/Images/KeyboardNotificationCenter_0.png" alt="KeyboardNotificationCenter"><br>我们可以看出这个UITextView占据屏幕的大小。<br>如果我们执行,并调出键盘来一行行的打字,当打的字即将超过键盘所在的位置的时候,会发生什么事情呢？<br><img src="/Images/KeyboardNotificationCenter_1.gif" alt="KeyboardNotificationCenter"><br>为什么会发生这样的事情?<br>因为当你调出keyboard的时候,这个textView的可使用面积没有自动去调整,仍旧那么大,就会出现打的字出现下键盘下方并被遮盖的情况。</p>
<h3 id="keyboardWillHideNotification-x2F-keyboardWillChangeFrameNotification"><a href="#keyboardWillHideNotification-x2F-keyboardWillChangeFrameNotification" class="headerlink" title="keyboardWillHideNotification &#x2F; keyboardWillChangeFrameNotification"></a>keyboardWillHideNotification &#x2F; keyboardWillChangeFrameNotification</h3><p>当键盘隐藏不用的时候,系统会发出keyboardWillHideNotification。<br>当键盘隐藏不用、键盘状态发生改变(比如出现,或者屏幕从portrait专程landscape等等),系统都会发出keyboardWillChangeFrameNotification。<br>看上去keyboardWillChangeFrameNotification已经涵盖了keyboardWillHideNotification,但有时候一些奇怪的场景还是需要用到keyboardWillHideNotification的(现在还没有碰到过)。</p>
<p>添加对这两个键盘事件的观察:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> notificationCenter <span class="operator">=</span> <span class="type">NotificationCenter</span>.default</span><br><span class="line">notificationCenter.addObserver(<span class="keyword">self</span>, selector: <span class="keyword">#selector</span>(adjustForKeyboard), name: <span class="type">UIResponder</span>.keyboardWillHideNotification, object: <span class="literal">nil</span>)</span><br><span class="line">notificationCenter.addObserver(<span class="keyword">self</span>, selector: <span class="keyword">#selector</span>(adjustForKeyboard), name: <span class="type">UIResponder</span>.keyboardWillChangeFrameNotification, object: <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure>

<p>对应的adjustForKeyboard方法:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @IBOutlet var textView: UITextView!</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@objc</span> <span class="keyword">func</span> <span class="title function_">adjustForKeyboard</span>(<span class="params">notificaiton</span>: <span class="type">Notification</span>) &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> keyboardValue <span class="operator">=</span> notification.userInfo<span class="operator">?</span>[<span class="type">UIResponder</span>.keyboardFrameEndUserInfoKey] <span class="keyword">as?</span> <span class="type">NSValue</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> keyboardScreenEndFrame <span class="operator">=</span> keyboardValue.cgRectValue</span><br><span class="line">    <span class="keyword">let</span> keyboardViewEndFrame <span class="operator">=</span> view.convert(keyboardScreenEndFrame, from: view.window)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 假如keyboard隐藏了,则textView的contentInset正常,即四周不做任何调整</span></span><br><span class="line">    <span class="keyword">if</span> notification.name <span class="operator">==</span> <span class="type">UIResponder</span>.keyboardWillHideNotification &#123;</span><br><span class="line">        <span class="comment">// textView.contentInset可以理解为是textView的padding,感觉不是margin</span></span><br><span class="line">        textView.contentInset <span class="operator">=</span> .zero</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 此时一定是keyboard在使用的情况</span></span><br><span class="line">        textView.contentInset <span class="operator">=</span> <span class="type">UIEdgeInsets</span>(top: <span class="number">0</span>, left: <span class="number">0</span>, bottom: keyboardViewEndFrame.height <span class="operator">-</span> view.safeAreaInsets.bottom, right: <span class="number">0</span>)</span><br><span class="line">        <span class="comment">// 这里bottom为何是keyboardViewEndFrame.height - view.safeAreaInsets？</span></span><br><span class="line">        <span class="comment">// 因为经答应两个数值可以知道,keyboardViewEndFrame.height是从屏幕最下方开始的,包括了view.safeAreaInsets.bottom,</span></span><br><span class="line">        <span class="comment">// 而我们的textView开始设置的时候是不包含safeArea的,所以要减掉safeArea的范围。</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再对scroll indicator进行设置:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@objc</span> <span class="keyword">func</span> <span class="title function_">adjustForKeyboard</span>() &#123;</span><br><span class="line">    <span class="comment">// 省略上面的代码</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        下面这三行代码是教程中加上去的,但操作下来感觉没什么用啊</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="comment">// Scroll indicator insets control how big the scroll bars are relative to their view.</span></span><br><span class="line">    textView.scrollIndicatorInsets <span class="operator">=</span> textView.contentInset</span><br><span class="line">    <span class="comment">// textView.selectedRange应该理解为是可选择或可使用的范围</span></span><br><span class="line">    <span class="keyword">let</span> selectedRange <span class="operator">=</span> textView.selectedRange</span><br><span class="line">    <span class="comment">// 设置textView可滚动的范围</span></span><br><span class="line">    textView.scrollRangeToVisible(selectedRange)</span><br></pre></td></tr></table></figure>
<h2 id="NotificationCenter的post的传输自制的提醒"><a href="#NotificationCenter的post的传输自制的提醒" class="headerlink" title="NotificationCenter的post的传输自制的提醒"></a>NotificationCenter的post的传输自制的提醒</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> notificationCenter <span class="operator">=</span> <span class="type">NotificationCenter</span>.default</span><br><span class="line">notificationCenter.post(name: <span class="type">Notification</span>.<span class="type">Name</span>(<span class="string">&quot;UserLoggedIn&quot;</span>), object: <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure>
<p>If no other part of your app has subscribed to receive that notification, nothing will happen. But you can make any other objects subscribe to that notification – it could be one thing, or ten things, it doesn’t matter. This is the essence of loose coupling: you’re transmitting the event to everyone, with no direct knowledge of who your receivers are.</p>
<h1 id="UserNotifications-–-UN"><a href="#UserNotifications-–-UN" class="headerlink" title="UserNotifications – UN"></a>UserNotifications – UN</h1><p>看下来,UserNotifications就是在程序中设置好,取得用户授权后,在固定时间点或此后的一段时间后,给用户的手机系统发送提醒信息的一个模块。</p>
<p>If you want to use the UserNotifications framework, you should import it:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UserNotifications</span><br></pre></td></tr></table></figure>

<h2 id="UNUserNotificationCenter-requestAuthorization-–-获取用户授权"><a href="#UNUserNotificationCenter-requestAuthorization-–-获取用户授权" class="headerlink" title="UNUserNotificationCenter.requestAuthorization – 获取用户授权"></a>UNUserNotificationCenter.requestAuthorization – 获取用户授权</h2><p>给用户发送提醒信息的权限,需要用户授权:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> center <span class="operator">=</span> <span class="type">UNUserNotificationCenter</span>.current()</span><br><span class="line"></span><br><span class="line"><span class="comment">// options表示同意授权的权限包含: 提醒/app上标/声音 这三项</span></span><br><span class="line"><span class="comment">// granted是一个Boolean</span></span><br><span class="line">center.requestAuthorization(options: [.alert, .badge, .sound]) &#123; (granted, error) <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">if</span> granted &#123;</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>跳出来的是:<br><img src="/Images/requestAuthorization.png" alt="requestAuthorization"></p>
<h2 id="UNNotificationRequest-identifier-content-trigger"><a href="#UNNotificationRequest-identifier-content-trigger" class="headerlink" title="UNNotificationRequest(identifier:, content:, trigger:)"></a>UNNotificationRequest(identifier:, content:, trigger:)</h2><p>下面的代码设置的是TimeInterval的通知方式(<strong>UNTimeIntervalNotificationTrigger</strong>),5秒钟后,给系统发送通知信息,告知content中的内容:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> center <span class="operator">=</span> <span class="type">UNUserNotificationCenter</span>.current()</span><br><span class="line"></span><br><span class="line"><span class="comment">// UNNotificationRequest的content部分</span></span><br><span class="line"><span class="keyword">let</span> content <span class="operator">=</span> <span class="type">UNMutableNotificationContent</span>()</span><br><span class="line">content.title <span class="operator">=</span> <span class="string">&quot;Late wake up call&quot;</span></span><br><span class="line">content.body <span class="operator">=</span> <span class="string">&quot;The early bird catches the worm, but the second mouse gets the cheese.&quot;</span></span><br><span class="line"><span class="comment">// -- to attach custom actions</span></span><br><span class="line">content.categoryIdentifier <span class="operator">=</span> <span class="string">&quot;alarm&quot;</span></span><br><span class="line"><span class="comment">// -- to attach custom data to the notification</span></span><br><span class="line">content.userInfo <span class="operator">=</span> [<span class="string">&quot;customData&quot;</span>: <span class="string">&quot;fizzbuzz&quot;</span>]</span><br><span class="line"><span class="comment">// -- to specify a sound</span></span><br><span class="line">content.sound <span class="operator">=</span> <span class="type">UNNotificationSound</span>.default</span><br><span class="line"></span><br><span class="line"><span class="comment">// UNNotificationRequest的trigger部分</span></span><br><span class="line"><span class="keyword">let</span> trigger <span class="operator">=</span> <span class="type">UNTimeIntervalNotificationTrigger</span>(timeInterval: <span class="number">5</span>, repeats: <span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> request <span class="operator">=</span> <span class="type">UNNotificationRequest</span>(identifier: <span class="type">UUID</span>().uuidString, content: content, trigger: trigger)</span><br><span class="line">center.add(request)</span><br></pre></td></tr></table></figure>

<p>也可以设置成Calendar的通知方式,每天10:30发送: (<strong>UNCalendarNotificationTrigger</strong>)</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> center <span class="operator">=</span> <span class="type">UNUserNotificationCenter</span>.current()</span><br><span class="line"></span><br><span class="line"><span class="comment">// cancel future scheduled notifications, to start over</span></span><br><span class="line"><span class="comment">// 若再次启动的话,需要删除之前悬停着的提醒设定</span></span><br><span class="line">center.removeAllPendingNotificationRequests()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> content <span class="operator">=</span> <span class="type">UNMutableNotificationContent</span>()</span><br><span class="line">content.title <span class="operator">=</span> <span class="string">&quot;Late wake up call&quot;</span></span><br><span class="line">content.body <span class="operator">=</span> <span class="string">&quot;The early bird catches the worm, but the second mouse gets the cheese.&quot;</span></span><br><span class="line"><span class="comment">// content.categoryIdentifier指你可以在notification中加入自定义的action,</span></span><br><span class="line"><span class="comment">// 下面会用到的UNNotificationCategory(identifier:, actions: [], intentIdentifiers: [])的identifier必须对应指定是&quot;alarm&quot;</span></span><br><span class="line">content.categoryIdentifier <span class="operator">=</span> <span class="string">&quot;alarm&quot;</span></span><br><span class="line"><span class="comment">// content.userInfo指你可以在notification中加入自定义的数据,</span></span><br><span class="line">content.userInfo <span class="operator">=</span> [<span class="string">&quot;customData&quot;</span>: <span class="string">&quot;fizzbuzz&quot;</span>]</span><br><span class="line">content.sound <span class="operator">=</span> <span class="type">UNNotificationSound</span>.default</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> dateComponents <span class="operator">=</span> <span class="type">DateComponents</span>()</span><br><span class="line">dateComponents.hour <span class="operator">=</span> <span class="number">10</span></span><br><span class="line">dateComponents.minute <span class="operator">=</span> <span class="number">30</span></span><br><span class="line"><span class="keyword">let</span> trigger <span class="operator">=</span> <span class="type">UNCalendarNotificationTrigger</span>(dateMatching: dateComponents, repeats: <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里的identifier的指定(虽然在这个例子中可有可无),但它可以让你在之后 更新(update) 或 移除(remove) 提醒。</span></span><br><span class="line"><span class="comment">// 你也可以通过 center.removeAllPendingNotificationRequests() 来移除 等待的(pending) 的提醒。</span></span><br><span class="line"><span class="keyword">let</span> request <span class="operator">=</span> <span class="type">UNNotificationRequest</span>(identifier: <span class="type">UUID</span>().uuidString, content: content, trigger: trigger)</span><br><span class="line">center.add(request)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>你也可以设置一个 地理围栏(geofence),它可以基于你的地理位置来发动(trigger)通知提醒。</p>
<p>五秒钟后发送是这样的:<br><img src="/images/UNNotificationRequest.gif" alt="UNNotificationRequest"></p>
<h2 id="Acting-on-responses-–-根据用户点击选项来采取行动"><a href="#Acting-on-responses-–-根据用户点击选项来采取行动" class="headerlink" title="Acting on responses – 根据用户点击选项来采取行动"></a>Acting on responses – 根据用户点击选项来采取行动</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/read/21/3/acting-on-responses">https://www.hackingwithswift.com/read/21/3/acting-on-responses</a></p>
</blockquote>
<p><strong>UNNotificationAction</strong> <strong>UNNotificationCategory</strong><br>使用UNNotificationAction和UNNotificationCategory,你可以针对跳出的提醒及用户的反应做出进一步的回应。<br>UNNotificationCategory对应的是上面我们设置的content.categoryIdentifier &#x3D; “alarm”。<br>UNNotificationAction设置的是用户选择点击后作出的回应。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> center <span class="operator">=</span> <span class="type">UNUserNotificationCenter</span>.current()</span><br><span class="line"><span class="comment">// center.delegate = self 就必须让这个self符合UNUserNotificationCenterDelegate协议</span></span><br><span class="line">center.delegate <span class="operator">=</span> <span class="keyword">self</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// An identifier, which is a unique text string that gets sent to you when the button is tapped.</span></span><br><span class="line"><span class="comment">// A title, which is what user’s see in the interface.</span></span><br><span class="line"><span class="comment">// Options, which describe any special options that relate to the action. You can choose from .authenticationRequired, .destructive, and .foreground.</span></span><br><span class="line"><span class="comment">// .foreground -- The action causes the app to launch in the foreground.</span></span><br><span class="line"><span class="comment">// .destructive -- The action causes a destructive task.</span></span><br><span class="line"><span class="keyword">let</span> show <span class="operator">=</span> <span class="type">UNNotificationAction</span>(identifier: <span class="string">&quot;show&quot;</span>, title: <span class="string">&quot;Tell me more...&quot;</span>, options: .foreground)</span><br><span class="line"><span class="keyword">let</span> show2 <span class="operator">=</span> <span class="type">UNNotificationAction</span>(identifier: <span class="string">&quot;show2&quot;</span>, title: <span class="string">&quot;Tell me another...&quot;</span>, options: .authenticationRequired)</span><br><span class="line"><span class="comment">// 此处就必须要对应上面讲到的 content.categoryIdentifier = &quot;alarm&quot;</span></span><br><span class="line"><span class="comment">// 此处的intentIdentifiers--this is used to connect your notifications to intents, if you have created any.</span></span><br><span class="line"><span class="keyword">let</span> category <span class="operator">=</span> <span class="type">UNNotificationCategory</span>(identifier: <span class="string">&quot;alarm&quot;</span>, actions: [show, show2], intentIdentifiers: [])</span><br><span class="line"></span><br><span class="line">center.setNotificationCategories([category])</span><br><span class="line"></span><br><span class="line"><span class="comment">// 下面的代码是上面例子的重复,但要生成notification是必须的,所以就重复写了一遍</span></span><br><span class="line"><span class="keyword">let</span> content <span class="operator">=</span> <span class="type">UNMutableNotificationContent</span>()</span><br><span class="line">content.title <span class="operator">=</span> <span class="string">&quot;Late wake up call&quot;</span></span><br><span class="line">content.body <span class="operator">=</span> <span class="string">&quot;The early bird catches the worm, but the second mouse gets the cheese.&quot;</span></span><br><span class="line">content.categoryIdentifier <span class="operator">=</span> <span class="string">&quot;alarm&quot;</span></span><br><span class="line">content.userInfo <span class="operator">=</span> [<span class="string">&quot;customData&quot;</span>: <span class="string">&quot;fizzbuzz&quot;</span>]</span><br><span class="line">content.sound <span class="operator">=</span> <span class="type">UNNotificationSound</span>.default</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> dateComponents <span class="operator">=</span> <span class="type">DateComponents</span>()</span><br><span class="line">dateComponents.hour <span class="operator">=</span> <span class="number">10</span></span><br><span class="line">dateComponents.minute <span class="operator">=</span> <span class="number">30</span></span><br><span class="line"><span class="keyword">let</span> trigger <span class="operator">=</span> <span class="type">UNTimeIntervalNotificationTrigger</span>(timeInterval: <span class="number">5</span>, repeats: <span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> request <span class="operator">=</span> <span class="type">UNNotificationRequest</span>(identifier: <span class="type">UUID</span>().uuidString, content: content, trigger: trigger)</span><br><span class="line">center.add(request)</span><br></pre></td></tr></table></figure>
<p>效果是这样的:<br><img src="/Images/UNNotificationRequest_2.gif" alt="UNNotificationRequest_2"></p>
<h2 id="UNUserNotificationCenter的getNotificationSettings-–-查看是否已获得用户的允许发送提醒"><a href="#UNUserNotificationCenter的getNotificationSettings-–-查看是否已获得用户的允许发送提醒" class="headerlink" title="UNUserNotificationCenter的getNotificationSettings – 查看是否已获得用户的允许发送提醒"></a>UNUserNotificationCenter的getNotificationSettings – 查看是否已获得用户的允许发送提醒</h2><p>感觉下面这样写比较好,查看是否获得用户授权发提醒,若未获授权,则请求授权;若已授权,则进一步设置提醒的内容和方式:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">manageNotifications</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> notificationCenter <span class="operator">=</span> <span class="type">UNUserNotificationCenter</span>.current()</span><br><span class="line">    </span><br><span class="line">    notificationCenter.getNotificationSettings &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] (settings) <span class="keyword">in</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// user has not made a choice yet regarding accepting notifications</span></span><br><span class="line">        <span class="keyword">if</span> settings.authorizationStatus <span class="operator">==</span> .notDetermined &#123;</span><br><span class="line">            <span class="comment">// use this opportunity to explain why it could be useful</span></span><br><span class="line">            <span class="keyword">let</span> ac <span class="operator">=</span> <span class="type">UIAlertController</span>(title: <span class="string">&quot;Daily reminder&quot;</span>, message: <span class="string">&quot;Allow notifications to be reminded daily of playing Guess the Flag&quot;</span>, preferredStyle: .alert)</span><br><span class="line">            ac.addAction(<span class="type">UIAlertAction</span>(title: <span class="string">&quot;Next&quot;</span>, style: .default) &#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">self</span><span class="operator">?</span>.requestNotificationsAuthorization()</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="keyword">self</span><span class="operator">?</span>.present(ac, animated: <span class="literal">true</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// user already has accepted notifications</span></span><br><span class="line">        <span class="keyword">if</span> settings.authorizationStatus <span class="operator">==</span> .authorized &#123;</span><br><span class="line">            <span class="keyword">self</span><span class="operator">?</span>.scheduleNotifications()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">requestNotificationsAuthorization</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> notificationCenter <span class="operator">=</span> <span class="type">UNUserNotificationCenter</span>.current()</span><br><span class="line"></span><br><span class="line">    notificationCenter.requestAuthorization(options: [.alert, .badge, .sound]) &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] granted, error <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">if</span> granted &#123;</span><br><span class="line">            <span class="keyword">self</span><span class="operator">?</span>.scheduleNotifications()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// explain how notifications can be activated</span></span><br><span class="line">            <span class="keyword">let</span> ac <span class="operator">=</span> <span class="type">UIAlertController</span>(title: <span class="string">&quot;Notifications&quot;</span>, message: <span class="string">&quot;Your choice has been saved.<span class="subst">\n</span>Should you change your mind, head to <span class="subst">\&quot;</span>Settings -&gt; Project21-Challenge3 -&gt; Notifications<span class="subst">\&quot;</span> to update your preferences.&quot;</span>, preferredStyle: .alert)</span><br><span class="line">            ac.addAction(<span class="type">UIAlertAction</span>(title: <span class="string">&quot;OK&quot;</span>, style: .default))</span><br><span class="line">            <span class="keyword">self</span><span class="operator">?</span>.present(ac, animated: <span class="literal">true</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="didReceive-–-处理上面设置的content-userInfo-x3D-“customData”-“fizzbuzz”-等传输数据"><a href="#didReceive-–-处理上面设置的content-userInfo-x3D-“customData”-“fizzbuzz”-等传输数据" class="headerlink" title="didReceive – 处理上面设置的content.userInfo &#x3D; [“customData”: “fizzbuzz”]等传输数据"></a>didReceive – 处理上面设置的content.userInfo &#x3D; [“customData”: “fizzbuzz”]等传输数据</h2><p>UNUserNotificationCenterDelegate协议定义了userNotificationCenter方法,可以接收一个@escaping,来等待并处理传输的数据:<br>(这不是必须要定义的方法,只是在需要处理传输的数据的时候才有必要)</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">userNotificationCenter:(<span class="type">UNUserNotificationCenter</span> <span class="operator">*</span>)center didReceiveNotificationResponse:(<span class="type">UNNotificationResponse</span> <span class="operator">*</span>)response withCompletionHandler</span><br></pre></td></tr></table></figure>
<p>我们可以这样定义该方法:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">userNotificationCenter</span>(<span class="keyword">_</span> <span class="params">center</span>: <span class="type">UNUserNotificationCenter</span>, <span class="params">didReceive</span> <span class="params">response</span>: <span class="type">UNNotificationResponse</span>, <span class="params">withCompletionHandler</span> <span class="params">completionHandler</span>: <span class="keyword">@escaping</span> () -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> userInfo <span class="operator">=</span> response.notification.request.content.userInfo</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> customData <span class="operator">=</span> userInfo[<span class="string">&quot;customData&quot;</span>] <span class="keyword">as?</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Custom data received: <span class="subst">\(customData)</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">switch</span> response.actionIdentifier &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="type">UNNotificationDefaultActionIdentifier</span>:</span><br><span class="line">            <span class="comment">// the user swiped to unlock</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Default identifier&quot;</span>)</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;show&quot;</span>:</span><br><span class="line">            <span class="comment">// 针对我们之前的三行代码:</span></span><br><span class="line">            <span class="comment">// let show = UNNotificationAction(identifier: &quot;show&quot;, title: &quot;Tell me more...&quot;, options: .foreground)</span></span><br><span class="line">            <span class="comment">// let category = UNNotificationCategory(identifier: &quot;alarm&quot;, actions: [show], intentIdentifiers: [])</span></span><br><span class="line">            <span class="comment">// center.setNotificationCategories([category])</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Show more information...&quot;</span>)</span><br><span class="line">            <span class="comment">// 你也可以再执行一遍scheduleNotifications()来设置新的提醒</span></span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>很有趣的是,它只响应center.setNotificationCategories,就是你只有点了”Tell me more…”或者”Tell me another…”按钮才会执行该方法,很奇怪,难道它只针对UNNotificationCategory,为啥？<br>center.setNotificationCategories的参数是[category],而category指向的actions是[show, show2, …],所以它只针对action来回应。</p>
<h1 id="使用AVFoudation模块的AVPlayer播放声音文件"><a href="#使用AVFoudation模块的AVPlayer播放声音文件" class="headerlink" title="使用AVFoudation模块的AVPlayer播放声音文件"></a>使用AVFoudation模块的AVPlayer播放声音文件</h1><p>在使用SpriteKit模块使用中,为何不使用其本身就有的SKAction.playSoundFileNamed()？<br>而是要去使用AVAudioPlayer(contentsOf: URL)?<br>教材中称是,AVAudioPlayer可以在你需要的时候,随时停止声音的播放。</p>
<p>基本使用方法:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> path <span class="operator">=</span> <span class="type">Bundle</span>.main.url(forResource: <span class="string">&quot;sliceBombFuse&quot;</span>, withExtension: <span class="string">&quot;caf&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> sound <span class="operator">=</span> <span class="keyword">try?</span>  <span class="type">AVAudioPlayer</span>(contentsOf: path) &#123;</span><br><span class="line">        bombSoundEffect <span class="operator">=</span> sound</span><br><span class="line">        sound.play()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>你可以使用sound.stop()来停止播放。</p>
<h1 id="NSAttributedString"><a href="#NSAttributedString" class="headerlink" title="NSAttributedString"></a>NSAttributedString</h1><p>Attributed strings are made up of two parts: a plain Swift string, plus a dictionary containing a series of attributes that describe how various segments of the string are formatted. </p>
<p>NSAttributedString可以针对一串字符串,片段化地设置其的属性,而Label却只能整个设置。<br>我们在使用UILabel, UITextField, UITextView, UIButton, UINavigationBar等等支持text属性的情况下,更建议使用attributedText。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">NSAttributedString</span>(string: <span class="type">String</span>, attributes: [<span class="type">NSAttributedString</span>.Key: <span class="keyword">Any</span>]<span class="operator">?</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>The examples are in codes below.</p>
<h2 id="NSAttributedString-Key-–-一般用法"><a href="#NSAttributedString-Key-–-一般用法" class="headerlink" title="NSAttributedString.Key – 一般用法"></a>NSAttributedString.Key – 一般用法</h2><p>NSAttributedString.Key is the attributes that you can apply to text in an attributed string.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> string <span class="operator">=</span> <span class="string">&quot;This is a test string.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> attributes: [<span class="type">NSAttributedString</span>.<span class="type">Key</span>: <span class="keyword">Any</span>] <span class="operator">=</span> [</span><br><span class="line">    .foregroundColor: <span class="type">UIColor</span>.white,</span><br><span class="line">    .backgroundColor: <span class="type">UIColor</span>.red,</span><br><span class="line">    .font: <span class="type">UIFont</span>.boldSystemFont(ofSize: <span class="number">36</span>)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> attributedString <span class="operator">=</span> <span class="type">NSAttributedString</span>(string: string, attributes: attributes)</span><br></pre></td></tr></table></figure>
<p>效果是这样的:<br><img src="/Images/NSAttributedString.Key.png" alt="NSAttributedString.Key"><br>虽然我们可以在Label中设置字符串的属性,但你不能对该字符串的不同部分设置不同的属性,而NSAttributedString可以做到。</p>
<h2 id="NSMutableAttributedString-string-String"><a href="#NSMutableAttributedString-string-String" class="headerlink" title="NSMutableAttributedString(string: String)"></a>NSMutableAttributedString(string: String)</h2><p>可更改属性的NSString,即使你使用let来定义,如下:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> string <span class="operator">=</span> <span class="string">&quot;This is a test string&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> attributedString <span class="operator">=</span> <span class="type">NSMutableAttributedString</span>(string: string)</span><br><span class="line">attributedString.addAttribute(.font, value: <span class="type">UIFont</span>.systemFont(ofSize: <span class="number">8</span>), range: <span class="type">NSRange</span>(location: <span class="number">0</span>, length: <span class="number">4</span>))</span><br><span class="line">attributedString.addAttribute(.font, value: <span class="type">UIFont</span>.systemFont(ofSize: <span class="number">16</span>), range: <span class="type">NSRange</span>(location: <span class="number">5</span>, length: <span class="number">2</span>))</span><br><span class="line">attributedString.addAttribute(.font, value: <span class="type">UIFont</span>.systemFont(ofSize: <span class="number">24</span>), range: <span class="type">NSRange</span>(location: <span class="number">8</span>, length: <span class="number">1</span>))</span><br><span class="line">attributedString.addAttribute(.font, value: <span class="type">UIFont</span>.systemFont(ofSize: <span class="number">32</span>), range: <span class="type">NSRange</span>(location: <span class="number">10</span>, length: <span class="number">4</span>))</span><br><span class="line">attributedString.addAttribute(.font, value: <span class="type">UIFont</span>.systemFont(ofSize: <span class="number">40</span>), range: <span class="type">NSRange</span>(location: <span class="number">15</span>, length: <span class="number">6</span>))</span><br></pre></td></tr></table></figure>
<p><img src="/Images/NSMutableAttributedString.png" alt="NSMutableAttributedString"></p>
<h2 id="NSAttributedString-Key-–-的其他属性"><a href="#NSAttributedString-Key-–-的其他属性" class="headerlink" title="NSAttributedString.Key – 的其他属性"></a>NSAttributedString.Key – 的其他属性</h2><p>There are lots of formatting options for attributed strings, including:</p>
<ul>
<li>Set .underlineStyle to a value from NSUnderlineStyle to strike out characters.</li>
<li>Set .strikethroughStyle to a value from NSUnderlineStyle (no, that’s not a typo) to strike out characters.</li>
<li>Set .paragraphStyle to an instance of NSMutableParagraphStyle to control text alignment and spacing.</li>
<li>Set .link to be a URL to make clickable links in your strings.</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">attributedString.addAttribute(.link, value: <span class="string">&quot;https://www.google.com&quot;</span>, range: <span class="type">NSRange</span>(location: <span class="number">0</span>, length: attributedString.length))</span><br></pre></td></tr></table></figure>
<p><img src="/Images/NSAttributedString.Key.link.png" alt="NSAttributedString.Key.link"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://giantslayer1980.github.io/Swift/" data-id="clemxk7qu0000cu0d3pdbhrxp" data-title="Swift" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
    
  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Swift/">Swift</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/Swift/">Swift</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>